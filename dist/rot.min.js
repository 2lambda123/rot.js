var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,g,h){c!=Array.prototype&&c!=Object.prototype&&(c[g]=h.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,g,h,m){if(g){h=$jscomp.global;c=c.split(".");for(m=0;m<c.length-1;m++){var r=c[m];r in h||(h[r]={});h=h[r]}c=c[c.length-1];m=h[c];g=g(m);g!=m&&null!=g&&$jscomp.defineProperty(h,c,{configurable:!0,writable:!0,value:g})}};$jscomp.underscoreProtoCanBeSet=function(){var c={a:!0},g={};try{return g.__proto__=c,g.a}catch(h){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(c,g){c.__proto__=g;if(c.__proto__!==g)throw new TypeError(c+" is not extensible");return c}:null;$jscomp.polyfill("Object.setPrototypeOf",function(c){return c||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(c,h,m){var g=this.length||0;0>h&&(h=Math.max(0,g+h));if(null==m||m>g)m=g;m=Number(m);0>m&&(m=Math.max(0,g+m));for(h=Number(h||0);h<m;h++)this[h]=c;return this}},"es6","es3");$jscomp.owns=function(c,g){return Object.prototype.hasOwnProperty.call(c,g)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(c,g){for(var h=1;h<arguments.length;h++){var m=arguments[h];if(m)for(var r in m)$jscomp.owns(m,r)&&(c[r]=m[r])}return c};
$jscomp.polyfill("Object.assign",function(c){return c||$jscomp.assign},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var c=0;return function(g){return $jscomp.SYMBOL_PREFIX+(g||"")+c++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.asyncIterator;c||(c=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(c){var g=0;return $jscomp.iteratorPrototype(function(){return g<c.length?{done:!1,value:c[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,g){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var h=0,m={next:function(){if(h<c.length){var r=h++;return{value:g(r,c[r]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};
$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");$jscomp.checkStringArgs=function(c,g,h){if(null==c)throw new TypeError("The 'this' value for String.prototype."+h+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+h+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.repeat",function(c){return c?c:function(c){var g=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var m="";c;)if(c&1&&(m+=g),c>>>=1)g+=g;return m}},"es6","es3");$jscomp.stringPadding=function(c,g){c=void 0!==c?String(c):" ";return 0<g&&c?c.repeat(Math.ceil(g/c.length)).substring(0,g):""};
$jscomp.polyfill("String.prototype.padStart",function(c){return c?c:function(c,h){var g=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(h,c-g.length)+g}},"es8","es3");function _typeof(c){_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"===typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};return _typeof(c)}
function _slicedToArray(c,g){return _arrayWithHoles(c)||_iterableToArrayLimit(c,g)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}function _iterableToArrayLimit(c,g){var h=[],m=!0,r=!1,F=void 0;try{for(var G=c[Symbol.iterator](),C;!(m=(C=G.next()).done)&&(h.push(C.value),!g||h.length!==g);m=!0);}catch(I){r=!0,F=I}finally{try{if(!m&&null!=G["return"])G["return"]()}finally{if(r)throw F;}}return h}
function _arrayWithHoles(c){if(Array.isArray(c))return c}function _possibleConstructorReturn(c,g){return!g||"object"!==_typeof(g)&&"function"!==typeof g?_assertThisInitialized(c):g}function _assertThisInitialized(c){if(void 0===c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}
function _get(c,g,h){_get="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(c,g,h){if(c=_superPropBase(c,g))return g=Object.getOwnPropertyDescriptor(c,g),g.get?g.get.call(h):g.value};return _get(c,g,h||c)}function _superPropBase(c,g){for(;!Object.prototype.hasOwnProperty.call(c,g)&&(c=_getPrototypeOf(c),null!==c););return c}
function _getPrototypeOf(c){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)};return _getPrototypeOf(c)}function _inherits(c,g){if("function"!==typeof g&&null!==g)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(g&&g.prototype,{constructor:{value:c,writable:!0,configurable:!0}});g&&_setPrototypeOf(c,g)}
function _setPrototypeOf(c,g){_setPrototypeOf=Object.setPrototypeOf||function(c,g){c.__proto__=g;return c};return _setPrototypeOf(c,g)}function _classCallCheck(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function");}function _defineProperties(c,g){for(var h=0;h<g.length;h++){var m=g[h];m.enumerable=m.enumerable||!1;m.configurable=!0;"value"in m&&(m.writable=!0);Object.defineProperty(c,m.key,m)}}
function _createClass(c,g,h){g&&_defineProperties(c.prototype,g);h&&_defineProperties(c,h);return c}
var ROT=function(c){function g(c,a){return(c%a+a)%a}function h(c){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return c<a?a:c>b?b:c}function m(c){return c.charAt(0).toUpperCase()+c.substring(1)}function r(c){for(var a=arguments.length,b=Array(1<a?a-1:0),d=1;d<a;d++)b[d-1]=arguments[d];var e=r.map;return c.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(d,a,n,k){if("%"==c.charAt(k-1))return d.substring(1);if(!b.length)return d;
n=(a||n).split(",");a=n.shift()||"";k=e[a.toLowerCase()];if(!k)return d;d=b.shift();d=d[k].apply(d,n);a=a.charAt(0);a!=a.toLowerCase()&&(d=m(d));return d})}function F(c,a){var b=[],d=0;c.replace(V,function(a,e,n,k){var f=c.substring(d,k);f.length&&b.push({type:0,value:f});b.push({type:"c"==e?2:3,value:n.trim()});d=k+a.length;return""});var e=c.substring(d);e.length&&b.push({type:0,value:e});return G(b,a)}function G(c,a){a||(a=Infinity);for(var b=0,d=0,e=-1;b<c.length;){var f=c[b];1==f.type&&(d=0,
e=-1);if(0!=f.type)b++;else{for(;0==d&&" "==f.value.charAt(0);)f.value=f.value.substring(1);var p=f.value.indexOf("\n");if(-1!=p){f.value=C(c,b,p,!0);for(p=f.value.split("");p.length&&" "==p[p.length-1];)p.pop();f.value=p.join("")}if(f.value.length){if(d+f.value.length>a){for(p=-1;;){var n=f.value.indexOf(" ",p+1);if(-1==n)break;if(d+n>a)break;p=n}-1!=p?f.value=C(c,b,p,!0):-1!=e?(b=c[e],f=b.value.lastIndexOf(" "),b.value=C(c,e,f,!0),b=e):f.value=C(c,b,a-d,!1)}else d+=f.value.length,-1!=f.value.indexOf(" ")&&
(e=b);b++}else c.splice(b,1)}}c.push({type:1});a=null;for(d=0;d<c.length;d++)switch(e=c[d],e.type){case 0:a=e;break;case 1:if(a){for(e=a.value.split("");e.length&&" "==e[e.length-1];)e.pop();a.value=e.join("")}a=null}c.pop();return c}function C(c,a,b,d){d={type:0,value:c[a].value.substring(b+(d?1:0))};c.splice(a+1,0,{type:1},d);return c[a].value.substring(0,b)}function I(c){var a;if(c in M)var b=M[c];else{if("#"==c.charAt(0))if(b=(c.match(/[0-9a-f]/gi)||[]).map(function(b){return parseInt(b,16)}),
3==b.length)b=b.map(function(b){return 17*b});else for(a=0;3>a;a++)b[a+1]+=16*b[a],b.splice(a,1);else b=(a=c.match(/rgb\(([0-9, ]+)\)/i))?a[1].split(/\s*,\s*/).map(function(b){return parseInt(b)}):[0,0,0];M[c]=b}return b.slice()}function Q(c){for(var a=arguments.length,b=Array(1<a?a-1:0),d=1;d<a;d++)b[d-1]=arguments[d];for(a=0;3>a;a++)for(d=0;d<b.length;d++)c[a]+=b[d][a];return c}function R(c,a){for(var b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,d=c.slice(),e=0;3>e;e++)d[e]=Math.round(d[e]+
b*(a[e]-c[e]));return d}function S(c,a){for(var b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,d=N(c),e=N(a),f=0;3>f;f++)d[f]+=b*(e[f]-d[f]);return T(d)}function N(c){var a=c[0]/255,b=c[1]/255;c=c[2]/255;var d=Math.max(a,b,c),e=Math.min(a,b,c),f=0,p=(d+e)/2;if(d==e)e=0;else{var n=d-e;e=.5<p?n/(2-d-e):n/(d+e);switch(d){case a:f=(b-c)/n+(b<c?6:0);break;case b:f=(c-a)/n+2;break;case c:f=(a-b)/n+4}f/=6}return[f,e,p]}function O(c,a,b){0>b&&(b+=1);1<b&&--b;return b<1/6?c+6*(a-c)*b:.5>b?a:b<
2/3?c+(a-c)*(2/3-b)*6:c}function T(c){var a=c[2];if(0==c[1])return a=Math.round(255*a),[a,a,a];var b=c[1];b=.5>a?a*(1+b):a+b-a*b;var d=2*a-b;a=O(d,b,c[0]+1/3);var e=O(d,b,c[0]);c=O(d,b,c[0]-1/3);return[Math.round(255*a),Math.round(255*e),Math.round(255*c)]}var q=(new (function(){function c(){_classCallCheck(this,c);this._c=this._s2=this._s1=this._s0=this._seed=0}_createClass(c,[{key:"getSeed",value:function(){return this._seed}},{key:"setSeed",value:function(a){this._seed=a=1>a?1/a:a;this._s0=2.3283064365386963E-10*
(a>>>0);a=69069*a+1>>>0;this._s1=2.3283064365386963E-10*a;this._s2=2.3283064365386963E-10*(69069*a+1>>>0);this._c=1;return this}},{key:"getUniform",value:function(){var a=2091639*this._s0+2.3283064365386963E-10*this._c;this._s0=this._s1;this._s1=this._s2;this._c=a|0;return this._s2=a-this._c}},{key:"getUniformInt",value:function(a,b){var d=Math.max(a,b);a=Math.min(a,b);return Math.floor(this.getUniform()*(d-a+1))+a}},{key:"getNormal",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?
arguments[0]:0,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;do{var d=2*this.getUniform()-1;var e=2*this.getUniform()-1;e=d*d+e*e}while(1<e||0==e);return a+d*Math.sqrt(-2*Math.log(e)/e)*b}},{key:"getPercentage",value:function(){return 1+Math.floor(100*this.getUniform())}},{key:"getItem",value:function(a){return a.length?a[Math.floor(this.getUniform()*a.length)]:null}},{key:"shuffle",value:function(a){var b=[];for(a=a.slice();a.length;){var d=a.indexOf(this.getItem(a));b.push(a.splice(d,
1)[0])}return b}},{key:"getWeightedValue",value:function(a){var b=0;for(e in a)b+=a[e];b*=this.getUniform();var d;var e=0;for(d in a)if(e+=a[d],b<e)break;return d}},{key:"getState",value:function(){return[this._s0,this._s1,this._s2,this._c]}},{key:"setState",value:function(a){this._s0=a[0];this._s1=a[1];this._s2=a[2];this._c=a[3];return this}},{key:"clone",value:function(){return(new c).setState(this.getState())}}]);return c}())).setSeed(Date.now()),H=function(){function c(a){_classCallCheck(this,
c);this._context=a}_createClass(c,[{key:"compute",value:function(a){this._options=a}}]);return c}();r.map={s:"toString"};var W=Object.freeze({mod:g,clamp:h,capitalize:m,format:r}),J=function(c){function a(b){_classCallCheck(this,a);b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,b));b._spacingX=0;b._spacingY=0;b._hexSize=0;return b}_inherits(a,c);_createClass(a,[{key:"compute",value:function(b){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,b);var d=Math.ceil(this._context.measureText("W").width);
this._hexSize=Math.floor(b.spacing*(b.fontSize+d/Math.sqrt(3))/2);this._spacingX=this._hexSize*Math.sqrt(3)/2;this._spacingY=1.5*this._hexSize;if(b.transpose){d="height";var e="width"}else d="width",e="height";this._context.canvas[d]=Math.ceil((b.width+1)*this._spacingX);this._context.canvas[e]=Math.ceil((b.height-1)*this._spacingY+2*this._hexSize)}},{key:"draw",value:function(b,d){b=_slicedToArray(b,5);var a=b[2],f=b[3],c=b[4];b=[(b[0]+1)*this._spacingX,b[1]*this._spacingY+this._hexSize];this._options.transpose&&
b.reverse();d&&(this._context.fillStyle=c,this._fill(b[0],b[1]));if(a)for(this._context.fillStyle=f,d=[].concat(a),a=0;a<d.length;a++)this._context.fillText(d[a],b[0],Math.ceil(b[1]))}},{key:"computeSize",value:function(b,d){this._options.transpose&&(b+=d,d=b-d,b-=d);return[Math.floor(b/this._spacingX)-1,Math.floor((d-2*this._hexSize)/this._spacingY+1)]}},{key:"computeFontSize",value:function(b,d){this._options.transpose&&(b+=d,d=b-d,b-=d);b=Math.min(2*b/((this._options.width+1)*Math.sqrt(3))-1,d/
(2+1.5*(this._options.height-1)));d=this._context.font;this._context.font="100px "+this._options.fontFamily;var a=Math.ceil(this._context.measureText("W").width);this._context.font=d;b=Math.floor(b)+1;return Math.ceil(2*b/(this._options.spacing*(1+a/100/Math.sqrt(3))))-1}},{key:"eventToPosition",value:function(b,d){if(this._options.transpose){b+=d;d=b-d;b-=d;var a=this._context.canvas.width}else a=this._context.canvas.height;d=Math.floor(d/(a/this._options.height));g(d,2)?(b-=this._spacingX,b=1+2*
Math.floor(b/(2*this._spacingX))):b=2*Math.floor(b/(2*this._spacingX));return[b,d]}},{key:"_fill",value:function(b,d){var a=this._hexSize,f=this._options.border;this._context.beginPath();this._options.transpose?(this._context.moveTo(b-a+f,d),this._context.lineTo(b-a/2+f,d+this._spacingX-f),this._context.lineTo(b+a/2-f,d+this._spacingX-f),this._context.lineTo(b+a-f,d),this._context.lineTo(b+a/2-f,d-this._spacingX+f),this._context.lineTo(b-a/2+f,d-this._spacingX+f),this._context.lineTo(b-a+f,d)):(this._context.moveTo(b,
d-a+f),this._context.lineTo(b+this._spacingX-f,d-a/2+f),this._context.lineTo(b+this._spacingX-f,d+a/2-f),this._context.lineTo(b,d+a-f),this._context.lineTo(b-this._spacingX+f,d+a/2-f),this._context.lineTo(b-this._spacingX+f,d-a/2+f),this._context.lineTo(b,d-a+f));this._context.fill()}}]);return a}(H),D=function(c){function a(b){_classCallCheck(this,a);b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,b));b._spacingX=0;b._spacingY=0;b._canvasCache={};return b}_inherits(a,c);_createClass(a,
[{key:"compute",value:function(b){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,b);this._canvasCache={};var d=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(b.spacing*d);this._spacingY=Math.ceil(b.spacing*b.fontSize);this._options.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY));this._context.canvas.width=b.width*this._spacingX;this._context.canvas.height=b.height*this._spacingY}},{key:"draw",value:function(b,d){a.cache?
this._drawWithCache(b):this._drawNoCache(b,d)}},{key:"_drawWithCache",value:function(b){var d=_slicedToArray(b,5);b=d[0];var a=d[1],f=d[2],c=d[3],n=d[4];d=""+f+c+n;if(d in this._canvasCache)var k=this._canvasCache[d];else{var l=this._options.border;k=document.createElement("canvas");var u=k.getContext("2d");k.width=this._spacingX;k.height=this._spacingY;u.fillStyle=n;u.fillRect(l,l,k.width-l,k.height-l);if(f)for(u.fillStyle=c,u.font=this._context.font,u.textAlign="center",u.textBaseline="middle",
f=[].concat(f),c=0;c<f.length;c++)u.fillText(f[c],this._spacingX/2,Math.ceil(this._spacingY/2));this._canvasCache[d]=k}this._context.drawImage(k,b*this._spacingX,a*this._spacingY)}},{key:"_drawNoCache",value:function(b,d){var a=_slicedToArray(b,5);b=a[0];var f=a[1],c=a[2],n=a[3];a=a[4];d&&(d=this._options.border,this._context.fillStyle=a,this._context.fillRect(b*this._spacingX+d,f*this._spacingY+d,this._spacingX-d,this._spacingY-d));if(c)for(this._context.fillStyle=n,d=[].concat(c),c=0;c<d.length;c++)this._context.fillText(d[c],
(b+.5)*this._spacingX,Math.ceil((f+.5)*this._spacingY))}},{key:"computeSize",value:function(b,d){return[Math.floor(b/this._spacingX),Math.floor(d/this._spacingY)]}},{key:"computeFontSize",value:function(b,d){b=Math.floor(b/this._options.width);d=Math.floor(d/this._options.height);var a=this._context.font;this._context.font="100px "+this._options.fontFamily;var f=Math.ceil(this._context.measureText("W").width);this._context.font=a;b=f/100*d/b;1<b&&(d=Math.floor(d/b));return Math.floor(d/this._options.spacing)}},
{key:"eventToPosition",value:function(b,d){return[Math.floor(b/this._spacingX),Math.floor(d/this._spacingY)]}}]);return a}(H);D.cache=!1;var A=function(c){function a(b){_classCallCheck(this,a);b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,b));b._colorCanvas=document.createElement("canvas");return b}_inherits(a,c);_createClass(a,[{key:"compute",value:function(b){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,b);this._context.canvas.width=b.width*b.tileWidth;this._context.canvas.height=
b.height*b.tileHeight;this._colorCanvas.width=b.tileWidth;this._colorCanvas.height=b.tileHeight}},{key:"draw",value:function(b,d){var a=_slicedToArray(b,5);b=a[0];var f=a[1],c=a[2],n=a[3],k=a[4];a=this._options.tileWidth;var l=this._options.tileHeight;d&&(this._options.tileColorize?this._context.clearRect(b*a,f*l,a,l):(this._context.fillStyle=k,this._context.fillRect(b*a,f*l,a,l)));if(c)for(d=[].concat(c),n=[].concat(n),k=[].concat(k),c=0;c<d.length;c++){var u=this._options.tileMap[d[c]];if(!u)throw Error("Char '"+
d[c]+"' not found in tileMap");if(this._options.tileColorize){var g=this._colorCanvas,h=g.getContext("2d");h.globalCompositeOperation="source-over";h.clearRect(0,0,a,l);var m=n[c],w=k[c];h.drawImage(this._options.tileSet,u[0],u[1],a,l,0,0,a,l);"transparent"!=m&&(h.fillStyle=m,h.globalCompositeOperation="source-atop",h.fillRect(0,0,a,l));"transparent"!=w&&(h.fillStyle=w,h.globalCompositeOperation="destination-over",h.fillRect(0,0,a,l));this._context.drawImage(g,b*a,f*l,a,l)}else this._context.drawImage(this._options.tileSet,
u[0],u[1],a,l,b*a,f*l,a,l)}}},{key:"computeSize",value:function(b,a){return[Math.floor(b/this._options.tileWidth),Math.floor(a/this._options.tileHeight)]}},{key:"computeFontSize",value:function(){throw Error("Tile backend does not understand font size");}},{key:"eventToPosition",value:function(b,a){return[Math.floor(b/this._options.tileWidth),Math.floor(a/this._options.tileHeight)]}}]);return a}(H),V=/%([bc]){([^}]*)}/g;H=Object.freeze({TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(c,
a){var b={width:0,height:1};c=F(c,a);for(var d=a=0;d<c.length;d++){var e=c[d];switch(e.type){case 0:a+=e.value.length;break;case 1:b.height++,b.width=Math.max(b.width,a),a=0}}b.width=Math.max(b.width,a);return b},tokenize:F});var E={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},X={hex:J,rect:D,tile:A},Y={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",
fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1,termColor:"xterm"},K=function(){function c(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,c);this._context=document.createElement("canvas").getContext("2d");this._data={};this._dirty=!1;this._options={};a=Object.assign({},Y,a);this.setOptions(a);this.DEBUG=this.DEBUG.bind(this);this._tick=this._tick.bind(this);requestAnimationFrame(this._tick)}_createClass(c,
[{key:"DEBUG",value:function(a,b,d){var e=[this._options.bg,this._options.fg];this.draw(a,b,null,null,e[d%e.length])}},{key:"clear",value:function(){this._data={};this._dirty=!0}},{key:"setOptions",value:function(a){Object.assign(this._options,a);if(a.width||a.height||a.fontSize||a.fontFamily||a.spacing||a.layout)a.layout&&(this._backend=new X[a.layout](this._context)),a=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily,this._context.font=
a,this._backend.compute(this._options),this._context.font=a,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=!0;return this}},{key:"getOptions",value:function(){return this._options}},{key:"getContainer",value:function(){return this._context.canvas}},{key:"computeSize",value:function(a,b){return this._backend.computeSize(a,b)}},{key:"computeFontSize",value:function(a,b){return this._backend.computeFontSize(a,b)}},{key:"computeTileSize",value:function(a,b){return[Math.floor(a/
this._options.width),Math.floor(b/this._options.height)]}},{key:"eventToPosition",value:function(a){if("touches"in a){var b=a.touches[0].clientX;a=a.touches[0].clientY}else b=a.clientX,a=a.clientY;var d=this._context.canvas.getBoundingClientRect();b-=d.left;a-=d.top;b*=this._context.canvas.width/d.width;a*=this._context.canvas.height/d.height;return 0>b||0>a||b>=this._context.canvas.width||a>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(b,a)}},{key:"draw",value:function(a,b,d,
e,f){e||(e=this._options.fg);f||(f=this._options.bg);var c="".concat(a,",").concat(b);this._data[c]=[a,b,d,e,f];!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[c]=!0)}},{key:"drawText",value:function(a,b,d,e){var f=null,c=null,n=a,k=1;e||(e=this._options.width-a);for(d=F(d,e);d.length;)switch(e=d.shift(),e.type){case 0:for(var l,g=!1,h,m=!1,w=0;w<e.value.length;w++){l=e.value.charCodeAt(w);var x=e.value.charAt(w);h=65280<l&&65377>l||65500<l&&65512>l||65518<l;l=32==x.charCodeAt(0)||12288==
x.charCodeAt(0);!m||h||l||n++;h&&!g&&n++;this.draw(n++,b,x,f,c);g=l;m=h}break;case 2:f=e.value||null;break;case 3:c=e.value||null;break;case 1:n=a,b++,k++}return k}},{key:"_tick",value:function(){requestAnimationFrame(this._tick);if(this._dirty){if(!0===this._dirty){this._context.fillStyle=this._options.bg;this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height);for(var a in this._data)this._draw(a,!1)}else for(var b in this._dirty)this._draw(b,!0);this._dirty=!1}}},{key:"_draw",
value:function(a,b){a=this._data[a];a[4]!=this._options.bg&&(b=!0);this._backend.draw(a,b)}}]);return c}();K.Rect=D;K.Hex=J;K.Tile=A;J=function(){function c(a){_classCallCheck(this,c);this._options={words:!1,order:3,prior:.001};Object.assign(this._options,a);this._suffix=this._boundary=String.fromCharCode(0);this._prefix=[];for(a=0;a<this._options.order;a++)this._prefix.push(this._boundary);this._priorValues={};this._priorValues[this._boundary]=this._options.prior;this._data={}}_createClass(c,[{key:"clear",
value:function(){this._data={};this._priorValues={}}},{key:"generate",value:function(){for(var a=[this._sample(this._prefix)];a[a.length-1]!=this._boundary;)a.push(this._sample(a));return this._join(a.slice(0,-1))}},{key:"observe",value:function(a){a=this._split(a);for(var b=0;b<a.length;b++)this._priorValues[a[b]]=this._options.prior;a=this._prefix.concat(a).concat(this._suffix);for(b=this._options.order;b<a.length;b++)for(var d=a.slice(b-this._options.order,b),e=a[b],f=0;f<d.length;f++){var c=d.slice(f);
this._observeEvent(c,e)}}},{key:"getStats",value:function(){var a=[],b=Object.keys(this._priorValues).length;b--;a.push("distinct samples: "+b);b=Object.keys(this._data).length;var d=0,e;for(e in this._data)d+=Object.keys(this._data[e]).length;a.push("dictionary size (contexts): "+b);a.push("dictionary size (events): "+d);return a.join(", ")}},{key:"_split",value:function(a){return a.split(this._options.words?/\s+/:"")}},{key:"_join",value:function(a){return a.join(this._options.words?" ":"")}},{key:"_observeEvent",
value:function(a,b){a=this._join(a);a in this._data||(this._data[a]={});a=this._data[a];b in a||(a[b]=0);a[b]++}},{key:"_sample",value:function(a){a=this._backoff(a);a=this._join(a);a=this._data[a];var b={};if(this._options.prior){for(var d in this._priorValues)b[d]=this._priorValues[d];for(var e in a)b[e]+=a[e]}else b=a;return q.getWeightedValue(b)}},{key:"_backoff",value:function(a){for(a.length>this._options.order?a=a.slice(-this._options.order):a.length<this._options.order&&(a=this._prefix.slice(0,
this._options.order-a.length).concat(a));!(this._join(a)in this._data)&&0<a.length;)a=a.slice(1);return a}}]);return c}();var U=function(){function c(){_classCallCheck(this,c);this._time=0;this._events=[];this._eventTimes=[]}_createClass(c,[{key:"getTime",value:function(){return this._time}},{key:"clear",value:function(){this._events=[];this._eventTimes=[];return this}},{key:"add",value:function(a,b){for(var d=this._events.length,e=0;e<this._eventTimes.length;e++)if(this._eventTimes[e]>b){d=e;break}this._events.splice(d,
0,a);this._eventTimes.splice(d,0,b)}},{key:"get",value:function(){if(!this._events.length)return null;var a=this._eventTimes.splice(0,1)[0];if(0<a){this._time+=a;for(var b=0;b<this._eventTimes.length;b++)this._eventTimes[b]-=a}return this._events.splice(0,1)[0]}},{key:"getEventTime",value:function(a){a=this._events.indexOf(a);if(-1!=a)return this._eventTimes[a]}},{key:"remove",value:function(a){a=this._events.indexOf(a);if(-1==a)return!1;this._remove(a);return!0}},{key:"_remove",value:function(a){this._events.splice(a,
1);this._eventTimes.splice(a,1)}}]);return c}(),y=function(){function c(){_classCallCheck(this,c);this._queue=new U;this._repeat=[];this._current=null}_createClass(c,[{key:"getTime",value:function(){return this._queue.getTime()}},{key:"add",value:function(a,b){b&&this._repeat.push(a);return this}},{key:"getTimeOf",value:function(a){return this._queue.getEventTime(a)}},{key:"clear",value:function(){this._queue.clear();this._repeat=[];this._current=null;return this}},{key:"remove",value:function(a){var b=
this._queue.remove(a),d=this._repeat.indexOf(a);-1!=d&&this._repeat.splice(d,1);this._current==a&&(this._current=null);return b}},{key:"next",value:function(){return this._current=this._queue.get()}}]);return c}();D=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"add",value:function(b,d){this._queue.add(b,0);return _get(_getPrototypeOf(a.prototype),"add",this).call(this,b,d)}},{key:"next",
value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0);return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}}]);return a}(y);A=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"add",value:function(b,d,c){this._queue.add(b,void 0!==c?c:1/b.getSpeed());return _get(_getPrototypeOf(a.prototype),"add",this).call(this,b,d)}},
{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed());return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}}]);return a}(y);y=function(c){function a(){_classCallCheck(this,a);var b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this));b._defaultDuration=1;b._duration=b._defaultDuration;return b}_inherits(a,c);_createClass(a,[{key:"add",value:function(b,d,c){this._queue.add(b,c||this._defaultDuration);
return _get(_getPrototypeOf(a.prototype),"add",this).call(this,b,d)}},{key:"clear",value:function(){this._duration=this._defaultDuration;return _get(_getPrototypeOf(a.prototype),"clear",this).call(this)}},{key:"remove",value:function(b){b==this._current&&(this._duration=this._defaultDuration);return _get(_getPrototypeOf(a.prototype),"remove",this).call(this,b)}},{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),
this._duration=this._defaultDuration);return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}},{key:"setDuration",value:function(b){this._current&&(this._duration=b);return this}}]);return a}(y);D={Simple:D,Speed:A,Action:y};var t=function(){function c(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,c);this._lightPasses=a;this._options=Object.assign({topology:8},b)}_createClass(c,[{key:"_getCircle",value:function(a,b,d){var c=[];switch(this._options.topology){case 4:var f=
1;var p=[0,1];var n=[E[8][7],E[8][1],E[8][3],E[8][5]];break;case 6:n=E[6];f=1;p=[-1,1];break;case 8:n=E[4];f=2;p=[-1,1];break;default:throw Error("Incorrect topology for FOV computation");}a+=p[0]*d;b+=p[1]*d;for(p=0;p<n.length;p++)for(var k=0;k<d*f;k++)c.push([a,b]),a+=n[p][0],b+=n[p][1];return c}}]);return c}();A=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"compute",value:function(b,
a,c,f){f(b,a,0,1);if(this._lightPasses(b,a))for(var d=[],e,k,l,g,h,m=1;m<=c;m++)for(var z=this._getCircle(b,a,m),x=360/z.length,v=0;v<z.length;v++)if(l=z[v][0],g=z[v][1],e=x*(v-.5),k=e+x,h=!this._lightPasses(l,g),this._visibleCoords(Math.floor(e),Math.ceil(k),h,d)&&f(l,g,m,1),2==d.length&&0==d[0]&&360==d[1])return}},{key:"_visibleCoords",value:function(a,d,c,f){if(0>a)return d=this._visibleCoords(0,d,c,f),a=this._visibleCoords(360+a,360,c,f),d||a;for(var b=0;b<f.length&&f[b]<a;)b++;if(b==f.length)return c&&
f.push(a,d),!0;var e=0;if(b%2){for(;b<f.length&&f[b]<d;)b++,e++;if(0==e)return!1;c&&(e%2?f.splice(b-e,e,d):f.splice(b-e,e))}else{for(;b<f.length&&f[b]<d;)b++,e++;if(a==f[b-e]&&1==e)return!1;c&&(e%2?f.splice(b-e,e,a):f.splice(b-e,e,a,d))}return!0}}]);return a}(t);y=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"compute",value:function(a,d,c,f){f(a,d,0,1);if(this._lightPasses(a,d))for(var b=
[],e,k,l,g,h,m=1;m<=c;m++)for(var z=this._getCircle(a,d,m),x=z.length,v=0;v<x;v++)if(e=z[v][0],k=z[v][1],g=[v?2*v-1:2*x-1,2*x],h=[2*v+1,2*x],l=!this._lightPasses(e,k),(l=this._checkVisibility(g,h,l,b))&&f(e,k,m,l),2==b.length&&0==b[0][0]&&b[1][0]==b[1][1])return}},{key:"_checkVisibility",value:function(a,d,c,f){if(a[0]>d[0])return a=this._checkVisibility(a,[a[1],a[1]],c,f),d=this._checkVisibility([0,1],d,c,f),(a+d)/2;for(var b=0,e=!1;b<f.length;){var k=f[b];k=k[0]*a[1]-a[0]*k[1];if(0<=k){0!=k||b%
2||(e=!0);break}b++}k=f.length;for(var l=!1;k--;){var g=f[k];g=d[0]*g[1]-g[0]*d[1];if(0<=g){0==g&&k%2&&(l=!0);break}}g=!0;b==k&&(e||l)?g=!1:e&&l&&b+1==k&&k%2?g=!1:b>k&&b%2&&(g=!1);if(!g)return 0;e=k-b+1;if(e%2)b%2?(k=f[b],k=(d[0]*k[1]-k[0]*d[1])/(k[1]*d[1]),c&&f.splice(b,e,d)):(k=f[k],k=(k[0]*a[1]-a[0]*k[1])/(a[1]*k[1]),c&&f.splice(b,e,a));else if(b%2)l=f[b],k=f[k],k=(k[0]*l[1]-l[0]*k[1])/(l[1]*k[1]),c&&f.splice(b,e);else return c&&f.splice(b,e,a,d),1;return k/((d[0]*a[1]-a[0]*d[1])/(a[1]*d[1]))}}]);
return a}(t);var B=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];t=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"compute",value:function(a,d,c,f){f(a,d,0,1);for(var b=0;b<B.length;b++)this._renderOctant(a,d,B[b],c,f)}},{key:"compute180",value:function(a,d,c,f,p){p(a,d,0,1);var b=(f-1+8)%8,e=(f+1+8)%8;this._renderOctant(a,d,B[(f-2+8)%8],
c,p);this._renderOctant(a,d,B[b],c,p);this._renderOctant(a,d,B[f],c,p);this._renderOctant(a,d,B[e],c,p)}},{key:"compute90",value:function(a,d,c,f,p){p(a,d,0,1);var b=(f-1+8)%8;this._renderOctant(a,d,B[f],c,p);this._renderOctant(a,d,B[b],c,p)}},{key:"_renderOctant",value:function(a,d,c,f,p){this._castVisibility(a,d,1,1,0,f+1,c[0],c[1],c[2],c[3],p)}},{key:"_castVisibility",value:function(a,d,c,f,p,n,k,l,g,h,m){if(!(f<p))for(;c<=n;c++){for(var b=-c-1,e=-c,u=!1,q=0;0>=b;){b+=1;var r=a+b*k+e*l,w=d+b*g+
e*h,t=(b-.5)/(e+.5),P=(b+.5)/(e-.5);if(!(P>f)){if(t<p)break;b*b+e*e<n*n&&m(r,w,c,1);u?this._lightPasses(r,w)?(u=!1,f=q):q=P:!this._lightPasses(r,w)&&c<n&&(u=!0,this._castVisibility(a,d,c+1,f,t,n,k,l,g,h,m),q=P)}}if(u)break}}}]);return a}(t);A={DiscreteShadowcasting:A,PreciseShadowcasting:y,RecursiveShadowcasting:t};t=function(){function c(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:80,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:25;_classCallCheck(this,c);this._width=
a;this._height=b}_createClass(c,[{key:"_fillMap",value:function(a){for(var b=[],d=0;d<this._width;d++){b.push([]);for(var c=0;c<this._height;c++)b[d].push(a)}return b}}]);return c}();y=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"create",value:function(a){for(var b=this._width-1,c=this._height-1,f=0;f<=b;f++)for(var p=0;p<=c;p++)a(f,p,f&&p&&f<b&&p<c?0:1);return this}}]);return a}(t);
t=function(c){function a(b,d){_classCallCheck(this,a);b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,b,d));b._rooms=[];b._corridors=[];return b}_inherits(a,c);_createClass(a,[{key:"getRooms",value:function(){return this._rooms}},{key:"getCorridors",value:function(){return this._corridors}}]);return a}(t);var L=function a(){_classCallCheck(this,a)},Z=function(a){function b(a,c,f,p,n,k){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this));d._x1=
a;d._y1=c;d._x2=f;d._y2=p;d._doors={};void 0!==n&&void 0!==k&&d.addDoor(n,k);return d}_inherits(b,a);_createClass(b,[{key:"addDoor",value:function(a,b){this._doors[a+","+b]=1;return this}},{key:"getDoors",value:function(a){for(var b in this._doors){var d=b.split(",");a(parseInt(d[0]),parseInt(d[1]))}return this}},{key:"clearDoors",value:function(){this._doors={};return this}},{key:"addDoors",value:function(a){for(var b=this._x1-1,d=this._x2+1,c=this._y1-1,n=this._y2+1,k=b;k<=d;k++)for(var l=c;l<=
n;l++)if(k==b||k==d||l==c||l==n)a(k,l)||this.addDoor(k,l);return this}},{key:"debug",value:function(){console.log("room",this._x1,this._y1,this._x2,this._y2)}},{key:"isValid",value:function(a,b){for(var d=this._x1-1,c=this._x2+1,e=this._y1-1,k=this._y2+1,l=d;l<=c;l++)for(var g=e;g<=k;g++)if(l==d||l==c||g==e||g==k){if(!a(l,g))return!1}else if(!b(l,g))return!1;return!0}},{key:"create",value:function(a){for(var b=this._x1-1,d=this._x2+1,c=this._y1-1,n=this._y2+1,k,g=b;g<=d;g++)for(var h=c;h<=n;h++)k=
g+","+h in this._doors?2:g==b||g==d||h==c||h==n?1:0,a(g,h,k)}},{key:"getCenter",value:function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}},{key:"getLeft",value:function(){return this._x1}},{key:"getRight",value:function(){return this._x2}},{key:"getTop",value:function(){return this._y1}},{key:"getBottom",value:function(){return this._y2}}],[{key:"createRandomAt",value:function(a,b,c,p,n){var d=n.roomWidth[0],f=n.roomWidth[1],e=q.getUniformInt(d,f);d=n.roomHeight[0];
f=n.roomHeight[1];n=q.getUniformInt(d,f);if(1==c)return c=b-Math.floor(q.getUniform()*n),new this(a+1,c,a+e,c+n-1,a,b);if(-1==c)return c=b-Math.floor(q.getUniform()*n),new this(a-e,c,a-1,c+n-1,a,b);if(1==p)return c=a-Math.floor(q.getUniform()*e),new this(c,b+1,c+e-1,b+n,a,b);if(-1==p)return c=a-Math.floor(q.getUniform()*e),new this(c,b-n,c+e-1,b-1,a,b);throw Error("dx or dy must be 1 or -1");}},{key:"createRandomCenter",value:function(a,b,c){var d=c.roomWidth[0],f=c.roomWidth[1],e=q.getUniformInt(d,
f);d=c.roomHeight[0];f=c.roomHeight[1];c=q.getUniformInt(d,f);a-=Math.floor(q.getUniform()*e);b-=Math.floor(q.getUniform()*c);return new this(a,b,a+e-1,b+c-1)}},{key:"createRandom",value:function(a,b,c){var d=c.roomWidth[0],f=c.roomWidth[1],e=q.getUniformInt(d,f);d=c.roomHeight[0];f=c.roomHeight[1];c=q.getUniformInt(d,f);a=a-e-1;b=b-c-1;a=1+Math.floor(q.getUniform()*a);b=1+Math.floor(q.getUniform()*b);return new this(a,b,a+e-1,b+c-1)}}]);return b}(L),aa=function(a){function b(a,c,f,p){_classCallCheck(this,
b);var d=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this));d._startX=a;d._startY=c;d._endX=f;d._endY=p;d._endsWithAWall=!0;return d}_inherits(b,a);_createClass(b,[{key:"debug",value:function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}},{key:"isValid",value:function(a,b){var d=this._startX,c=this._startY,e=this._endX-d,k=this._endY-c,g=1+Math.max(Math.abs(e),Math.abs(k));e&&(e/=Math.abs(e));k&&(k/=Math.abs(k));for(var h=k,m=-e,q=!0,r=0;r<g;r++){var t=d+r*
e,v=c+r*k;b(t,v)||(q=!1);a(t+h,v+m)||(q=!1);a(t-h,v-m)||(q=!1);if(!q){g=r;this._endX=t-e;this._endY=v-k;break}}if(0==g||1==g&&a(this._endX+e,this._endY+k))return!1;b=!a(this._endX+e+h,this._endY+k+m);h=!a(this._endX+e-h,this._endY+k-m);this._endsWithAWall=a(this._endX+e,this._endY+k);return(b||h)&&this._endsWithAWall?!1:!0}},{key:"create",value:function(a){var b=this._startX,d=this._startY,c=this._endX-b,g=this._endY-d,k=1+Math.max(Math.abs(c),Math.abs(g));c&&(c/=Math.abs(c));g&&(g/=Math.abs(g));
for(var l=0;l<k;l++)a(b+l*c,d+l*g,0);return!0}},{key:"createPriorityWalls",value:function(a){if(this._endsWithAWall){var b=this._endX-this._startX,d=this._endY-this._startY;b&&(b/=Math.abs(b));d&&(d/=Math.abs(d));var c=d,g=-b;a(this._endX+b,this._endY+d);a(this._endX+c,this._endY+g);a(this._endX-c,this._endY-g)}}}],[{key:"createRandomAt",value:function(a,b,c,g,n){n=q.getUniformInt(n.corridorLength[0],n.corridorLength[1]);return new this(a,b,a+c*n,b+g*n)}}]);return b}(L);t=function(a){function b(a,
c,f){_classCallCheck(this,b);a=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a,c));a._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1E3};Object.assign(a._options,f);a._map=[];a._dug=0;a._roomAttempts=20;a._corridorAttempts=20;a._connected=[];a._unconnected=[];a._digCallback=a._digCallback.bind(_assertThisInitialized(_assertThisInitialized(a)));a._canBeDugCallback=a._canBeDugCallback.bind(_assertThisInitialized(_assertThisInitialized(a)));a._isWallCallback=
a._isWallCallback.bind(_assertThisInitialized(_assertThisInitialized(a)));return a}_inherits(b,a);_createClass(b,[{key:"create",value:function(a){for(var b=Date.now();;){if(Date.now()-b>this._options.timeLimit)return null;this._map=this._fillMap(1);this._dug=0;this._rooms=[];this._unconnected=[];this._generateRooms();if(!(2>this._rooms.length)&&this._generateCorridors())break}if(a)for(b=0;b<this._width;b++)for(var c=0;c<this._height;c++)a(b,c,this._map[b][c]);return this}},{key:"_generateRooms",value:function(){var a=
this._width-2,b=this._height-2;do{var c=this._generateRoom();if(this._dug/(a*b)>this._options.roomDugPercentage)break}while(c)}},{key:"_generateRoom",value:function(){for(var a=0;a<this._roomAttempts;){a++;var b=Z.createRandom(this._width,this._height,this._options);if(b.isValid(this._isWallCallback,this._canBeDugCallback))return b.create(this._digCallback),this._rooms.push(b),b}return null}},{key:"_generateCorridors",value:function(){for(var a=0;a<this._corridorAttempts;){a++;this._corridors=[];
this._map=this._fillMap(1);for(var b=0;b<this._rooms.length;b++){var c=this._rooms[b];c.clearDoors();c.create(this._digCallback)}this._unconnected=q.shuffle(this._rooms.slice());this._connected=[];for(this._unconnected.length&&this._connected.push(this._unconnected.pop());;){b=q.getItem(this._connected);if(!b)break;b=this._closestRoom(this._unconnected,b);if(!b)break;c=this._closestRoom(this._connected,b);if(!c)break;if(!this._connectRooms(b,c))break;if(!this._unconnected.length)return!0}}return!1}},
{key:"_closestRoom",value:function(a,b){var c=Infinity;b=b.getCenter();for(var d=null,e=0;e<a.length;e++){var k=a[e],g=k.getCenter(),h=g[0]-b[0];g=g[1]-b[1];h=h*h+g*g;h<c&&(c=h,d=k)}return d}},{key:"_connectRooms",value:function(a,b){var c=a.getCenter(),d=b.getCenter(),e=d[0]-c[0];c=d[1]-c[1];if(Math.abs(e)<Math.abs(c)){e=0<c?2:0;var g=(e+2)%4;var l=b.getLeft();var h=b.getRight();c=0}else e=0<e?1:3,g=(e+2)%4,l=b.getTop(),h=b.getBottom(),c=1;e=this._placeInWall(a,e);if(!e)return!1;if(e[c]>=l&&e[c]<=
h){d=e.slice();l=0;switch(g){case 0:l=b.getTop()-1;break;case 1:l=b.getRight()+1;break;case 2:l=b.getBottom()+1;break;case 3:l=b.getLeft()-1}d[(c+1)%2]=l;this._digLine([e,d])}else if(e[c]<l-1||e[c]>h+1){d=e[c]-d[c];l=0;switch(g){case 0:case 1:l=0>d?3:1;break;case 2:case 3:l=0>d?1:3}d=this._placeInWall(b,(g+l)%4);if(!d)return!1;g=[0,0];g[c]=e[c];c=(c+1)%2;g[c]=d[c];this._digLine([e,g,d])}else{l=(c+1)%2;d=this._placeInWall(b,g);if(!d)return!1;g=Math.round((d[l]+e[l])/2);h=[0,0];var m=[0,0];h[c]=e[c];
h[l]=g;m[c]=d[c];m[l]=g;this._digLine([e,h,m,d])}a.addDoor(e[0],e[1]);b.addDoor(d[0],d[1]);c=this._unconnected.indexOf(a);-1!=c&&(this._unconnected.splice(c,1),this._connected.push(a));c=this._unconnected.indexOf(b);-1!=c&&(this._unconnected.splice(c,1),this._connected.push(b));return!0}},{key:"_placeInWall",value:function(a,b){var c=[0,0],d=[0,0],e=0;switch(b){case 0:d=[1,0];c=[a.getLeft(),a.getTop()-1];e=a.getRight()-a.getLeft()+1;break;case 1:d=[0,1];c=[a.getRight()+1,a.getTop()];e=a.getBottom()-
a.getTop()+1;break;case 2:d=[1,0];c=[a.getLeft(),a.getBottom()+1];e=a.getRight()-a.getLeft()+1;break;case 3:d=[0,1],c=[a.getLeft()-1,a.getTop()],e=a.getBottom()-a.getTop()+1}a=[];b=-2;for(var g=0;g<e;g++){var h=c[0]+g*d[0],m=c[1]+g*d[1];a.push(null);1==this._map[h][m]?b!=g-1&&(a[g]=[h,m]):(b=g)&&(a[g-1]=null)}for(c=a.length-1;0<=c;c--)a[c]||a.splice(c,1);return a.length?q.getItem(a):null}},{key:"_digLine",value:function(a){for(var b=1;b<a.length;b++){var c=a[b-1],d=a[b];c=new aa(c[0],c[1],d[0],d[1]);
c.create(this._digCallback);this._corridors.push(c)}}},{key:"_digCallback",value:function(a,b,c){this._map[a][b]=c;0==c&&this._dug++}},{key:"_isWallCallback",value:function(a,b){return 0>a||0>b||a>=this._width||b>=this._height?!1:1==this._map[a][b]}},{key:"_canBeDugCallback",value:function(a,b){return 1>a||1>b||a+1>=this._width||b+1>=this._height?!1:1==this._map[a][b]}}]);return b}(t);y={Arena:y,Uniform:t};t=function(){function a(b){_classCallCheck(this,a);this._scheduler=b;this._lock=1}_createClass(a,
[{key:"start",value:function(){return this.unlock()}},{key:"lock",value:function(){this._lock++;return this}},{key:"unlock",value:function(){if(!this._lock)throw Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var a=this._scheduler.next();if(!a)return this.lock();(a=a.act())&&a.then&&(this.lock(),a.then(this.unlock.bind(this)))}return this}}]);return a}();var M={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,
0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,
209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,
128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,
196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,
184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],
red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,
238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};L=Object.freeze({fromString:I,add:function(a){for(var b=a.slice(),c=arguments.length,e=Array(1<c?c-1:0),f=1;f<c;f++)e[f-1]=arguments[f];for(c=0;3>c;c++)for(f=0;f<e.length;f++)b[c]+=e[f][c];return b},add_:Q,multiply:function(a){for(var b=a.slice(),c=arguments.length,e=Array(1<c?c-1:0),f=1;f<c;f++)e[f-1]=arguments[f];
for(c=0;3>c;c++){for(f=0;f<e.length;f++)b[c]*=e[f][c]/255;b[c]=Math.round(b[c])}return b},multiply_:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];for(b=0;3>b;b++){for(e=0;e<c.length;e++)a[b]*=c[e][b]/255;a[b]=Math.round(a[b])}return a},interpolate:R,lerp:R,interpolateHSL:S,lerpHSL:S,randomize:function(a,b){b instanceof Array||(b=Math.round(q.getNormal(0,b)));a=a.slice();for(var c=0;3>c;c++)a[c]+=b instanceof Array?Math.round(q.getNormal(0,b[c])):b;return a},
rgb2hsl:N,hsl2rgb:T,toRGB:function(a){a=a.map(function(a){return h(a,0,255)});return"rgb(".concat(a.join(","),")")},toHex:function(a){a=a.map(function(a){return h(a,0,255).toString(16).padStart(2,"0")});return"#".concat(a.join(""))}});var ba=function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,a);this._reflectivityCallback=b;c=Object.assign({passes:1,emissionThreshold:100,range:10},c);this._lights={};this._reflectivityCache={};this._fovCache=
{};this.setOptions(c)}_createClass(a,[{key:"setOptions",value:function(a){Object.assign(this._options,a);a&&a.range&&this.reset();return this}},{key:"setFOV",value:function(a){this._fov=a;this._fovCache={};return this}},{key:"setLight",value:function(a,c,e){a=a+","+c;e?this._lights[a]="string"==typeof e?I(e):e:delete this._lights[a];return this}},{key:"clearLights",value:function(){this._lights={}}},{key:"reset",value:function(){this._reflectivityCache={};this._fovCache={};return this}},{key:"compute",
value:function(a){var b={},c={},f={},g;for(g in this._lights){var h=this._lights[g];c[g]=[0,0,0];Q(c[g],h)}for(g=0;g<this._options.passes;g++)this._emitLight(c,f,b),g+1!=this._options.passes&&(c=this._computeEmitters(f,b));for(var k in f)c=k.split(","),b=parseInt(c[0]),c=parseInt(c[1]),a(b,c,f[k]);return this}},{key:"_emitLight",value:function(a,c,e){for(var b in a){var d=b.split(","),g=parseInt(d[0]);d=parseInt(d[1]);this._emitLightFromCell(g,d,a[b],c);e[b]=1}return this}},{key:"_computeEmitters",
value:function(a,c){var b={},d;for(d in a)if(!(d in c)){var g=a[d];if(d in this._reflectivityCache)var h=this._reflectivityCache[d];else{var k=d.split(",");h=parseInt(k[0]);k=parseInt(k[1]);h=this._reflectivityCallback(h,k);this._reflectivityCache[d]=h}if(0!=h){k=[0,0,0];for(var l=0,m=0;3>m;m++){var q=Math.round(g[m]*h);k[m]=q;l+=q}l>this._options.emissionThreshold&&(b[d]=k)}}return b}},{key:"_emitLightFromCell",value:function(a,c,e,f){var b=a+","+c;a=b in this._fovCache?this._fovCache[b]:this._updateFOV(a,
c);for(var d in a){c=a[d];d in f?b=f[d]:(b=[0,0,0],f[d]=b);for(var g=0;3>g;g++)b[g]+=Math.round(e[g]*c)}return this}},{key:"_updateFOV",value:function(a,c){var b={};this._fovCache[a+","+c]=b;var d=this._options.range;this._fov.compute(a,c,d,function(a,c,e,f){e=f*(1-e/d);0!=e&&(b[a+","+c]=e)}.bind(this));return b}}]);return a}();c.Util=W;c.Color=L;c.Text=H;c.RNG=q;c.Display=K;c.StringGenerator=J;c.EventQueue=U;c.Scheduler=D;c.FOV=A;c.Map=y;c.Engine=t;c.Lighting=ba;c.DEFAULT_WIDTH=80;c.DEFAULT_HEIGHT=
25;c.DIRS=E;c.KEYS={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,
VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,
VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,
VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};return c}({});
