var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,g){a!=Array.prototype&&a!=Object.prototype&&(a[d]=g.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,g,h){if(d){g=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var l=a[h];l in g||(g[l]={});g=g[l]}a=a[a.length-1];h=g[a];d=d(h);d!=h&&null!=d&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:d})}};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},d={};try{return d.__proto__=a,d.a}catch(g){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,d){a.__proto__=d;if(a.__proto__!==d)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.polyfill("Object.setPrototypeOf",function(a){return a||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,g,h){var d=this.length||0;0>g&&(g=Math.max(0,d+g));if(null==h||h>d)h=d;h=Number(h);0>h&&(h=Math.max(0,d+h));for(g=Number(g||0);g<h;g++)this[g]=a;return this}},"es6","es3");$jscomp.owns=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,d){for(var g=1;g<arguments.length;g++){var h=arguments[g];if(h)for(var l in h)$jscomp.owns(h,l)&&(a[l]=h[l])}return a};
$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(a){var d=0;return $jscomp.iteratorPrototype(function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var g=0,h={next:function(){if(g<a.length){var l=g++;return{value:d(l,a[l]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.checkStringArgs=function(a,d,g){if(null==a)throw new TypeError("The 'this' value for String.prototype."+g+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+g+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var d=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var h="";a;)if(a&1&&(h+=d),a>>>=1)d+=d;return h}},"es6","es3");$jscomp.stringPadding=function(a,d){a=void 0!==a?String(a):" ";return 0<d&&a?a.repeat(Math.ceil(d/a.length)).substring(0,d):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(a,g){var d=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(g,a-d.length)+d}},"es8","es3");function _typeof(a){_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return _typeof(a)}
function _slicedToArray(a,d){return _arrayWithHoles(a)||_iterableToArrayLimit(a,d)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}function _iterableToArrayLimit(a,d){var g=[],h=!0,l=!1,r=void 0;try{for(var u=a[Symbol.iterator](),m;!(h=(m=u.next()).done)&&(g.push(m.value),!d||g.length!==d);h=!0);}catch(w){l=!0,r=w}finally{try{if(!h&&null!=u["return"])u["return"]()}finally{if(l)throw r;}}return g}
function _arrayWithHoles(a){if(Array.isArray(a))return a}function _possibleConstructorReturn(a,d){return!d||"object"!==_typeof(d)&&"function"!==typeof d?_assertThisInitialized(a):d}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}
function _get(a,d,g){_get="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(a,d,g){if(a=_superPropBase(a,d))return d=Object.getOwnPropertyDescriptor(a,d),d.get?d.get.call(g):d.value};return _get(a,d,g||a)}function _superPropBase(a,d){for(;!Object.prototype.hasOwnProperty.call(a,d)&&(a=_getPrototypeOf(a),null!==a););return a}
function _getPrototypeOf(a){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return _getPrototypeOf(a)}function _inherits(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(d&&d.prototype,{constructor:{value:a,writable:!0,configurable:!0}});d&&_setPrototypeOf(a,d)}
function _setPrototypeOf(a,d){_setPrototypeOf=Object.setPrototypeOf||function(a,d){a.__proto__=d;return a};return _setPrototypeOf(a,d)}function _classCallCheck(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function _defineProperties(a,d){for(var g=0;g<d.length;g++){var h=d[g];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}
function _createClass(a,d,g){d&&_defineProperties(a.prototype,d);g&&_defineProperties(a,g);return a}
var ROT=function(a){function d(a,b){return(a%b+b)%b}function g(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return a<b?b:a>c?c:a}function h(a){return a.charAt(0).toUpperCase()+a.substring(1)}function l(a){for(var b=arguments.length,c=Array(1<b?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];var k=l.map;return a.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(b,e,f,d){if("%"==a.charAt(d-1))return b.substring(1);if(!c.length)return b;
f=(e||f).split(",");e=f.shift()||"";d=k[e.toLowerCase()];if(!d)return b;b=c.shift();b=b[d].apply(b,f);e=e.charAt(0);e!=e.toLowerCase()&&(b=h(b));return b})}function r(a,b){var c=[],e=0;a.replace(I,function(b,k,f,d){var E=a.substring(e,d);E.length&&c.push({type:0,value:E});c.push({type:"c"==k?2:3,value:f.trim()});e=d+b.length;return""});var k=a.substring(e);k.length&&c.push({type:0,value:k});return u(c,b)}function u(a,b){b||(b=Infinity);for(var c=0,e=0,k=-1;c<a.length;){var f=a[c];1==f.type&&(e=0,
k=-1);if(0!=f.type)c++;else{for(;0==e&&" "==f.value.charAt(0);)f.value=f.value.substring(1);var d=f.value.indexOf("\n");if(-1!=d){f.value=m(a,c,d,!0);for(d=f.value.split("");d.length&&" "==d[d.length-1];)d.pop();f.value=d.join("")}if(f.value.length){if(e+f.value.length>b){for(d=-1;;){var g=f.value.indexOf(" ",d+1);if(-1==g)break;if(e+g>b)break;d=g}-1!=d?f.value=m(a,c,d,!0):-1!=k?(c=a[k],f=c.value.lastIndexOf(" "),c.value=m(a,k,f,!0),c=k):f.value=m(a,c,b-e,!1)}else e+=f.value.length,-1!=f.value.indexOf(" ")&&
(k=c);c++}else a.splice(c,1)}}a.push({type:1});b=null;for(e=0;e<a.length;e++)switch(k=a[e],k.type){case 0:b=k;break;case 1:if(b){for(k=b.value.split("");k.length&&" "==k[k.length-1];)k.pop();b.value=k.join("")}b=null}a.pop();return a}function m(a,b,c,e){e={type:0,value:a[b].value.substring(c+(e?1:0))};a.splice(b+1,0,{type:1},e);return a[b].value.substring(0,c)}function w(a,b){for(var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,e=a.slice(),k=0;3>k;k++)e[k]=Math.round(e[k]+c*(b[k]-a[k]));
return e}function F(a,b){for(var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,e=B(a),k=B(b),f=0;3>f;f++)e[f]+=c*(k[f]-e[f]);return G(e)}function B(a){var b=a[0]/255,c=a[1]/255;a=a[2]/255;var e=Math.max(b,c,a),k=Math.min(b,c,a),f=0,d=(e+k)/2;if(e==k)k=0;else{var g=e-k;k=.5<d?g/(2-e-k):g/(e+k);switch(e){case b:f=(c-a)/g+(c<a?6:0);break;case c:f=(a-b)/g+2;break;case a:f=(b-c)/g+4}f/=6}return[f,k,d]}function C(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/
3-c)*6:a}function G(a){var b=a[2];if(0==a[1])return b=Math.round(255*b),[b,b,b];var c=a[1];c=.5>b?b*(1+c):b+c-b*c;var e=2*b-c;b=C(e,c,a[0]+1/3);var k=C(e,c,a[0]);a=C(e,c,a[0]-1/3);return[Math.round(255*b),Math.round(255*k),Math.round(255*a)]}var y=(new (function(){function a(){_classCallCheck(this,a);this._c=this._s2=this._s1=this._s0=this._seed=0}_createClass(a,[{key:"getSeed",value:function(){return this._seed}},{key:"setSeed",value:function(b){this._seed=b=1>b?1/b:b;this._s0=2.3283064365386963E-10*
(b>>>0);b=69069*b+1>>>0;this._s1=2.3283064365386963E-10*b;this._s2=2.3283064365386963E-10*(69069*b+1>>>0);this._c=1;return this}},{key:"getUniform",value:function(){var b=2091639*this._s0+2.3283064365386963E-10*this._c;this._s0=this._s1;this._s1=this._s2;this._c=b|0;return this._s2=b-this._c}},{key:"getUniformInt",value:function(b,c){var a=Math.max(b,c);b=Math.min(b,c);return Math.floor(this.getUniform()*(a-b+1))+b}},{key:"getNormal",value:function(){var b=0<arguments.length&&void 0!==arguments[0]?
arguments[0]:0,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;do{var a=2*this.getUniform()-1;var k=2*this.getUniform()-1;k=a*a+k*k}while(1<k||0==k);return b+a*Math.sqrt(-2*Math.log(k)/k)*c}},{key:"getPercentage",value:function(){return 1+Math.floor(100*this.getUniform())}},{key:"getItem",value:function(b){return b.length?b[Math.floor(this.getUniform()*b.length)]:null}},{key:"shuffle",value:function(b){var c=[];for(b=b.slice();b.length;){var a=b.indexOf(this.getItem(b));c.push(b.splice(a,
1)[0])}return c}},{key:"getWeightedValue",value:function(b){var c=0;for(k in b)c+=b[k];c*=this.getUniform();var a;var k=0;for(a in b)if(k+=b[a],c<k)break;return a}},{key:"getState",value:function(){return[this._s0,this._s1,this._s2,this._c]}},{key:"setState",value:function(b){this._s0=b[0];this._s1=b[1];this._s2=b[2];this._c=b[3];return this}},{key:"clone",value:function(){return(new a).setState(this.getState())}}]);return a}())).setSeed(Date.now()),v=function(){function a(b){_classCallCheck(this,
a);this._context=b}_createClass(a,[{key:"compute",value:function(b){this._options=b}}]);return a}();l.map={s:"toString"};var J=Object.freeze({mod:d,clamp:g,capitalize:h,format:l}),z=function(a){function b(c){_classCallCheck(this,b);c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,c));c._spacingX=0;c._spacingY=0;c._hexSize=0;return c}_inherits(b,a);_createClass(b,[{key:"compute",value:function(c){_get(_getPrototypeOf(b.prototype),"compute",this).call(this,c);var a=Math.ceil(this._context.measureText("W").width);
this._hexSize=Math.floor(c.spacing*(c.fontSize+a/Math.sqrt(3))/2);this._spacingX=this._hexSize*Math.sqrt(3)/2;this._spacingY=1.5*this._hexSize;if(c.transpose){a="height";var k="width"}else a="width",k="height";this._context.canvas[a]=Math.ceil((c.width+1)*this._spacingX);this._context.canvas[k]=Math.ceil((c.height-1)*this._spacingY+2*this._hexSize)}},{key:"draw",value:function(b,a){b=_slicedToArray(b,5);var c=b[2],e=b[3],d=b[4];b=[(b[0]+1)*this._spacingX,b[1]*this._spacingY+this._hexSize];this._options.transpose&&
b.reverse();a&&(this._context.fillStyle=d,this._fill(b[0],b[1]));if(c)for(this._context.fillStyle=e,a=[].concat(c),c=0;c<a.length;c++)this._context.fillText(a[c],b[0],Math.ceil(b[1]))}},{key:"computeSize",value:function(b,a){this._options.transpose&&(b+=a,a=b-a,b-=a);return[Math.floor(b/this._spacingX)-1,Math.floor((a-2*this._hexSize)/this._spacingY+1)]}},{key:"computeFontSize",value:function(b,a){this._options.transpose&&(b+=a,a=b-a,b-=a);b=Math.min(2*b/((this._options.width+1)*Math.sqrt(3))-1,a/
(2+1.5*(this._options.height-1)));a=this._context.font;this._context.font="100px "+this._options.fontFamily;var c=Math.ceil(this._context.measureText("W").width);this._context.font=a;b=Math.floor(b)+1;return Math.ceil(2*b/(this._options.spacing*(1+c/100/Math.sqrt(3))))-1}},{key:"eventToPosition",value:function(b,a){if(this._options.transpose){b+=a;a=b-a;b-=a;var c=this._context.canvas.width}else c=this._context.canvas.height;a=Math.floor(a/(c/this._options.height));d(a,2)?(b-=this._spacingX,b=1+2*
Math.floor(b/(2*this._spacingX))):b=2*Math.floor(b/(2*this._spacingX));return[b,a]}},{key:"_fill",value:function(b,a){var c=this._hexSize,e=this._options.border;this._context.beginPath();this._options.transpose?(this._context.moveTo(b-c+e,a),this._context.lineTo(b-c/2+e,a+this._spacingX-e),this._context.lineTo(b+c/2-e,a+this._spacingX-e),this._context.lineTo(b+c-e,a),this._context.lineTo(b+c/2-e,a-this._spacingX+e),this._context.lineTo(b-c/2+e,a-this._spacingX+e),this._context.lineTo(b-c+e,a)):(this._context.moveTo(b,
a-c+e),this._context.lineTo(b+this._spacingX-e,a-c/2+e),this._context.lineTo(b+this._spacingX-e,a+c/2-e),this._context.lineTo(b,a+c-e),this._context.lineTo(b-this._spacingX+e,a+c/2-e),this._context.lineTo(b-this._spacingX+e,a-c/2+e),this._context.lineTo(b,a-c+e));this._context.fill()}}]);return b}(v),n=function(a){function b(c){_classCallCheck(this,b);c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,c));c._spacingX=0;c._spacingY=0;c._canvasCache={};return c}_inherits(b,a);_createClass(b,
[{key:"compute",value:function(c){_get(_getPrototypeOf(b.prototype),"compute",this).call(this,c);this._canvasCache={};var a=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(c.spacing*a);this._spacingY=Math.ceil(c.spacing*c.fontSize);this._options.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY));this._context.canvas.width=c.width*this._spacingX;this._context.canvas.height=c.height*this._spacingY}},{key:"draw",value:function(c,a){b.cache?
this._drawWithCache(c):this._drawNoCache(c,a)}},{key:"_drawWithCache",value:function(b){var a=_slicedToArray(b,5);b=a[0];var c=a[1],d=a[2],f=a[3],g=a[4];a=""+d+f+g;if(a in this._canvasCache)var h=this._canvasCache[a];else{var x=this._options.border;h=document.createElement("canvas");var l=h.getContext("2d");h.width=this._spacingX;h.height=this._spacingY;l.fillStyle=g;l.fillRect(x,x,h.width-x,h.height-x);if(d)for(l.fillStyle=f,l.font=this._context.font,l.textAlign="center",l.textBaseline="middle",
d=[].concat(d),f=0;f<d.length;f++)l.fillText(d[f],this._spacingX/2,Math.ceil(this._spacingY/2));this._canvasCache[a]=h}this._context.drawImage(h,b*this._spacingX,c*this._spacingY)}},{key:"_drawNoCache",value:function(b,a){var c=_slicedToArray(b,5);b=c[0];var e=c[1],d=c[2],f=c[3];c=c[4];a&&(a=this._options.border,this._context.fillStyle=c,this._context.fillRect(b*this._spacingX+a,e*this._spacingY+a,this._spacingX-a,this._spacingY-a));if(d)for(this._context.fillStyle=f,a=[].concat(d),d=0;d<a.length;d++)this._context.fillText(a[d],
(b+.5)*this._spacingX,Math.ceil((e+.5)*this._spacingY))}},{key:"computeSize",value:function(b,a){return[Math.floor(b/this._spacingX),Math.floor(a/this._spacingY)]}},{key:"computeFontSize",value:function(b,a){b=Math.floor(b/this._options.width);a=Math.floor(a/this._options.height);var c=this._context.font;this._context.font="100px "+this._options.fontFamily;var e=Math.ceil(this._context.measureText("W").width);this._context.font=c;b=e/100*a/b;1<b&&(a=Math.floor(a/b));return Math.floor(a/this._options.spacing)}},
{key:"eventToPosition",value:function(b,a){return[Math.floor(b/this._spacingX),Math.floor(a/this._spacingY)]}}]);return b}(v);n.cache=!1;var t=function(a){function b(a){_classCallCheck(this,b);a=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a));a._colorCanvas=document.createElement("canvas");return a}_inherits(b,a);_createClass(b,[{key:"compute",value:function(a){_get(_getPrototypeOf(b.prototype),"compute",this).call(this,a);this._context.canvas.width=a.width*a.tileWidth;this._context.canvas.height=
a.height*a.tileHeight;this._colorCanvas.width=a.tileWidth;this._colorCanvas.height=a.tileHeight}},{key:"draw",value:function(b,a){var c=_slicedToArray(b,5);b=c[0];var e=c[1],d=c[2],f=c[3],g=c[4];c=this._options.tileWidth;var h=this._options.tileHeight;a&&(this._options.tileColorize?this._context.clearRect(b*c,e*h,c,h):(this._context.fillStyle=g,this._context.fillRect(b*c,e*h,c,h)));if(d)for(a=[].concat(d),f=[].concat(f),g=[].concat(g),d=0;d<a.length;d++){var l=this._options.tileMap[a[d]];if(!l)throw Error("Char '"+
a[d]+"' not found in tileMap");if(this._options.tileColorize){var m=this._colorCanvas,q=m.getContext("2d");q.globalCompositeOperation="source-over";q.clearRect(0,0,c,h);var n=f[d],p=g[d];q.drawImage(this._options.tileSet,l[0],l[1],c,h,0,0,c,h);"transparent"!=n&&(q.fillStyle=n,q.globalCompositeOperation="source-atop",q.fillRect(0,0,c,h));"transparent"!=p&&(q.fillStyle=p,q.globalCompositeOperation="destination-over",q.fillRect(0,0,c,h));this._context.drawImage(m,b*c,e*h,c,h)}else this._context.drawImage(this._options.tileSet,
l[0],l[1],c,h,b*c,e*h,c,h)}}},{key:"computeSize",value:function(b,a){return[Math.floor(b/this._options.tileWidth),Math.floor(a/this._options.tileHeight)]}},{key:"computeFontSize",value:function(){throw Error("Tile backend does not understand font size");}},{key:"eventToPosition",value:function(b,a){return[Math.floor(b/this._options.tileWidth),Math.floor(a/this._options.tileHeight)]}}]);return b}(v),I=/%([bc]){([^}]*)}/g;v=Object.freeze({TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(a,
b){var c={width:0,height:1};a=r(a,b);for(var e=b=0;e<a.length;e++){var d=a[e];switch(d.type){case 0:b+=d.value.length;break;case 1:c.height++,c.width=Math.max(c.width,b),b=0}}c.width=Math.max(c.width,b);return c},tokenize:r});var K={hex:z,rect:n,tile:t},L={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1,termColor:"xterm"},A=function(){function a(){var b=
0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,a);this._context=document.createElement("canvas").getContext("2d");this._data={};this._dirty=!1;this._options={};b=Object.assign({},L,b);this.setOptions(b);this.DEBUG=this.DEBUG.bind(this);this._tick=this._tick.bind(this);requestAnimationFrame(this._tick)}_createClass(a,[{key:"DEBUG",value:function(b,a,e){var c=[this._options.bg,this._options.fg];this.draw(b,a,null,null,c[e%c.length])}},{key:"clear",value:function(){this._data=
{};this._dirty=!0}},{key:"setOptions",value:function(b){Object.assign(this._options,b);if(b.width||b.height||b.fontSize||b.fontFamily||b.spacing||b.layout)b.layout&&(this._backend=new K[b.layout](this._context)),b=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily,this._context.font=b,this._backend.compute(this._options),this._context.font=b,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=!0;return this}},
{key:"getOptions",value:function(){return this._options}},{key:"getContainer",value:function(){return this._context.canvas}},{key:"computeSize",value:function(b,a){return this._backend.computeSize(b,a)}},{key:"computeFontSize",value:function(b,a){return this._backend.computeFontSize(b,a)}},{key:"eventToPosition",value:function(b){if("touches"in b){var a=b.touches[0].clientX;b=b.touches[0].clientY}else a=b.clientX,b=b.clientY;var e=this._context.canvas.getBoundingClientRect();a-=e.left;b-=e.top;a*=
this._context.canvas.width/e.width;b*=this._context.canvas.height/e.height;return 0>a||0>b||a>=this._context.canvas.width||b>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(a,b)}},{key:"draw",value:function(b,a,e,d,f){d||(d=this._options.fg);f||(f=this._options.bg);var c="".concat(b,",").concat(a);this._data[c]=[b,a,e,d,f];!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[c]=!0)}},{key:"drawText",value:function(b,a,e,d){var c=null,f=null,k=b,h=1;d||(d=this._options.width-
b);for(e=r(e,d);e.length;)switch(d=e.shift(),d.type){case 0:for(var g,l=!1,m,q=!1,n=0;n<d.value.length;n++){g=d.value.charCodeAt(n);var p=d.value.charAt(n);m=65280<g&&65377>g||65500<g&&65512>g||65518<g;g=32==p.charCodeAt(0)||12288==p.charCodeAt(0);!q||m||g||k++;m&&!l&&k++;this.draw(k++,a,p,c,f);l=g;q=m}break;case 2:c=d.value||null;break;case 3:f=d.value||null;break;case 1:k=b,a++,h++}return h}},{key:"_tick",value:function(){requestAnimationFrame(this._tick);if(this._dirty){if(!0===this._dirty){this._context.fillStyle=
this._options.bg;this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height);for(var b in this._data)this._draw(b,!1)}else for(var a in this._dirty)this._draw(a,!0);this._dirty=!1}}},{key:"_draw",value:function(b,a){b=this._data[b];b[4]!=this._options.bg&&(a=!0);this._backend.draw(b,a)}}]);return a}();A.Rect=n;A.Hex=z;A.Tile=t;z=function(){function a(b){_classCallCheck(this,a);this._options={words:!1,order:3,prior:.001};Object.assign(this._options,b);this._suffix=this._boundary=
String.fromCharCode(0);this._prefix=[];for(b=0;b<this._options.order;b++)this._prefix.push(this._boundary);this._priorValues={};this._priorValues[this._boundary]=this._options.prior;this._data={}}_createClass(a,[{key:"clear",value:function(){this._data={};this._priorValues={}}},{key:"generate",value:function(){for(var b=[this._sample(this._prefix)];b[b.length-1]!=this._boundary;)b.push(this._sample(b));return this._join(b.slice(0,-1))}},{key:"observe",value:function(b){b=this._split(b);for(var a=
0;a<b.length;a++)this._priorValues[b[a]]=this._options.prior;b=this._prefix.concat(b).concat(this._suffix);for(a=this._options.order;a<b.length;a++)for(var e=b.slice(a-this._options.order,a),d=b[a],f=0;f<e.length;f++){var g=e.slice(f);this._observeEvent(g,d)}}},{key:"getStats",value:function(){var b=[],a=Object.keys(this._priorValues).length;a--;b.push("distinct samples: "+a);a=Object.keys(this._data).length;var e=0,d;for(d in this._data)e+=Object.keys(this._data[d]).length;b.push("dictionary size (contexts): "+
a);b.push("dictionary size (events): "+e);return b.join(", ")}},{key:"_split",value:function(b){return b.split(this._options.words?/\s+/:"")}},{key:"_join",value:function(b){return b.join(this._options.words?" ":"")}},{key:"_observeEvent",value:function(b,a){b=this._join(b);b in this._data||(this._data[b]={});b=this._data[b];a in b||(b[a]=0);b[a]++}},{key:"_sample",value:function(b){b=this._backoff(b);b=this._join(b);b=this._data[b];var a={};if(this._options.prior){for(var d in this._priorValues)a[d]=
this._priorValues[d];for(var f in b)a[f]+=b[f]}else a=b;return y.getWeightedValue(a)}},{key:"_backoff",value:function(b){for(b.length>this._options.order?b=b.slice(-this._options.order):b.length<this._options.order&&(b=this._prefix.slice(0,this._options.order-b.length).concat(b));!(this._join(b)in this._data)&&0<b.length;)b=b.slice(1);return b}}]);return a}();var H=function(){function a(){_classCallCheck(this,a);this._time=0;this._events=[];this._eventTimes=[]}_createClass(a,[{key:"getTime",value:function(){return this._time}},
{key:"clear",value:function(){this._events=[];this._eventTimes=[];return this}},{key:"add",value:function(b,a){for(var c=this._events.length,d=0;d<this._eventTimes.length;d++)if(this._eventTimes[d]>a){c=d;break}this._events.splice(c,0,b);this._eventTimes.splice(c,0,a)}},{key:"get",value:function(){if(!this._events.length)return null;var b=this._eventTimes.splice(0,1)[0];if(0<b){this._time+=b;for(var a=0;a<this._eventTimes.length;a++)this._eventTimes[a]-=b}return this._events.splice(0,1)[0]}},{key:"getEventTime",
value:function(b){b=this._events.indexOf(b);if(-1!=b)return this._eventTimes[b]}},{key:"remove",value:function(b){b=this._events.indexOf(b);if(-1==b)return!1;this._remove(b);return!0}},{key:"_remove",value:function(b){this._events.splice(b,1);this._eventTimes.splice(b,1)}}]);return a}(),p=function(){function a(){_classCallCheck(this,a);this._queue=new H;this._repeat=[];this._current=null}_createClass(a,[{key:"getTime",value:function(){return this._queue.getTime()}},{key:"add",value:function(b,a){a&&
this._repeat.push(b);return this}},{key:"getTimeOf",value:function(b){return this._queue.getEventTime(b)}},{key:"clear",value:function(){this._queue.clear();this._repeat=[];this._current=null;return this}},{key:"remove",value:function(b){var a=this._queue.remove(b),d=this._repeat.indexOf(b);-1!=d&&this._repeat.splice(d,1);this._current==b&&(this._current=null);return a}},{key:"next",value:function(){return this._current=this._queue.get()}}]);return a}();n=function(a){function b(){_classCallCheck(this,
b);return _possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}_inherits(b,a);_createClass(b,[{key:"add",value:function(a,d){this._queue.add(a,0);return _get(_getPrototypeOf(b.prototype),"add",this).call(this,a,d)}},{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0);return _get(_getPrototypeOf(b.prototype),"next",this).call(this)}}]);return b}(p);t=function(a){function b(){_classCallCheck(this,b);return _possibleConstructorReturn(this,
_getPrototypeOf(b).apply(this,arguments))}_inherits(b,a);_createClass(b,[{key:"add",value:function(a,d,f){this._queue.add(a,void 0!==f?f:1/a.getSpeed());return _get(_getPrototypeOf(b.prototype),"add",this).call(this,a,d)}},{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed());return _get(_getPrototypeOf(b.prototype),"next",this).call(this)}}]);return b}(p);p=function(a){function b(){_classCallCheck(this,b);var a=
_possibleConstructorReturn(this,_getPrototypeOf(b).call(this));a._defaultDuration=1;a._duration=a._defaultDuration;return a}_inherits(b,a);_createClass(b,[{key:"add",value:function(a,d,f){this._queue.add(a,f||this._defaultDuration);return _get(_getPrototypeOf(b.prototype),"add",this).call(this,a,d)}},{key:"clear",value:function(){this._duration=this._defaultDuration;return _get(_getPrototypeOf(b.prototype),"clear",this).call(this)}},{key:"remove",value:function(a){a==this._current&&(this._duration=
this._defaultDuration);return _get(_getPrototypeOf(b.prototype),"remove",this).call(this,a)}},{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration);return _get(_getPrototypeOf(b.prototype),"next",this).call(this)}},{key:"setDuration",value:function(a){this._current&&(this._duration=a);return this}}]);return b}(p);n={Simple:n,Speed:t,Action:p};t=function(){function a(b){_classCallCheck(this,
a);this._scheduler=b;this._lock=1}_createClass(a,[{key:"start",value:function(){return this.unlock()}},{key:"lock",value:function(){this._lock++;return this}},{key:"unlock",value:function(){if(!this._lock)throw Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var a=this._scheduler.next();if(!a)return this.lock();(a=a.act())&&a.then&&(this.lock(),a.then(this.unlock.bind(this)))}return this}}]);return a}();var D={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],
blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],
darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,
0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,
255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,
60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,
240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,
239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};p=Object.freeze({fromString:function(a){var b;if(a in D)var c=D[a];else{if("#"==a.charAt(0))if(c=(a.match(/[0-9a-f]/gi)||[]).map(function(a){return parseInt(a,16)}),3==c.length)c=c.map(function(a){return 17*a});else for(b=0;3>b;b++)c[b+1]+=16*c[b],c.splice(b,1);
else c=(b=a.match(/rgb\(([0-9, ]+)\)/i))?b[1].split(/\s*,\s*/).map(function(a){return parseInt(a)}):[0,0,0];D[a]=c}return c.slice()},add:function(a){for(var b=a.slice(),c=arguments.length,d=Array(1<c?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];for(c=0;3>c;c++)for(f=0;f<d.length;f++)b[c]+=d[f][c];return b},add_:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];for(b=0;3>b;b++)for(d=0;d<c.length;d++)a[b]+=c[d][b];return a},multiply:function(a){for(var b=a.slice(),
c=arguments.length,d=Array(1<c?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];for(c=0;3>c;c++){for(f=0;f<d.length;f++)b[c]*=d[f][c]/255;b[c]=Math.round(b[c])}return b},multiply_:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];for(b=0;3>b;b++){for(d=0;d<c.length;d++)a[b]*=c[d][b]/255;a[b]=Math.round(a[b])}return a},interpolate:w,lerp:w,interpolateHSL:F,lerpHSL:F,randomize:function(a,b){b instanceof Array||(b=Math.round(y.getNormal(0,b)));a=a.slice();for(var c=0;3>
c;c++)a[c]+=b instanceof Array?Math.round(y.getNormal(0,b[c])):b;return a},rgb2hsl:B,hsl2rgb:G,toRGB:function(a){a=a.map(function(a){return g(a,0,255)});return"rgb(".concat(a.join(","),")")},toHex:function(a){a=a.map(function(a){return g(a,0,255).toString(16).padStart(2,"0")});return"#".concat(a.join(""))}});a.Util=J;a.Color=p;a.Text=v;a.RNG=y;a.Display=A;a.StringGenerator=z;a.EventQueue=H;a.Scheduler=n;a.Engine=t;a.DEFAULT_WIDTH=80;a.DEFAULT_HEIGHT=25;a.DIRS={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,
-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]};a.KEYS={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,
VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,
VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,
VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};return a}({});
