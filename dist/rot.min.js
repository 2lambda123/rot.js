var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,g){b!=Array.prototype&&b!=Object.prototype&&(b[e]=g.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,e,g,k){if(e){g=$jscomp.global;b=b.split(".");for(k=0;k<b.length-1;k++){var n=b[k];n in g||(g[n]={});g=g[n]}b=b[b.length-1];k=g[b];e=e(k);e!=k&&null!=e&&$jscomp.defineProperty(g,b,{configurable:!0,writable:!0,value:e})}};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},e={};try{return e.__proto__=b,e.a}catch(g){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,e){b.__proto__=e;if(b.__proto__!==e)throw new TypeError(b+" is not extensible");return b}:null;$jscomp.polyfill("Object.setPrototypeOf",function(b){return b||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(b,g,k){var e=this.length||0;0>g&&(g=Math.max(0,e+g));if(null==k||k>e)k=e;k=Number(k);0>k&&(k=Math.max(0,e+k));for(g=Number(g||0);g<k;g++)this[g]=b;return this}},"es6","es3");$jscomp.owns=function(b,e){return Object.prototype.hasOwnProperty.call(b,e)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(b,e){for(var g=1;g<arguments.length;g++){var k=arguments[g];if(k)for(var n in k)$jscomp.owns(k,n)&&(b[n]=k[n])}return b};
$jscomp.polyfill("Object.assign",function(b){return b||$jscomp.assign},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(b){var e=0;return $jscomp.iteratorPrototype(function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,e){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var g=0,k={next:function(){if(g<b.length){var n=g++;return{value:e(n,b[n]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};
$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.checkStringArgs=function(b,e,g){if(null==b)throw new TypeError("The 'this' value for String.prototype."+g+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+g+" must not be a regular expression");return b+""};
$jscomp.polyfill("String.prototype.repeat",function(b){return b?b:function(b){var e=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var k="";b;)if(b&1&&(k+=e),b>>>=1)e+=e;return k}},"es6","es3");$jscomp.stringPadding=function(b,e){b=void 0!==b?String(b):" ";return 0<e&&b?b.repeat(Math.ceil(e/b.length)).substring(0,e):""};
$jscomp.polyfill("String.prototype.padStart",function(b){return b?b:function(b,g){var e=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(g,b-e.length)+e}},"es8","es3");function _typeof(b){_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};return _typeof(b)}
function _slicedToArray(b,e){return _arrayWithHoles(b)||_iterableToArrayLimit(b,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}function _iterableToArrayLimit(b,e){var g=[],k=!0,n=!1,C=void 0;try{for(var D=b[Symbol.iterator](),v;!(k=(v=D.next()).done)&&(g.push(v.value),!e||g.length!==e);k=!0);}catch(F){n=!0,C=F}finally{try{if(!k&&null!=D["return"])D["return"]()}finally{if(n)throw C;}}return g}
function _arrayWithHoles(b){if(Array.isArray(b))return b}function _possibleConstructorReturn(b,e){return!e||"object"!==_typeof(e)&&"function"!==typeof e?_assertThisInitialized(b):e}function _assertThisInitialized(b){if(void 0===b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}
function _get(b,e,g){_get="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(b,e,g){if(b=_superPropBase(b,e))return e=Object.getOwnPropertyDescriptor(b,e),e.get?e.get.call(g):e.value};return _get(b,e,g||b)}function _superPropBase(b,e){for(;!Object.prototype.hasOwnProperty.call(b,e)&&(b=_getPrototypeOf(b),null!==b););return b}
function _getPrototypeOf(b){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)};return _getPrototypeOf(b)}function _inherits(b,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");b.prototype=Object.create(e&&e.prototype,{constructor:{value:b,writable:!0,configurable:!0}});e&&_setPrototypeOf(b,e)}
function _setPrototypeOf(b,e){_setPrototypeOf=Object.setPrototypeOf||function(b,e){b.__proto__=e;return b};return _setPrototypeOf(b,e)}function _classCallCheck(b,e){if(!(b instanceof e))throw new TypeError("Cannot call a class as a function");}function _defineProperties(b,e){for(var g=0;g<e.length;g++){var k=e[g];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(b,k.key,k)}}
function _createClass(b,e,g){e&&_defineProperties(b.prototype,e);g&&_defineProperties(b,g);return b}
var ROT=function(b){function e(b,a){return(b%a+a)%a}function g(b){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return b<a?a:b>c?c:b}function k(b){return b.charAt(0).toUpperCase()+b.substring(1)}function n(b){for(var a=arguments.length,c=Array(1<a?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];var f=n.map;return b.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(a,d,m,e){if("%"==b.charAt(e-1))return a.substring(1);if(!c.length)return a;
m=(d||m).split(",");d=m.shift()||"";e=f[d.toLowerCase()];if(!e)return a;a=c.shift();a=a[e].apply(a,m);d=d.charAt(0);d!=d.toLowerCase()&&(a=k(a));return a})}function C(b,a){var c=[],d=0;b.replace(S,function(a,f,m,e){var h=b.substring(d,e);h.length&&c.push({type:0,value:h});c.push({type:"c"==f?2:3,value:m.trim()});d=e+a.length;return""});var f=b.substring(d);f.length&&c.push({type:0,value:f});return D(c,a)}function D(b,a){a||(a=Infinity);for(var c=0,d=0,f=-1;c<b.length;){var h=b[c];1==h.type&&(d=0,
f=-1);if(0!=h.type)c++;else{for(;0==d&&" "==h.value.charAt(0);)h.value=h.value.substring(1);var l=h.value.indexOf("\n");if(-1!=l){h.value=v(b,c,l,!0);for(l=h.value.split("");l.length&&" "==l[l.length-1];)l.pop();h.value=l.join("")}if(h.value.length){if(d+h.value.length>a){for(l=-1;;){var m=h.value.indexOf(" ",l+1);if(-1==m)break;if(d+m>a)break;l=m}-1!=l?h.value=v(b,c,l,!0):-1!=f?(c=b[f],h=c.value.lastIndexOf(" "),c.value=v(b,f,h,!0),c=f):h.value=v(b,c,a-d,!1)}else d+=h.value.length,-1!=h.value.indexOf(" ")&&
(f=c);c++}else b.splice(c,1)}}b.push({type:1});a=null;for(d=0;d<b.length;d++)switch(f=b[d],f.type){case 0:a=f;break;case 1:if(a){for(f=a.value.split("");f.length&&" "==f[f.length-1];)f.pop();a.value=f.join("")}a=null}b.pop();return b}function v(b,a,c,d){d={type:0,value:b[a].value.substring(c+(d?1:0))};b.splice(a+1,0,{type:1},d);return b[a].value.substring(0,c)}function F(b){var a;if(b in K)var c=K[b];else{if("#"==b.charAt(0))if(c=(b.match(/[0-9a-f]/gi)||[]).map(function(a){return parseInt(a,16)}),
3==c.length)c=c.map(function(a){return 17*a});else for(a=0;3>a;a++)c[a+1]+=16*c[a],c.splice(a,1);else c=(a=b.match(/rgb\(([0-9, ]+)\)/i))?a[1].split(/\s*,\s*/).map(function(a){return parseInt(a)}):[0,0,0];K[b]=c}return c.slice()}function N(b){for(var a=arguments.length,c=Array(1<a?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];for(a=0;3>a;a++)for(d=0;d<c.length;d++)b[a]+=c[d][a];return b}function O(b,a){for(var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,d=b.slice(),f=0;3>f;f++)d[f]=Math.round(d[f]+
c*(a[f]-b[f]));return d}function P(b,a){for(var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,d=L(b),f=L(a),h=0;3>h;h++)d[h]+=c*(f[h]-d[h]);return Q(d)}function L(b){var a=b[0]/255,c=b[1]/255;b=b[2]/255;var d=Math.max(a,c,b),f=Math.min(a,c,b),h=0,l=(d+f)/2;if(d==f)f=0;else{var m=d-f;f=.5<l?m/(2-d-f):m/(d+f);switch(d){case a:h=(c-b)/m+(c<b?6:0);break;case c:h=(b-a)/m+2;break;case b:h=(a-c)/m+4}h/=6}return[h,f,l]}function M(b,a,c){0>c&&(c+=1);1<c&&--c;return c<1/6?b+6*(a-b)*c:.5>c?a:c<
2/3?b+(a-b)*(2/3-c)*6:b}function Q(b){var a=b[2];if(0==b[1])return a=Math.round(255*a),[a,a,a];var c=b[1];c=.5>a?a*(1+c):a+c-a*c;var d=2*a-c;a=M(d,c,b[0]+1/3);var f=M(d,c,b[0]);b=M(d,c,b[0]-1/3);return[Math.round(255*a),Math.round(255*f),Math.round(255*b)]}var G=(new (function(){function b(){_classCallCheck(this,b);this._c=this._s2=this._s1=this._s0=this._seed=0}_createClass(b,[{key:"getSeed",value:function(){return this._seed}},{key:"setSeed",value:function(a){this._seed=a=1>a?1/a:a;this._s0=2.3283064365386963E-10*
(a>>>0);a=69069*a+1>>>0;this._s1=2.3283064365386963E-10*a;this._s2=2.3283064365386963E-10*(69069*a+1>>>0);this._c=1;return this}},{key:"getUniform",value:function(){var a=2091639*this._s0+2.3283064365386963E-10*this._c;this._s0=this._s1;this._s1=this._s2;this._c=a|0;return this._s2=a-this._c}},{key:"getUniformInt",value:function(a,c){var d=Math.max(a,c);a=Math.min(a,c);return Math.floor(this.getUniform()*(d-a+1))+a}},{key:"getNormal",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?
arguments[0]:0,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;do{var d=2*this.getUniform()-1;var f=2*this.getUniform()-1;f=d*d+f*f}while(1<f||0==f);return a+d*Math.sqrt(-2*Math.log(f)/f)*c}},{key:"getPercentage",value:function(){return 1+Math.floor(100*this.getUniform())}},{key:"getItem",value:function(a){return a.length?a[Math.floor(this.getUniform()*a.length)]:null}},{key:"shuffle",value:function(a){var c=[];for(a=a.slice();a.length;){var d=a.indexOf(this.getItem(a));c.push(a.splice(d,
1)[0])}return c}},{key:"getWeightedValue",value:function(a){var c=0;for(f in a)c+=a[f];c*=this.getUniform();var d;var f=0;for(d in a)if(f+=a[d],c<f)break;return d}},{key:"getState",value:function(){return[this._s0,this._s1,this._s2,this._c]}},{key:"setState",value:function(a){this._s0=a[0];this._s1=a[1];this._s2=a[2];this._c=a[3];return this}},{key:"clone",value:function(){return(new b).setState(this.getState())}}]);return b}())).setSeed(Date.now()),E=function(){function b(a){_classCallCheck(this,
b);this._context=a}_createClass(b,[{key:"compute",value:function(a){this._options=a}}]);return b}();n.map={s:"toString"};var T=Object.freeze({mod:e,clamp:g,capitalize:k,format:n}),H=function(b){function a(c){_classCallCheck(this,a);c=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,c));c._spacingX=0;c._spacingY=0;c._hexSize=0;return c}_inherits(a,b);_createClass(a,[{key:"compute",value:function(c){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,c);var d=Math.ceil(this._context.measureText("W").width);
this._hexSize=Math.floor(c.spacing*(c.fontSize+d/Math.sqrt(3))/2);this._spacingX=this._hexSize*Math.sqrt(3)/2;this._spacingY=1.5*this._hexSize;if(c.transpose){d="height";var b="width"}else d="width",b="height";this._context.canvas[d]=Math.ceil((c.width+1)*this._spacingX);this._context.canvas[b]=Math.ceil((c.height-1)*this._spacingY+2*this._hexSize)}},{key:"draw",value:function(a,d){a=_slicedToArray(a,5);var c=a[2],b=a[3],l=a[4];a=[(a[0]+1)*this._spacingX,a[1]*this._spacingY+this._hexSize];this._options.transpose&&
a.reverse();d&&(this._context.fillStyle=l,this._fill(a[0],a[1]));if(c)for(this._context.fillStyle=b,d=[].concat(c),c=0;c<d.length;c++)this._context.fillText(d[c],a[0],Math.ceil(a[1]))}},{key:"computeSize",value:function(a,d){this._options.transpose&&(a+=d,d=a-d,a-=d);return[Math.floor(a/this._spacingX)-1,Math.floor((d-2*this._hexSize)/this._spacingY+1)]}},{key:"computeFontSize",value:function(a,d){this._options.transpose&&(a+=d,d=a-d,a-=d);a=Math.min(2*a/((this._options.width+1)*Math.sqrt(3))-1,d/
(2+1.5*(this._options.height-1)));d=this._context.font;this._context.font="100px "+this._options.fontFamily;var c=Math.ceil(this._context.measureText("W").width);this._context.font=d;a=Math.floor(a)+1;return Math.ceil(2*a/(this._options.spacing*(1+c/100/Math.sqrt(3))))-1}},{key:"eventToPosition",value:function(a,d){if(this._options.transpose){a+=d;d=a-d;a-=d;var c=this._context.canvas.width}else c=this._context.canvas.height;d=Math.floor(d/(c/this._options.height));e(d,2)?(a-=this._spacingX,a=1+2*
Math.floor(a/(2*this._spacingX))):a=2*Math.floor(a/(2*this._spacingX));return[a,d]}},{key:"_fill",value:function(a,d){var c=this._hexSize,b=this._options.border;this._context.beginPath();this._options.transpose?(this._context.moveTo(a-c+b,d),this._context.lineTo(a-c/2+b,d+this._spacingX-b),this._context.lineTo(a+c/2-b,d+this._spacingX-b),this._context.lineTo(a+c-b,d),this._context.lineTo(a+c/2-b,d-this._spacingX+b),this._context.lineTo(a-c/2+b,d-this._spacingX+b),this._context.lineTo(a-c+b,d)):(this._context.moveTo(a,
d-c+b),this._context.lineTo(a+this._spacingX-b,d-c/2+b),this._context.lineTo(a+this._spacingX-b,d+c/2-b),this._context.lineTo(a,d+c-b),this._context.lineTo(a-this._spacingX+b,d+c/2-b),this._context.lineTo(a-this._spacingX+b,d-c/2+b),this._context.lineTo(a,d-c+b));this._context.fill()}}]);return a}(E),z=function(b){function a(c){_classCallCheck(this,a);c=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,c));c._spacingX=0;c._spacingY=0;c._canvasCache={};return c}_inherits(a,b);_createClass(a,
[{key:"compute",value:function(c){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,c);this._canvasCache={};var d=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(c.spacing*d);this._spacingY=Math.ceil(c.spacing*c.fontSize);this._options.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY));this._context.canvas.width=c.width*this._spacingX;this._context.canvas.height=c.height*this._spacingY}},{key:"draw",value:function(c,d){a.cache?
this._drawWithCache(c):this._drawNoCache(c,d)}},{key:"_drawWithCache",value:function(a){var c=_slicedToArray(a,5);a=c[0];var b=c[1],h=c[2],l=c[3],e=c[4];c=""+h+l+e;if(c in this._canvasCache)var m=this._canvasCache[c];else{var y=this._options.border;m=document.createElement("canvas");var g=m.getContext("2d");m.width=this._spacingX;m.height=this._spacingY;g.fillStyle=e;g.fillRect(y,y,m.width-y,m.height-y);if(h)for(g.fillStyle=l,g.font=this._context.font,g.textAlign="center",g.textBaseline="middle",
h=[].concat(h),l=0;l<h.length;l++)g.fillText(h[l],this._spacingX/2,Math.ceil(this._spacingY/2));this._canvasCache[c]=m}this._context.drawImage(m,a*this._spacingX,b*this._spacingY)}},{key:"_drawNoCache",value:function(a,d){var c=_slicedToArray(a,5);a=c[0];var b=c[1],l=c[2],m=c[3];c=c[4];d&&(d=this._options.border,this._context.fillStyle=c,this._context.fillRect(a*this._spacingX+d,b*this._spacingY+d,this._spacingX-d,this._spacingY-d));if(l)for(this._context.fillStyle=m,d=[].concat(l),l=0;l<d.length;l++)this._context.fillText(d[l],
(a+.5)*this._spacingX,Math.ceil((b+.5)*this._spacingY))}},{key:"computeSize",value:function(a,d){return[Math.floor(a/this._spacingX),Math.floor(d/this._spacingY)]}},{key:"computeFontSize",value:function(a,d){a=Math.floor(a/this._options.width);d=Math.floor(d/this._options.height);var c=this._context.font;this._context.font="100px "+this._options.fontFamily;var b=Math.ceil(this._context.measureText("W").width);this._context.font=c;a=b/100*d/a;1<a&&(d=Math.floor(d/a));return Math.floor(d/this._options.spacing)}},
{key:"eventToPosition",value:function(a,d){return[Math.floor(a/this._spacingX),Math.floor(d/this._spacingY)]}}]);return a}(E);z.cache=!1;var w=function(b){function a(c){_classCallCheck(this,a);c=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,c));c._colorCanvas=document.createElement("canvas");return c}_inherits(a,b);_createClass(a,[{key:"compute",value:function(c){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,c);this._context.canvas.width=c.width*c.tileWidth;this._context.canvas.height=
c.height*c.tileHeight;this._colorCanvas.width=c.tileWidth;this._colorCanvas.height=c.tileHeight}},{key:"draw",value:function(a,d){var c=_slicedToArray(a,5);a=c[0];var b=c[1],l=c[2],m=c[3],e=c[4];c=this._options.tileWidth;var g=this._options.tileHeight;d&&(this._options.tileColorize?this._context.clearRect(a*c,b*g,c,g):(this._context.fillStyle=e,this._context.fillRect(a*c,b*g,c,g)));if(l)for(d=[].concat(l),m=[].concat(m),e=[].concat(e),l=0;l<d.length;l++){var k=this._options.tileMap[d[l]];if(!k)throw Error("Char '"+
d[l]+"' not found in tileMap");if(this._options.tileColorize){var n=this._colorCanvas,q=n.getContext("2d");q.globalCompositeOperation="source-over";q.clearRect(0,0,c,g);var p=m[l],t=e[l];q.drawImage(this._options.tileSet,k[0],k[1],c,g,0,0,c,g);"transparent"!=p&&(q.fillStyle=p,q.globalCompositeOperation="source-atop",q.fillRect(0,0,c,g));"transparent"!=t&&(q.fillStyle=t,q.globalCompositeOperation="destination-over",q.fillRect(0,0,c,g));this._context.drawImage(n,a*c,b*g,c,g)}else this._context.drawImage(this._options.tileSet,
k[0],k[1],c,g,a*c,b*g,c,g)}}},{key:"computeSize",value:function(a,d){return[Math.floor(a/this._options.tileWidth),Math.floor(d/this._options.tileHeight)]}},{key:"computeFontSize",value:function(){throw Error("Tile backend does not understand font size");}},{key:"eventToPosition",value:function(a,d){return[Math.floor(a/this._options.tileWidth),Math.floor(d/this._options.tileHeight)]}}]);return a}(E),S=/%([bc]){([^}]*)}/g;E=Object.freeze({TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(b,
a){var c={width:0,height:1};b=C(b,a);for(var d=a=0;d<b.length;d++){var f=b[d];switch(f.type){case 0:a+=f.value.length;break;case 1:c.height++,c.width=Math.max(c.width,a),a=0}}c.width=Math.max(c.width,a);return c},tokenize:C});var A={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},U={hex:H,rect:z,tile:w},V={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",
fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1,termColor:"xterm"},I=function(){function b(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,b);this._context=document.createElement("canvas").getContext("2d");this._data={};this._dirty=!1;this._options={};a=Object.assign({},V,a);this.setOptions(a);this.DEBUG=this.DEBUG.bind(this);this._tick=this._tick.bind(this);requestAnimationFrame(this._tick)}_createClass(b,
[{key:"DEBUG",value:function(a,c,b){var d=[this._options.bg,this._options.fg];this.draw(a,c,null,null,d[b%d.length])}},{key:"clear",value:function(){this._data={};this._dirty=!0}},{key:"setOptions",value:function(a){Object.assign(this._options,a);if(a.width||a.height||a.fontSize||a.fontFamily||a.spacing||a.layout)a.layout&&(this._backend=new U[a.layout](this._context)),a=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily,this._context.font=
a,this._backend.compute(this._options),this._context.font=a,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=!0;return this}},{key:"getOptions",value:function(){return this._options}},{key:"getContainer",value:function(){return this._context.canvas}},{key:"computeSize",value:function(a,c){return this._backend.computeSize(a,c)}},{key:"computeFontSize",value:function(a,c){return this._backend.computeFontSize(a,c)}},{key:"computeTileSize",value:function(a,c){return[Math.floor(a/
this._options.width),Math.floor(c/this._options.height)]}},{key:"eventToPosition",value:function(a){if("touches"in a){var c=a.touches[0].clientX;a=a.touches[0].clientY}else c=a.clientX,a=a.clientY;var b=this._context.canvas.getBoundingClientRect();c-=b.left;a-=b.top;c*=this._context.canvas.width/b.width;a*=this._context.canvas.height/b.height;return 0>c||0>a||c>=this._context.canvas.width||a>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(c,a)}},{key:"draw",value:function(a,c,b,
f,h){f||(f=this._options.fg);h||(h=this._options.bg);var d="".concat(a,",").concat(c);this._data[d]=[a,c,b,f,h];!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[d]=!0)}},{key:"drawText",value:function(a,c,b,f){var d=null,l=null,e=a,m=1;f||(f=this._options.width-a);for(b=C(b,f);b.length;)switch(f=b.shift(),f.type){case 0:for(var g,k=!1,n,q=!1,p=0;p<f.value.length;p++){g=f.value.charCodeAt(p);var t=f.value.charAt(p);n=65280<g&&65377>g||65500<g&&65512>g||65518<g;g=32==t.charCodeAt(0)||12288==
t.charCodeAt(0);!q||n||g||e++;n&&!k&&e++;this.draw(e++,c,t,d,l);k=g;q=n}break;case 2:d=f.value||null;break;case 3:l=f.value||null;break;case 1:e=a,c++,m++}return m}},{key:"_tick",value:function(){requestAnimationFrame(this._tick);if(this._dirty){if(!0===this._dirty){this._context.fillStyle=this._options.bg;this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height);for(var a in this._data)this._draw(a,!1)}else for(var c in this._dirty)this._draw(c,!0);this._dirty=!1}}},{key:"_draw",
value:function(a,c){a=this._data[a];a[4]!=this._options.bg&&(c=!0);this._backend.draw(a,c)}}]);return b}();I.Rect=z;I.Hex=H;I.Tile=w;H=function(){function b(a){_classCallCheck(this,b);this._options={words:!1,order:3,prior:.001};Object.assign(this._options,a);this._suffix=this._boundary=String.fromCharCode(0);this._prefix=[];for(a=0;a<this._options.order;a++)this._prefix.push(this._boundary);this._priorValues={};this._priorValues[this._boundary]=this._options.prior;this._data={}}_createClass(b,[{key:"clear",
value:function(){this._data={};this._priorValues={}}},{key:"generate",value:function(){for(var a=[this._sample(this._prefix)];a[a.length-1]!=this._boundary;)a.push(this._sample(a));return this._join(a.slice(0,-1))}},{key:"observe",value:function(a){a=this._split(a);for(var c=0;c<a.length;c++)this._priorValues[a[c]]=this._options.prior;a=this._prefix.concat(a).concat(this._suffix);for(c=this._options.order;c<a.length;c++)for(var b=a.slice(c-this._options.order,c),f=a[c],h=0;h<b.length;h++){var l=b.slice(h);
this._observeEvent(l,f)}}},{key:"getStats",value:function(){var a=[],c=Object.keys(this._priorValues).length;c--;a.push("distinct samples: "+c);c=Object.keys(this._data).length;var b=0,f;for(f in this._data)b+=Object.keys(this._data[f]).length;a.push("dictionary size (contexts): "+c);a.push("dictionary size (events): "+b);return a.join(", ")}},{key:"_split",value:function(a){return a.split(this._options.words?/\s+/:"")}},{key:"_join",value:function(a){return a.join(this._options.words?" ":"")}},{key:"_observeEvent",
value:function(a,c){a=this._join(a);a in this._data||(this._data[a]={});a=this._data[a];c in a||(a[c]=0);a[c]++}},{key:"_sample",value:function(a){a=this._backoff(a);a=this._join(a);a=this._data[a];var c={};if(this._options.prior){for(var b in this._priorValues)c[b]=this._priorValues[b];for(var f in a)c[f]+=a[f]}else c=a;return G.getWeightedValue(c)}},{key:"_backoff",value:function(a){for(a.length>this._options.order?a=a.slice(-this._options.order):a.length<this._options.order&&(a=this._prefix.slice(0,
this._options.order-a.length).concat(a));!(this._join(a)in this._data)&&0<a.length;)a=a.slice(1);return a}}]);return b}();var R=function(){function b(){_classCallCheck(this,b);this._time=0;this._events=[];this._eventTimes=[]}_createClass(b,[{key:"getTime",value:function(){return this._time}},{key:"clear",value:function(){this._events=[];this._eventTimes=[];return this}},{key:"add",value:function(a,c){for(var b=this._events.length,f=0;f<this._eventTimes.length;f++)if(this._eventTimes[f]>c){b=f;break}this._events.splice(b,
0,a);this._eventTimes.splice(b,0,c)}},{key:"get",value:function(){if(!this._events.length)return null;var a=this._eventTimes.splice(0,1)[0];if(0<a){this._time+=a;for(var c=0;c<this._eventTimes.length;c++)this._eventTimes[c]-=a}return this._events.splice(0,1)[0]}},{key:"getEventTime",value:function(a){a=this._events.indexOf(a);if(-1!=a)return this._eventTimes[a]}},{key:"remove",value:function(a){a=this._events.indexOf(a);if(-1==a)return!1;this._remove(a);return!0}},{key:"_remove",value:function(a){this._events.splice(a,
1);this._eventTimes.splice(a,1)}}]);return b}(),r=function(){function b(){_classCallCheck(this,b);this._queue=new R;this._repeat=[];this._current=null}_createClass(b,[{key:"getTime",value:function(){return this._queue.getTime()}},{key:"add",value:function(a,c){c&&this._repeat.push(a);return this}},{key:"getTimeOf",value:function(a){return this._queue.getEventTime(a)}},{key:"clear",value:function(){this._queue.clear();this._repeat=[];this._current=null;return this}},{key:"remove",value:function(a){var c=
this._queue.remove(a),b=this._repeat.indexOf(a);-1!=b&&this._repeat.splice(b,1);this._current==a&&(this._current=null);return c}},{key:"next",value:function(){return this._current=this._queue.get()}}]);return b}();z=function(b){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,b);_createClass(a,[{key:"add",value:function(c,b){this._queue.add(c,0);return _get(_getPrototypeOf(a.prototype),"add",this).call(this,c,b)}},{key:"next",
value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0);return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}}]);return a}(r);w=function(b){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,b);_createClass(a,[{key:"add",value:function(c,b,f){this._queue.add(c,void 0!==f?f:1/c.getSpeed());return _get(_getPrototypeOf(a.prototype),"add",this).call(this,c,b)}},
{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed());return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}}]);return a}(r);r=function(b){function a(){_classCallCheck(this,a);var c=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this));c._defaultDuration=1;c._duration=c._defaultDuration;return c}_inherits(a,b);_createClass(a,[{key:"add",value:function(c,b,f){this._queue.add(c,f||this._defaultDuration);
return _get(_getPrototypeOf(a.prototype),"add",this).call(this,c,b)}},{key:"clear",value:function(){this._duration=this._defaultDuration;return _get(_getPrototypeOf(a.prototype),"clear",this).call(this)}},{key:"remove",value:function(c){c==this._current&&(this._duration=this._defaultDuration);return _get(_getPrototypeOf(a.prototype),"remove",this).call(this,c)}},{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),
this._duration=this._defaultDuration);return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}},{key:"setDuration",value:function(a){this._current&&(this._duration=a);return this}}]);return a}(r);z={Simple:z,Speed:w,Action:r};var B=function(){function b(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,b);this._lightPasses=a;this._options=Object.assign({topology:8},c)}_createClass(b,[{key:"_getCircle",value:function(a,c,b){var d=[];switch(this._options.topology){case 4:var h=
1;var l=[0,1];var e=[A[8][7],A[8][1],A[8][3],A[8][5]];break;case 6:e=A[6];h=1;l=[-1,1];break;case 8:e=A[4];h=2;l=[-1,1];break;default:throw Error("Incorrect topology for FOV computation");}a+=l[0]*b;c+=l[1]*b;for(l=0;l<e.length;l++)for(var g=0;g<b*h;g++)d.push([a,c]),a+=e[l][0],c+=e[l][1];return d}}]);return b}();w=function(b){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,b);_createClass(a,[{key:"compute",value:function(a,
b,f,h){h(a,b,0,1);if(this._lightPasses(a,b))for(var c=[],d,e,g,m,k,n=1;n<=f;n++)for(var p=this._getCircle(a,b,n),t=360/p.length,u=0;u<p.length;u++)if(g=p[u][0],m=p[u][1],d=t*(u-.5),e=d+t,k=!this._lightPasses(g,m),this._visibleCoords(Math.floor(d),Math.ceil(e),k,c)&&h(g,m,n,1),2==c.length&&0==c[0]&&360==c[1])return}},{key:"_visibleCoords",value:function(a,b,f,h){if(0>a)return b=this._visibleCoords(0,b,f,h),a=this._visibleCoords(360+a,360,f,h),b||a;for(var c=0;c<h.length&&h[c]<a;)c++;if(c==h.length)return f&&
h.push(a,b),!0;var d=0;if(c%2){for(;c<h.length&&h[c]<b;)c++,d++;if(0==d)return!1;f&&(d%2?h.splice(c-d,d,b):h.splice(c-d,d))}else{for(;c<h.length&&h[c]<b;)c++,d++;if(a==h[c-d]&&1==d)return!1;f&&(d%2?h.splice(c-d,d,a):h.splice(c-d,d,a,b))}return!0}}]);return a}(B);r=function(b){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,b);_createClass(a,[{key:"compute",value:function(a,b,f,h){h(a,b,0,1);if(this._lightPasses(a,b))for(var c=
[],d,e,g,m,k,n=1;n<=f;n++)for(var p=this._getCircle(a,b,n),t=p.length,u=0;u<t;u++)if(d=p[u][0],e=p[u][1],m=[u?2*u-1:2*t-1,2*t],k=[2*u+1,2*t],g=!this._lightPasses(d,e),(g=this._checkVisibility(m,k,g,c))&&h(d,e,n,g),2==c.length&&0==c[0][0]&&c[1][0]==c[1][1])return}},{key:"_checkVisibility",value:function(a,b,f,h){if(a[0]>b[0])return a=this._checkVisibility(a,[a[1],a[1]],f,h),b=this._checkVisibility([0,1],b,f,h),(a+b)/2;for(var c=0,d=!1;c<h.length;){var e=h[c];e=e[0]*a[1]-a[0]*e[1];if(0<=e){0!=e||c%
2||(d=!0);break}c++}e=h.length;for(var g=!1;e--;){var m=h[e];m=b[0]*m[1]-m[0]*b[1];if(0<=m){0==m&&e%2&&(g=!0);break}}m=!0;c==e&&(d||g)?m=!1:d&&g&&c+1==e&&e%2?m=!1:c>e&&c%2&&(m=!1);if(!m)return 0;d=e-c+1;if(d%2)c%2?(e=h[c],e=(b[0]*e[1]-e[0]*b[1])/(e[1]*b[1]),f&&h.splice(c,d,b)):(e=h[e],e=(e[0]*a[1]-a[0]*e[1])/(a[1]*e[1]),f&&h.splice(c,d,a));else if(c%2)g=h[c],e=h[e],e=(e[0]*g[1]-g[0]*e[1])/(g[1]*e[1]),f&&h.splice(c,d);else return f&&h.splice(c,d,a,b),1;return e/((b[0]*a[1]-a[0]*b[1])/(a[1]*b[1]))}}]);
return a}(B);var x=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];B=function(b){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,b);_createClass(a,[{key:"compute",value:function(a,b,f,e){e(a,b,0,1);for(var c=0;c<x.length;c++)this._renderOctant(a,b,x[c],f,e)}},{key:"compute180",value:function(a,b,f,e,g){g(a,b,0,1);var c=(e-1+8)%8,d=(e+1+8)%8;this._renderOctant(a,b,x[(e-2+8)%8],
f,g);this._renderOctant(a,b,x[c],f,g);this._renderOctant(a,b,x[e],f,g);this._renderOctant(a,b,x[d],f,g)}},{key:"compute90",value:function(a,b,f,e,g){g(a,b,0,1);var c=(e-1+8)%8;this._renderOctant(a,b,x[e],f,g);this._renderOctant(a,b,x[c],f,g)}},{key:"_renderOctant",value:function(a,b,f,e,g){this._castVisibility(a,b,1,1,0,e+1,f[0],f[1],f[2],f[3],g)}},{key:"_castVisibility",value:function(a,b,f,e,g,m,k,n,r,w,q){if(!(e<g))for(;f<=m;f++){for(var c=-f-1,d=-f,h=!1,l=0;0>=c;){c+=1;var J=a+c*k+d*n,y=b+c*r+
d*w,x=(c-.5)/(d+.5),v=(c+.5)/(d-.5);if(!(v>e)){if(x<g)break;c*c+d*d<m*m&&q(J,y,f,1);h?this._lightPasses(J,y)?(h=!1,e=l):l=v:!this._lightPasses(J,y)&&f<m&&(h=!0,this._castVisibility(a,b,f+1,e,x,m,k,n,r,w,q),l=v)}}if(h)break}}}]);return a}(B);w={DiscreteShadowcasting:w,PreciseShadowcasting:r,RecursiveShadowcasting:B};r={Arena:function(b){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,b);_createClass(a,[{key:"create",
value:function(a){for(var b=this._width-1,c=this._height-1,e=0;e<=b;e++)for(var g=0;g<=c;g++)a(e,g,e&&g&&e<b&&g<c?0:1);return this}}]);return a}(function(){function b(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:80,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:25;_classCallCheck(this,b);this._width=a;this._height=c}_createClass(b,[{key:"_fillMap",value:function(a){for(var b=[],d=0;d<this._width;d++){b.push([]);for(var f=0;f<this._height;f++)b[d].push(a)}return b}}]);return b}())};
B=function(){function b(a){_classCallCheck(this,b);this._scheduler=a;this._lock=1}_createClass(b,[{key:"start",value:function(){return this.unlock()}},{key:"lock",value:function(){this._lock++;return this}},{key:"unlock",value:function(){if(!this._lock)throw Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var a=this._scheduler.next();if(!a)return this.lock();(a=a.act())&&a.then&&(this.lock(),a.then(this.unlock.bind(this)))}return this}}]);return b}();var K={black:[0,0,0],navy:[0,
0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,
208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,
0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,
169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,
112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,
128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,
228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]},W=Object.freeze({fromString:F,add:function(b){for(var a=b.slice(),c=arguments.length,d=Array(1<c?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];for(c=0;3>c;c++)for(f=0;f<d.length;f++)a[c]+=d[f][c];return a},add_:N,
multiply:function(b){for(var a=b.slice(),c=arguments.length,d=Array(1<c?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];for(c=0;3>c;c++){for(f=0;f<d.length;f++)a[c]*=d[f][c]/255;a[c]=Math.round(a[c])}return a},multiply_:function(b){for(var a=arguments.length,c=Array(1<a?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];for(a=0;3>a;a++){for(d=0;d<c.length;d++)b[a]*=c[d][a]/255;b[a]=Math.round(b[a])}return b},interpolate:O,lerp:O,interpolateHSL:P,lerpHSL:P,randomize:function(b,a){a instanceof Array||(a=Math.round(G.getNormal(0,
a)));b=b.slice();for(var c=0;3>c;c++)b[c]+=a instanceof Array?Math.round(G.getNormal(0,a[c])):a;return b},rgb2hsl:L,hsl2rgb:Q,toRGB:function(b){b=b.map(function(a){return g(a,0,255)});return"rgb(".concat(b.join(","),")")},toHex:function(b){b=b.map(function(a){return g(a,0,255).toString(16).padStart(2,"0")});return"#".concat(b.join(""))}}),X=function(){function b(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,b);this._reflectivityCallback=a;c=Object.assign({passes:1,
emissionThreshold:100,range:10},c);this._lights={};this._reflectivityCache={};this._fovCache={};this.setOptions(c)}_createClass(b,[{key:"setOptions",value:function(a){Object.assign(this._options,a);a&&a.range&&this.reset();return this}},{key:"setFOV",value:function(a){this._fov=a;this._fovCache={};return this}},{key:"setLight",value:function(a,b,d){a=a+","+b;d?this._lights[a]="string"==typeof d?F(d):d:delete this._lights[a];return this}},{key:"clearLights",value:function(){this._lights={}}},{key:"reset",
value:function(){this._reflectivityCache={};this._fovCache={};return this}},{key:"compute",value:function(a){var b={},d={},f={},e;for(e in this._lights){var g=this._lights[e];d[e]=[0,0,0];N(d[e],g)}for(e=0;e<this._options.passes;e++)this._emitLight(d,f,b),e+1!=this._options.passes&&(d=this._computeEmitters(f,b));for(var k in f)d=k.split(","),b=parseInt(d[0]),d=parseInt(d[1]),a(b,d,f[k]);return this}},{key:"_emitLight",value:function(a,b,d){for(var c in a){var e=c.split(","),g=parseInt(e[0]);e=parseInt(e[1]);
this._emitLightFromCell(g,e,a[c],b);d[c]=1}return this}},{key:"_computeEmitters",value:function(a,b){var c={},e;for(e in a)if(!(e in b)){var g=a[e];if(e in this._reflectivityCache)var l=this._reflectivityCache[e];else{var k=e.split(",");l=parseInt(k[0]);k=parseInt(k[1]);l=this._reflectivityCallback(l,k);this._reflectivityCache[e]=l}if(0!=l){k=[0,0,0];for(var m=0,n=0;3>n;n++){var r=Math.round(g[n]*l);k[n]=r;m+=r}m>this._options.emissionThreshold&&(c[e]=k)}}return c}},{key:"_emitLightFromCell",value:function(a,
b,d,e){var c=a+","+b;a=c in this._fovCache?this._fovCache[c]:this._updateFOV(a,b);for(var f in a){b=a[f];f in e?c=e[f]:(c=[0,0,0],e[f]=c);for(var g=0;3>g;g++)c[g]+=Math.round(d[g]*b)}return this}},{key:"_updateFOV",value:function(a,b){var c={};this._fovCache[a+","+b]=c;var e=this._options.range;this._fov.compute(a,b,e,function(a,b,d,f){d=f*(1-d/e);0!=d&&(c[a+","+b]=d)}.bind(this));return c}}]);return b}();b.Util=T;b.Color=W;b.Text=E;b.RNG=G;b.Display=I;b.StringGenerator=H;b.EventQueue=R;b.Scheduler=
z;b.FOV=w;b.Map=r;b.Engine=B;b.Lighting=X;b.DEFAULT_WIDTH=80;b.DEFAULT_HEIGHT=25;b.DIRS=A;b.KEYS={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,
VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,
VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,
VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};return b}({});
