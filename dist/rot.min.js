var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,h,n){c!=Array.prototype&&c!=Object.prototype&&(c[h]=n.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,h,n,q){if(h){n=$jscomp.global;c=c.split(".");for(q=0;q<c.length-1;q++){var t=c[q];t in n||(n[t]={});n=n[t]}c=c[c.length-1];q=n[c];h=h(q);h!=q&&null!=h&&$jscomp.defineProperty(n,c,{configurable:!0,writable:!0,value:h})}};$jscomp.underscoreProtoCanBeSet=function(){var c={a:!0},h={};try{return h.__proto__=c,h.a}catch(n){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(c,h){c.__proto__=h;if(c.__proto__!==h)throw new TypeError(c+" is not extensible");return c}:null;$jscomp.polyfill("Object.setPrototypeOf",function(c){return c||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(c,n,q){var h=this.length||0;0>n&&(n=Math.max(0,h+n));if(null==q||q>h)q=h;q=Number(q);0>q&&(q=Math.max(0,h+q));for(n=Number(n||0);n<q;n++)this[n]=c;return this}},"es6","es3");$jscomp.owns=function(c,h){return Object.prototype.hasOwnProperty.call(c,h)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(c,h){for(var n=1;n<arguments.length;n++){var q=arguments[n];if(q)for(var t in q)$jscomp.owns(q,t)&&(c[t]=q[t])}return c};
$jscomp.polyfill("Object.assign",function(c){return c||$jscomp.assign},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var c=0;return function(h){return $jscomp.SYMBOL_PREFIX+(h||"")+c++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.asyncIterator;c||(c=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(c){var h=0;return $jscomp.iteratorPrototype(function(){return h<c.length?{done:!1,value:c[h++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,h){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var n=0,q={next:function(){if(n<c.length){var t=n++;return{value:h(t,c[t]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};
$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");$jscomp.checkStringArgs=function(c,h,n){if(null==c)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(h instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.repeat",function(c){return c?c:function(c){var h=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var q="";c;)if(c&1&&(q+=h),c>>>=1)h+=h;return q}},"es6","es3");$jscomp.stringPadding=function(c,h){c=void 0!==c?String(c):" ";return 0<h&&c?c.repeat(Math.ceil(h/c.length)).substring(0,h):""};
$jscomp.polyfill("String.prototype.padStart",function(c){return c?c:function(c,n){var h=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(n,c-h.length)+h}},"es8","es3");function _typeof(c){_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"===typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};return _typeof(c)}
function _slicedToArray(c,h){return _arrayWithHoles(c)||_iterableToArrayLimit(c,h)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}function _iterableToArrayLimit(c,h){var n=[],q=!0,t=!1,D=void 0;try{for(var E=c[Symbol.iterator](),B;!(q=(B=E.next()).done)&&(n.push(B.value),!h||n.length!==h);q=!0);}catch(H){t=!0,D=H}finally{try{if(!q&&null!=E["return"])E["return"]()}finally{if(t)throw D;}}return n}
function _arrayWithHoles(c){if(Array.isArray(c))return c}function _possibleConstructorReturn(c,h){return!h||"object"!==_typeof(h)&&"function"!==typeof h?_assertThisInitialized(c):h}function _assertThisInitialized(c){if(void 0===c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}
function _get(c,h,n){_get="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(c,h,n){if(c=_superPropBase(c,h))return h=Object.getOwnPropertyDescriptor(c,h),h.get?h.get.call(n):h.value};return _get(c,h,n||c)}function _superPropBase(c,h){for(;!Object.prototype.hasOwnProperty.call(c,h)&&(c=_getPrototypeOf(c),null!==c););return c}
function _getPrototypeOf(c){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)};return _getPrototypeOf(c)}function _inherits(c,h){if("function"!==typeof h&&null!==h)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(h&&h.prototype,{constructor:{value:c,writable:!0,configurable:!0}});h&&_setPrototypeOf(c,h)}
function _setPrototypeOf(c,h){_setPrototypeOf=Object.setPrototypeOf||function(c,h){c.__proto__=h;return c};return _setPrototypeOf(c,h)}function _classCallCheck(c,h){if(!(c instanceof h))throw new TypeError("Cannot call a class as a function");}function _defineProperties(c,h){for(var n=0;n<h.length;n++){var q=h[n];q.enumerable=q.enumerable||!1;q.configurable=!0;"value"in q&&(q.writable=!0);Object.defineProperty(c,q.key,q)}}
function _createClass(c,h,n){h&&_defineProperties(c.prototype,h);n&&_defineProperties(c,n);return c}
var ROT=function(c){function h(c,a){return(c%a+a)%a}function n(c){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return c<a?a:c>b?b:c}function q(c){return c.charAt(0).toUpperCase()+c.substring(1)}function t(c){for(var a=arguments.length,b=Array(1<a?a-1:0),d=1;d<a;d++)b[d-1]=arguments[d];var e=t.map;return c.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(d,a,p,g){if("%"==c.charAt(g-1))return d.substring(1);if(!b.length)return d;
p=(a||p).split(",");a=p.shift()||"";g=e[a.toLowerCase()];if(!g)return d;d=b.shift();d=d[g].apply(d,p);a=a.charAt(0);a!=a.toLowerCase()&&(d=q(d));return d})}function D(c,a){var b=[],d=0;c.replace(V,function(e,a,p,g){var f=c.substring(d,g);f.length&&b.push({type:0,value:f});b.push({type:"c"==a?2:3,value:p.trim()});d=g+e.length;return""});var e=c.substring(d);e.length&&b.push({type:0,value:e});return E(b,a)}function E(c,a){a||(a=Infinity);for(var b=0,d=0,e=-1;b<c.length;){var f=c[b];1==f.type&&(d=0,
e=-1);if(0!=f.type)b++;else{for(;0==d&&" "==f.value.charAt(0);)f.value=f.value.substring(1);var m=f.value.indexOf("\n");if(-1!=m){f.value=B(c,b,m,!0);for(m=f.value.split("");m.length&&" "==m[m.length-1];)m.pop();f.value=m.join("")}if(f.value.length){if(d+f.value.length>a){for(m=-1;;){var p=f.value.indexOf(" ",m+1);if(-1==p)break;if(d+p>a)break;m=p}-1!=m?f.value=B(c,b,m,!0):-1!=e?(b=c[e],f=b.value.lastIndexOf(" "),b.value=B(c,e,f,!0),b=e):f.value=B(c,b,a-d,!1)}else d+=f.value.length,-1!=f.value.indexOf(" ")&&
(e=b);b++}else c.splice(b,1)}}c.push({type:1});a=null;for(d=0;d<c.length;d++)switch(e=c[d],e.type){case 0:a=e;break;case 1:if(a){for(e=a.value.split("");e.length&&" "==e[e.length-1];)e.pop();a.value=e.join("")}a=null}c.pop();return c}function B(c,a,b,d){d={type:0,value:c[a].value.substring(b+(d?1:0))};c.splice(a+1,0,{type:1},d);return c[a].value.substring(0,b)}function H(c){var a;if(c in L)var b=L[c];else{if("#"==c.charAt(0))if(b=(c.match(/[0-9a-f]/gi)||[]).map(function(d){return parseInt(d,16)}),
3==b.length)b=b.map(function(d){return 17*d});else for(a=0;3>a;a++)b[a+1]+=16*b[a],b.splice(a,1);else b=(a=c.match(/rgb\(([0-9, ]+)\)/i))?a[1].split(/\s*,\s*/).map(function(d){return parseInt(d)}):[0,0,0];L[c]=b}return b.slice()}function Q(c){for(var a=arguments.length,b=Array(1<a?a-1:0),d=1;d<a;d++)b[d-1]=arguments[d];for(a=0;3>a;a++)for(d=0;d<b.length;d++)c[a]+=b[d][a];return c}function R(c,a){for(var b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,d=c.slice(),e=0;3>e;e++)d[e]=Math.round(d[e]+
b*(a[e]-c[e]));return d}function S(c,a){for(var b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,d=M(c),e=M(a),f=0;3>f;f++)d[f]+=b*(e[f]-d[f]);return T(d)}function M(c){var a=c[0]/255,b=c[1]/255;c=c[2]/255;var d=Math.max(a,b,c),e=Math.min(a,b,c),f=0,m=(d+e)/2;if(d==e)e=0;else{var p=d-e;e=.5<m?p/(2-d-e):p/(d+e);switch(d){case a:f=(b-c)/p+(b<c?6:0);break;case b:f=(c-a)/p+2;break;case c:f=(a-b)/p+4}f/=6}return[f,e,m]}function N(c,a,b){0>b&&(b+=1);1<b&&--b;return b<1/6?c+6*(a-c)*b:.5>b?a:b<
2/3?c+(a-c)*(2/3-b)*6:c}function T(c){var a=c[2];if(0==c[1])return a=Math.round(255*a),[a,a,a];var b=c[1];b=.5>a?a*(1+b):a+b-a*b;var d=2*a-b;a=N(d,b,c[0]+1/3);var e=N(d,b,c[0]);c=N(d,b,c[0]-1/3);return[Math.round(255*a),Math.round(255*e),Math.round(255*c)]}var r=(new (function(){function c(){_classCallCheck(this,c);this._c=this._s2=this._s1=this._s0=this._seed=0}_createClass(c,[{key:"getSeed",value:function(){return this._seed}},{key:"setSeed",value:function(a){this._seed=a=1>a?1/a:a;this._s0=2.3283064365386963E-10*
(a>>>0);a=69069*a+1>>>0;this._s1=2.3283064365386963E-10*a;this._s2=2.3283064365386963E-10*(69069*a+1>>>0);this._c=1;return this}},{key:"getUniform",value:function(){var a=2091639*this._s0+2.3283064365386963E-10*this._c;this._s0=this._s1;this._s1=this._s2;this._c=a|0;return this._s2=a-this._c}},{key:"getUniformInt",value:function(a,b){var d=Math.max(a,b);a=Math.min(a,b);return Math.floor(this.getUniform()*(d-a+1))+a}},{key:"getNormal",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?
arguments[0]:0,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;do{var d=2*this.getUniform()-1;var e=2*this.getUniform()-1;e=d*d+e*e}while(1<e||0==e);return a+d*Math.sqrt(-2*Math.log(e)/e)*b}},{key:"getPercentage",value:function(){return 1+Math.floor(100*this.getUniform())}},{key:"getItem",value:function(a){return a.length?a[Math.floor(this.getUniform()*a.length)]:null}},{key:"shuffle",value:function(a){var b=[];for(a=a.slice();a.length;){var d=a.indexOf(this.getItem(a));b.push(a.splice(d,
1)[0])}return b}},{key:"getWeightedValue",value:function(a){var b=0;for(e in a)b+=a[e];b*=this.getUniform();var d;var e=0;for(d in a)if(e+=a[d],b<e)break;return d}},{key:"getState",value:function(){return[this._s0,this._s1,this._s2,this._c]}},{key:"setState",value:function(a){this._s0=a[0];this._s1=a[1];this._s2=a[2];this._c=a[3];return this}},{key:"clone",value:function(){return(new c).setState(this.getState())}}]);return c}())).setSeed(Date.now()),F=function(){function c(a){_classCallCheck(this,
c);this._context=a}_createClass(c,[{key:"compute",value:function(a){this._options=a}}]);return c}();t.map={s:"toString"};var W=Object.freeze({mod:h,clamp:n,capitalize:q,format:t}),I=function(c){function a(b){_classCallCheck(this,a);b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,b));b._spacingX=0;b._spacingY=0;b._hexSize=0;return b}_inherits(a,c);_createClass(a,[{key:"compute",value:function(b){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,b);var d=Math.ceil(this._context.measureText("W").width);
this._hexSize=Math.floor(b.spacing*(b.fontSize+d/Math.sqrt(3))/2);this._spacingX=this._hexSize*Math.sqrt(3)/2;this._spacingY=1.5*this._hexSize;if(b.transpose){d="height";var e="width"}else d="width",e="height";this._context.canvas[d]=Math.ceil((b.width+1)*this._spacingX);this._context.canvas[e]=Math.ceil((b.height-1)*this._spacingY+2*this._hexSize)}},{key:"draw",value:function(b,d){b=_slicedToArray(b,5);var e=b[2],a=b[3],m=b[4];b=[(b[0]+1)*this._spacingX,b[1]*this._spacingY+this._hexSize];this._options.transpose&&
b.reverse();d&&(this._context.fillStyle=m,this._fill(b[0],b[1]));if(e)for(this._context.fillStyle=a,d=[].concat(e),e=0;e<d.length;e++)this._context.fillText(d[e],b[0],Math.ceil(b[1]))}},{key:"computeSize",value:function(b,d){this._options.transpose&&(b+=d,d=b-d,b-=d);return[Math.floor(b/this._spacingX)-1,Math.floor((d-2*this._hexSize)/this._spacingY+1)]}},{key:"computeFontSize",value:function(b,d){this._options.transpose&&(b+=d,d=b-d,b-=d);b=Math.min(2*b/((this._options.width+1)*Math.sqrt(3))-1,d/
(2+1.5*(this._options.height-1)));d=this._context.font;this._context.font="100px "+this._options.fontFamily;var e=Math.ceil(this._context.measureText("W").width);this._context.font=d;b=Math.floor(b)+1;return Math.ceil(2*b/(this._options.spacing*(1+e/100/Math.sqrt(3))))-1}},{key:"eventToPosition",value:function(b,d){if(this._options.transpose){b+=d;d=b-d;b-=d;var e=this._context.canvas.width}else e=this._context.canvas.height;d=Math.floor(d/(e/this._options.height));h(d,2)?(b-=this._spacingX,b=1+2*
Math.floor(b/(2*this._spacingX))):b=2*Math.floor(b/(2*this._spacingX));return[b,d]}},{key:"_fill",value:function(b,d){var e=this._hexSize,a=this._options.border;this._context.beginPath();this._options.transpose?(this._context.moveTo(b-e+a,d),this._context.lineTo(b-e/2+a,d+this._spacingX-a),this._context.lineTo(b+e/2-a,d+this._spacingX-a),this._context.lineTo(b+e-a,d),this._context.lineTo(b+e/2-a,d-this._spacingX+a),this._context.lineTo(b-e/2+a,d-this._spacingX+a),this._context.lineTo(b-e+a,d)):(this._context.moveTo(b,
d-e+a),this._context.lineTo(b+this._spacingX-a,d-e/2+a),this._context.lineTo(b+this._spacingX-a,d+e/2-a),this._context.lineTo(b,d+e-a),this._context.lineTo(b-this._spacingX+a,d+e/2-a),this._context.lineTo(b-this._spacingX+a,d-e/2+a),this._context.lineTo(b,d-e+a));this._context.fill()}}]);return a}(F),C=function(c){function a(b){_classCallCheck(this,a);b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,b));b._spacingX=0;b._spacingY=0;b._canvasCache={};return b}_inherits(a,c);_createClass(a,
[{key:"compute",value:function(b){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,b);this._canvasCache={};var d=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(b.spacing*d);this._spacingY=Math.ceil(b.spacing*b.fontSize);this._options.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY));this._context.canvas.width=b.width*this._spacingX;this._context.canvas.height=b.height*this._spacingY}},{key:"draw",value:function(b,d){a.cache?
this._drawWithCache(b):this._drawNoCache(b,d)}},{key:"_drawWithCache",value:function(b){var d=_slicedToArray(b,5);b=d[0];var a=d[1],f=d[2],m=d[3],c=d[4];d=""+f+m+c;if(d in this._canvasCache)var g=this._canvasCache[d];else{var k=this._options.border;g=document.createElement("canvas");var l=g.getContext("2d");g.width=this._spacingX;g.height=this._spacingY;l.fillStyle=c;l.fillRect(k,k,g.width-k,g.height-k);if(f)for(l.fillStyle=m,l.font=this._context.font,l.textAlign="center",l.textBaseline="middle",
f=[].concat(f),m=0;m<f.length;m++)l.fillText(f[m],this._spacingX/2,Math.ceil(this._spacingY/2));this._canvasCache[d]=g}this._context.drawImage(g,b*this._spacingX,a*this._spacingY)}},{key:"_drawNoCache",value:function(b,d){var a=_slicedToArray(b,5);b=a[0];var f=a[1],m=a[2],c=a[3];a=a[4];d&&(d=this._options.border,this._context.fillStyle=a,this._context.fillRect(b*this._spacingX+d,f*this._spacingY+d,this._spacingX-d,this._spacingY-d));if(m)for(this._context.fillStyle=c,d=[].concat(m),m=0;m<d.length;m++)this._context.fillText(d[m],
(b+.5)*this._spacingX,Math.ceil((f+.5)*this._spacingY))}},{key:"computeSize",value:function(b,d){return[Math.floor(b/this._spacingX),Math.floor(d/this._spacingY)]}},{key:"computeFontSize",value:function(b,d){b=Math.floor(b/this._options.width);d=Math.floor(d/this._options.height);var a=this._context.font;this._context.font="100px "+this._options.fontFamily;var f=Math.ceil(this._context.measureText("W").width);this._context.font=a;b=f/100*d/b;1<b&&(d=Math.floor(d/b));return Math.floor(d/this._options.spacing)}},
{key:"eventToPosition",value:function(b,d){return[Math.floor(b/this._spacingX),Math.floor(d/this._spacingY)]}}]);return a}(F);C.cache=!1;var y=function(c){function a(b){_classCallCheck(this,a);b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,b));b._colorCanvas=document.createElement("canvas");return b}_inherits(a,c);_createClass(a,[{key:"compute",value:function(b){_get(_getPrototypeOf(a.prototype),"compute",this).call(this,b);this._context.canvas.width=b.width*b.tileWidth;this._context.canvas.height=
b.height*b.tileHeight;this._colorCanvas.width=b.tileWidth;this._colorCanvas.height=b.tileHeight}},{key:"draw",value:function(b,d){var a=_slicedToArray(b,5);b=a[0];var f=a[1],m=a[2],c=a[3],g=a[4];a=this._options.tileWidth;var k=this._options.tileHeight;d&&(this._options.tileColorize?this._context.clearRect(b*a,f*k,a,k):(this._context.fillStyle=g,this._context.fillRect(b*a,f*k,a,k)));if(m)for(d=[].concat(m),c=[].concat(c),g=[].concat(g),m=0;m<d.length;m++){var l=this._options.tileMap[d[m]];if(!l)throw Error("Char '"+
d[m]+"' not found in tileMap");if(this._options.tileColorize){var h=this._colorCanvas,n=h.getContext("2d");n.globalCompositeOperation="source-over";n.clearRect(0,0,a,k);var q=c[m],x=g[m];n.drawImage(this._options.tileSet,l[0],l[1],a,k,0,0,a,k);"transparent"!=q&&(n.fillStyle=q,n.globalCompositeOperation="source-atop",n.fillRect(0,0,a,k));"transparent"!=x&&(n.fillStyle=x,n.globalCompositeOperation="destination-over",n.fillRect(0,0,a,k));this._context.drawImage(h,b*a,f*k,a,k)}else this._context.drawImage(this._options.tileSet,
l[0],l[1],a,k,b*a,f*k,a,k)}}},{key:"computeSize",value:function(b,d){return[Math.floor(b/this._options.tileWidth),Math.floor(d/this._options.tileHeight)]}},{key:"computeFontSize",value:function(){throw Error("Tile backend does not understand font size");}},{key:"eventToPosition",value:function(b,d){return[Math.floor(b/this._options.tileWidth),Math.floor(d/this._options.tileHeight)]}}]);return a}(F),V=/%([bc]){([^}]*)}/g;F=Object.freeze({TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(c,
a){var b={width:0,height:1};c=D(c,a);for(var d=a=0;d<c.length;d++){var e=c[d];switch(e.type){case 0:a+=e.value.length;break;case 1:b.height++,b.width=Math.max(b.width,a),a=0}}b.width=Math.max(b.width,a);return b},tokenize:D});var z={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},X={hex:I,rect:C,tile:y},Y={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",
fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1,termColor:"xterm"},J=function(){function c(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,c);this._context=document.createElement("canvas").getContext("2d");this._data={};this._dirty=!1;this._options={};a=Object.assign({},Y,a);this.setOptions(a);this.DEBUG=this.DEBUG.bind(this);this._tick=this._tick.bind(this);requestAnimationFrame(this._tick)}_createClass(c,
[{key:"DEBUG",value:function(a,b,d){var e=[this._options.bg,this._options.fg];this.draw(a,b,null,null,e[d%e.length])}},{key:"clear",value:function(){this._data={};this._dirty=!0}},{key:"setOptions",value:function(a){Object.assign(this._options,a);if(a.width||a.height||a.fontSize||a.fontFamily||a.spacing||a.layout)a.layout&&(this._backend=new X[a.layout](this._context)),a=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily,this._context.font=
a,this._backend.compute(this._options),this._context.font=a,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=!0;return this}},{key:"getOptions",value:function(){return this._options}},{key:"getContainer",value:function(){return this._context.canvas}},{key:"computeSize",value:function(a,b){return this._backend.computeSize(a,b)}},{key:"computeFontSize",value:function(a,b){return this._backend.computeFontSize(a,b)}},{key:"computeTileSize",value:function(a,b){return[Math.floor(a/
this._options.width),Math.floor(b/this._options.height)]}},{key:"eventToPosition",value:function(a){if("touches"in a){var b=a.touches[0].clientX;a=a.touches[0].clientY}else b=a.clientX,a=a.clientY;var d=this._context.canvas.getBoundingClientRect();b-=d.left;a-=d.top;b*=this._context.canvas.width/d.width;a*=this._context.canvas.height/d.height;return 0>b||0>a||b>=this._context.canvas.width||a>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(b,a)}},{key:"draw",value:function(a,b,d,
e,f){e||(e=this._options.fg);f||(f=this._options.bg);var m="".concat(a,",").concat(b);this._data[m]=[a,b,d,e,f];!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[m]=!0)}},{key:"drawText",value:function(a,b,d,e){var f=null,m=null,c=a,g=1;e||(e=this._options.width-a);for(d=D(d,e);d.length;)switch(e=d.shift(),e.type){case 0:for(var k,l=!1,h,n=!1,q=0;q<e.value.length;q++){k=e.value.charCodeAt(q);var x=e.value.charAt(q);h=65280<k&&65377>k||65500<k&&65512>k||65518<k;k=32==x.charCodeAt(0)||12288==
x.charCodeAt(0);!n||h||k||c++;h&&!l&&c++;this.draw(c++,b,x,f,m);l=k;n=h}break;case 2:f=e.value||null;break;case 3:m=e.value||null;break;case 1:c=a,b++,g++}return g}},{key:"_tick",value:function(){requestAnimationFrame(this._tick);if(this._dirty){if(!0===this._dirty){this._context.fillStyle=this._options.bg;this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height);for(var a in this._data)this._draw(a,!1)}else for(var b in this._dirty)this._draw(b,!0);this._dirty=!1}}},{key:"_draw",
value:function(a,b){a=this._data[a];a[4]!=this._options.bg&&(b=!0);this._backend.draw(a,b)}}]);return c}();J.Rect=C;J.Hex=I;J.Tile=y;I=function(){function c(a){_classCallCheck(this,c);this._options={words:!1,order:3,prior:.001};Object.assign(this._options,a);this._suffix=this._boundary=String.fromCharCode(0);this._prefix=[];for(a=0;a<this._options.order;a++)this._prefix.push(this._boundary);this._priorValues={};this._priorValues[this._boundary]=this._options.prior;this._data={}}_createClass(c,[{key:"clear",
value:function(){this._data={};this._priorValues={}}},{key:"generate",value:function(){for(var a=[this._sample(this._prefix)];a[a.length-1]!=this._boundary;)a.push(this._sample(a));return this._join(a.slice(0,-1))}},{key:"observe",value:function(a){a=this._split(a);for(var b=0;b<a.length;b++)this._priorValues[a[b]]=this._options.prior;a=this._prefix.concat(a).concat(this._suffix);for(b=this._options.order;b<a.length;b++)for(var d=a.slice(b-this._options.order,b),e=a[b],f=0;f<d.length;f++){var c=d.slice(f);
this._observeEvent(c,e)}}},{key:"getStats",value:function(){var a=[],b=Object.keys(this._priorValues).length;b--;a.push("distinct samples: "+b);b=Object.keys(this._data).length;var d=0,e;for(e in this._data)d+=Object.keys(this._data[e]).length;a.push("dictionary size (contexts): "+b);a.push("dictionary size (events): "+d);return a.join(", ")}},{key:"_split",value:function(a){return a.split(this._options.words?/\s+/:"")}},{key:"_join",value:function(a){return a.join(this._options.words?" ":"")}},{key:"_observeEvent",
value:function(a,b){a=this._join(a);a in this._data||(this._data[a]={});a=this._data[a];b in a||(a[b]=0);a[b]++}},{key:"_sample",value:function(a){a=this._backoff(a);a=this._join(a);a=this._data[a];var b={};if(this._options.prior){for(var d in this._priorValues)b[d]=this._priorValues[d];for(var e in a)b[e]+=a[e]}else b=a;return r.getWeightedValue(b)}},{key:"_backoff",value:function(a){for(a.length>this._options.order?a=a.slice(-this._options.order):a.length<this._options.order&&(a=this._prefix.slice(0,
this._options.order-a.length).concat(a));!(this._join(a)in this._data)&&0<a.length;)a=a.slice(1);return a}}]);return c}();var U=function(){function c(){_classCallCheck(this,c);this._time=0;this._events=[];this._eventTimes=[]}_createClass(c,[{key:"getTime",value:function(){return this._time}},{key:"clear",value:function(){this._events=[];this._eventTimes=[];return this}},{key:"add",value:function(a,b){for(var d=this._events.length,e=0;e<this._eventTimes.length;e++)if(this._eventTimes[e]>b){d=e;break}this._events.splice(d,
0,a);this._eventTimes.splice(d,0,b)}},{key:"get",value:function(){if(!this._events.length)return null;var a=this._eventTimes.splice(0,1)[0];if(0<a){this._time+=a;for(var b=0;b<this._eventTimes.length;b++)this._eventTimes[b]-=a}return this._events.splice(0,1)[0]}},{key:"getEventTime",value:function(a){a=this._events.indexOf(a);if(-1!=a)return this._eventTimes[a]}},{key:"remove",value:function(a){a=this._events.indexOf(a);if(-1==a)return!1;this._remove(a);return!0}},{key:"_remove",value:function(a){this._events.splice(a,
1);this._eventTimes.splice(a,1)}}]);return c}(),w=function(){function c(){_classCallCheck(this,c);this._queue=new U;this._repeat=[];this._current=null}_createClass(c,[{key:"getTime",value:function(){return this._queue.getTime()}},{key:"add",value:function(a,b){b&&this._repeat.push(a);return this}},{key:"getTimeOf",value:function(a){return this._queue.getEventTime(a)}},{key:"clear",value:function(){this._queue.clear();this._repeat=[];this._current=null;return this}},{key:"remove",value:function(a){var b=
this._queue.remove(a),d=this._repeat.indexOf(a);-1!=d&&this._repeat.splice(d,1);this._current==a&&(this._current=null);return b}},{key:"next",value:function(){return this._current=this._queue.get()}}]);return c}();C=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"add",value:function(b,d){this._queue.add(b,0);return _get(_getPrototypeOf(a.prototype),"add",this).call(this,b,d)}},{key:"next",
value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0);return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}}]);return a}(w);y=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"add",value:function(b,d,e){this._queue.add(b,void 0!==e?e:1/b.getSpeed());return _get(_getPrototypeOf(a.prototype),"add",this).call(this,b,d)}},
{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed());return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}}]);return a}(w);w=function(c){function a(){_classCallCheck(this,a);var b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this));b._defaultDuration=1;b._duration=b._defaultDuration;return b}_inherits(a,c);_createClass(a,[{key:"add",value:function(b,d,e){this._queue.add(b,e||this._defaultDuration);
return _get(_getPrototypeOf(a.prototype),"add",this).call(this,b,d)}},{key:"clear",value:function(){this._duration=this._defaultDuration;return _get(_getPrototypeOf(a.prototype),"clear",this).call(this)}},{key:"remove",value:function(b){b==this._current&&(this._duration=this._defaultDuration);return _get(_getPrototypeOf(a.prototype),"remove",this).call(this,b)}},{key:"next",value:function(){this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),
this._duration=this._defaultDuration);return _get(_getPrototypeOf(a.prototype),"next",this).call(this)}},{key:"setDuration",value:function(b){this._current&&(this._duration=b);return this}}]);return a}(w);C={Simple:C,Speed:y,Action:w};var u=function(){function c(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,c);this._lightPasses=a;this._options=Object.assign({topology:8},b)}_createClass(c,[{key:"_getCircle",value:function(a,b,d){var e=[];switch(this._options.topology){case 4:var f=
1;var c=[0,1];var p=[z[8][7],z[8][1],z[8][3],z[8][5]];break;case 6:p=z[6];f=1;c=[-1,1];break;case 8:p=z[4];f=2;c=[-1,1];break;default:throw Error("Incorrect topology for FOV computation");}a+=c[0]*d;b+=c[1]*d;for(c=0;c<p.length;c++)for(var g=0;g<d*f;g++)e.push([a,b]),a+=p[c][0],b+=p[c][1];return e}}]);return c}();y=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"compute",value:function(b,
d,a,f){f(b,d,0,1);if(this._lightPasses(b,d))for(var e=[],c,g,k,l,h,n=1;n<=a;n++)for(var q=this._getCircle(b,d,n),r=360/q.length,v=0;v<q.length;v++)if(k=q[v][0],l=q[v][1],c=r*(v-.5),g=c+r,h=!this._lightPasses(k,l),this._visibleCoords(Math.floor(c),Math.ceil(g),h,e)&&f(k,l,n,1),2==e.length&&0==e[0]&&360==e[1])return}},{key:"_visibleCoords",value:function(b,d,a,f){if(0>b)return d=this._visibleCoords(0,d,a,f),b=this._visibleCoords(360+b,360,a,f),d||b;for(var e=0;e<f.length&&f[e]<b;)e++;if(e==f.length)return a&&
f.push(b,d),!0;var c=0;if(e%2){for(;e<f.length&&f[e]<d;)e++,c++;if(0==c)return!1;a&&(c%2?f.splice(e-c,c,d):f.splice(e-c,c))}else{for(;e<f.length&&f[e]<d;)e++,c++;if(b==f[e-c]&&1==c)return!1;a&&(c%2?f.splice(e-c,c,b):f.splice(e-c,c,b,d))}return!0}}]);return a}(u);w=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"compute",value:function(a,d,e,f){f(a,d,0,1);if(this._lightPasses(a,d))for(var b=
[],c,g,k,l,h,n=1;n<=e;n++)for(var q=this._getCircle(a,d,n),r=q.length,v=0;v<r;v++)if(c=q[v][0],g=q[v][1],l=[v?2*v-1:2*r-1,2*r],h=[2*v+1,2*r],k=!this._lightPasses(c,g),(k=this._checkVisibility(l,h,k,b))&&f(c,g,n,k),2==b.length&&0==b[0][0]&&b[1][0]==b[1][1])return}},{key:"_checkVisibility",value:function(a,d,e,f){if(a[0]>d[0])return a=this._checkVisibility(a,[a[1],a[1]],e,f),d=this._checkVisibility([0,1],d,e,f),(a+d)/2;for(var b=0,c=!1;b<f.length;){var g=f[b];g=g[0]*a[1]-a[0]*g[1];if(0<=g){0!=g||b%
2||(c=!0);break}b++}g=f.length;for(var k=!1;g--;){var l=f[g];l=d[0]*l[1]-l[0]*d[1];if(0<=l){0==l&&g%2&&(k=!0);break}}l=!0;b==g&&(c||k)?l=!1:c&&k&&b+1==g&&g%2?l=!1:b>g&&b%2&&(l=!1);if(!l)return 0;c=g-b+1;if(c%2)b%2?(g=f[b],g=(d[0]*g[1]-g[0]*d[1])/(g[1]*d[1]),e&&f.splice(b,c,d)):(g=f[g],g=(g[0]*a[1]-a[0]*g[1])/(a[1]*g[1]),e&&f.splice(b,c,a));else if(b%2)k=f[b],g=f[g],g=(g[0]*k[1]-k[0]*g[1])/(k[1]*g[1]),e&&f.splice(b,c);else return e&&f.splice(b,c,a,d),1;return g/((d[0]*a[1]-a[0]*d[1])/(a[1]*d[1]))}}]);
return a}(u);var A=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];u=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"compute",value:function(a,d,e,c){c(a,d,0,1);for(var b=0;b<A.length;b++)this._renderOctant(a,d,A[b],e,c)}},{key:"compute180",value:function(a,d,e,c,m){m(a,d,0,1);var b=(c-1+8)%8,f=(c+1+8)%8;this._renderOctant(a,d,A[(c-2+8)%8],
e,m);this._renderOctant(a,d,A[b],e,m);this._renderOctant(a,d,A[c],e,m);this._renderOctant(a,d,A[f],e,m)}},{key:"compute90",value:function(a,d,e,c,m){m(a,d,0,1);var b=(c-1+8)%8;this._renderOctant(a,d,A[c],e,m);this._renderOctant(a,d,A[b],e,m)}},{key:"_renderOctant",value:function(a,d,e,c,m){this._castVisibility(a,d,1,1,0,c+1,e[0],e[1],e[2],e[3],m)}},{key:"_castVisibility",value:function(a,d,e,c,m,p,g,k,l,h,n){if(!(c<m))for(;e<=p;e++){for(var b=-e-1,f=-e,q=!1,O=0;0>=b;){b+=1;var r=a+b*g+f*k,P=d+b*l+
f*h,t=(b-.5)/(f+.5),x=(b+.5)/(f-.5);if(!(x>c)){if(t<m)break;b*b+f*f<p*p&&n(r,P,e,1);q?this._lightPasses(r,P)?(q=!1,c=O):O=x:!this._lightPasses(r,P)&&e<p&&(q=!0,this._castVisibility(a,d,e+1,c,t,p,g,k,l,h,n),O=x)}}if(q)break}}}]);return a}(u);y={DiscreteShadowcasting:y,PreciseShadowcasting:w,RecursiveShadowcasting:u};u=function(){function c(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:80,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:25;_classCallCheck(this,c);this._width=
a;this._height=b}_createClass(c,[{key:"_fillMap",value:function(a){for(var b=[],d=0;d<this._width;d++){b.push([]);for(var e=0;e<this._height;e++)b[d].push(a)}return b}}]);return c}();w=function(c){function a(){_classCallCheck(this,a);return _possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}_inherits(a,c);_createClass(a,[{key:"create",value:function(a){for(var d=this._width-1,b=this._height-1,c=0;c<=d;c++)for(var m=0;m<=b;m++)a(c,m,c&&m&&c<d&&m<b?0:1);return this}}]);return a}(u);
var G=function(c){function a(b,d){_classCallCheck(this,a);b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,b,d));b._rooms=[];b._corridors=[];return b}_inherits(a,c);_createClass(a,[{key:"getRooms",value:function(){return this._rooms}},{key:"getCorridors",value:function(){return this._corridors}}]);return a}(u),K=function a(){_classCallCheck(this,a)},Z=function(a){function b(d,a,c,m,p,g){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this));e._x1=
d;e._y1=a;e._x2=c;e._y2=m;e._doors={};void 0!==p&&void 0!==g&&e.addDoor(p,g);return e}_inherits(b,a);_createClass(b,[{key:"addDoor",value:function(a,b){this._doors[a+","+b]=1;return this}},{key:"getDoors",value:function(a){for(var d in this._doors){var b=d.split(",");a(parseInt(b[0]),parseInt(b[1]))}return this}},{key:"clearDoors",value:function(){this._doors={};return this}},{key:"addDoors",value:function(a){for(var d=this._x1-1,b=this._x2+1,c=this._y1-1,p=this._y2+1,g=d;g<=b;g++)for(var k=c;k<=
p;k++)if(g==d||g==b||k==c||k==p)a(g,k)||this.addDoor(g,k);return this}},{key:"debug",value:function(){console.log("room",this._x1,this._y1,this._x2,this._y2)}},{key:"isValid",value:function(a,b){for(var d=this._x1-1,e=this._x2+1,c=this._y1-1,g=this._y2+1,k=d;k<=e;k++)for(var l=c;l<=g;l++)if(k==d||k==e||l==c||l==g){if(!a(k,l))return!1}else if(!b(k,l))return!1;return!0}},{key:"create",value:function(a){for(var d=this._x1-1,b=this._x2+1,c=this._y1-1,p=this._y2+1,g,k=d;k<=b;k++)for(var l=c;l<=p;l++)g=
k+","+l in this._doors?2:k==d||k==b||l==c||l==p?1:0,a(k,l,g)}},{key:"getCenter",value:function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}},{key:"getLeft",value:function(){return this._x1}},{key:"getRight",value:function(){return this._x2}},{key:"getTop",value:function(){return this._y1}},{key:"getBottom",value:function(){return this._y2}}],[{key:"createRandomAt",value:function(a,b,c,m,p){var d=p.roomWidth[0],e=p.roomWidth[1],f=r.getUniformInt(d,e);d=p.roomHeight[0];
e=p.roomHeight[1];p=r.getUniformInt(d,e);if(1==c)return c=b-Math.floor(r.getUniform()*p),new this(a+1,c,a+f,c+p-1,a,b);if(-1==c)return c=b-Math.floor(r.getUniform()*p),new this(a-f,c,a-1,c+p-1,a,b);if(1==m)return c=a-Math.floor(r.getUniform()*f),new this(c,b+1,c+f-1,b+p,a,b);if(-1==m)return c=a-Math.floor(r.getUniform()*f),new this(c,b-p,c+f-1,b-1,a,b);throw Error("dx or dy must be 1 or -1");}},{key:"createRandomCenter",value:function(a,b,c){var d=c.roomWidth[0],e=c.roomWidth[1],f=r.getUniformInt(d,
e);d=c.roomHeight[0];e=c.roomHeight[1];c=r.getUniformInt(d,e);a-=Math.floor(r.getUniform()*f);b-=Math.floor(r.getUniform()*c);return new this(a,b,a+f-1,b+c-1)}},{key:"createRandom",value:function(a,b,c){var d=c.roomWidth[0],e=c.roomWidth[1],f=r.getUniformInt(d,e);d=c.roomHeight[0];e=c.roomHeight[1];c=r.getUniformInt(d,e);a=a-f-1;b=b-c-1;a=1+Math.floor(r.getUniform()*a);b=1+Math.floor(r.getUniform()*b);return new this(a,b,a+f-1,b+c-1)}}]);return b}(K),aa=function(a){function b(a,c,f,m){_classCallCheck(this,
b);var d=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this));d._startX=a;d._startY=c;d._endX=f;d._endY=m;d._endsWithAWall=!0;return d}_inherits(b,a);_createClass(b,[{key:"debug",value:function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}},{key:"isValid",value:function(a,b){var d=this._startX,c=this._startY,e=this._endX-d,g=this._endY-c,k=1+Math.max(Math.abs(e),Math.abs(g));e&&(e/=Math.abs(e));g&&(g/=Math.abs(g));for(var l=g,h=-e,n=!0,q=0;q<k;q++){var r=d+q*
e,t=c+q*g;b(r,t)||(n=!1);a(r+l,t+h)||(n=!1);a(r-l,t-h)||(n=!1);if(!n){k=q;this._endX=r-e;this._endY=t-g;break}}if(0==k||1==k&&a(this._endX+e,this._endY+g))return!1;b=!a(this._endX+e+l,this._endY+g+h);l=!a(this._endX+e-l,this._endY+g-h);this._endsWithAWall=a(this._endX+e,this._endY+g);return(b||l)&&this._endsWithAWall?!1:!0}},{key:"create",value:function(a){var b=this._startX,d=this._startY,c=this._endX-b,p=this._endY-d,g=1+Math.max(Math.abs(c),Math.abs(p));c&&(c/=Math.abs(c));p&&(p/=Math.abs(p));
for(var k=0;k<g;k++)a(b+k*c,d+k*p,0);return!0}},{key:"createPriorityWalls",value:function(a){if(this._endsWithAWall){var b=this._endX-this._startX,d=this._endY-this._startY;b&&(b/=Math.abs(b));d&&(d/=Math.abs(d));var c=d,p=-b;a(this._endX+b,this._endY+d);a(this._endX+c,this._endY+p);a(this._endX-c,this._endY-p)}}}],[{key:"createRandomAt",value:function(a,b,c,m,p){p=r.getUniformInt(p.corridorLength[0],p.corridorLength[1]);return new this(a,b,a+c*p,b+m*p)}}]);return b}(K);G=function(a){function b(a,
c,f){_classCallCheck(this,b);a=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a,c));a._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1E3};Object.assign(a._options,f);a._map=[];a._dug=0;a._roomAttempts=20;a._corridorAttempts=20;a._connected=[];a._unconnected=[];a._digCallback=a._digCallback.bind(_assertThisInitialized(_assertThisInitialized(a)));a._canBeDugCallback=a._canBeDugCallback.bind(_assertThisInitialized(_assertThisInitialized(a)));a._isWallCallback=
a._isWallCallback.bind(_assertThisInitialized(_assertThisInitialized(a)));return a}_inherits(b,a);_createClass(b,[{key:"create",value:function(a){for(var b=Date.now();;){if(Date.now()-b>this._options.timeLimit)return null;this._map=this._fillMap(1);this._dug=0;this._rooms=[];this._unconnected=[];this._generateRooms();if(!(2>this._rooms.length)&&this._generateCorridors())break}if(a)for(b=0;b<this._width;b++)for(var d=0;d<this._height;d++)a(b,d,this._map[b][d]);return this}},{key:"_generateRooms",value:function(){var a=
this._width-2,b=this._height-2;do{var c=this._generateRoom();if(this._dug/(a*b)>this._options.roomDugPercentage)break}while(c)}},{key:"_generateRoom",value:function(){for(var a=0;a<this._roomAttempts;){a++;var b=Z.createRandom(this._width,this._height,this._options);if(b.isValid(this._isWallCallback,this._canBeDugCallback))return b.create(this._digCallback),this._rooms.push(b),b}return null}},{key:"_generateCorridors",value:function(){for(var a=0;a<this._corridorAttempts;){a++;this._corridors=[];
this._map=this._fillMap(1);for(var b=0;b<this._rooms.length;b++){var c=this._rooms[b];c.clearDoors();c.create(this._digCallback)}this._unconnected=r.shuffle(this._rooms.slice());this._connected=[];for(this._unconnected.length&&this._connected.push(this._unconnected.pop());;){b=r.getItem(this._connected);if(!b)break;b=this._closestRoom(this._unconnected,b);if(!b)break;c=this._closestRoom(this._connected,b);if(!c)break;if(!this._connectRooms(b,c))break;if(!this._unconnected.length)return!0}}return!1}},
{key:"_closestRoom",value:function(a,b){var d=Infinity;b=b.getCenter();for(var c=null,e=0;e<a.length;e++){var g=a[e],k=g.getCenter(),l=k[0]-b[0];k=k[1]-b[1];l=l*l+k*k;l<d&&(d=l,c=g)}return c}},{key:"_connectRooms",value:function(a,b){var d=a.getCenter(),c=b.getCenter(),e=c[0]-d[0];d=c[1]-d[1];if(Math.abs(e)<Math.abs(d)){e=0<d?2:0;var g=(e+2)%4;var k=b.getLeft();var l=b.getRight();d=0}else e=0<e?1:3,g=(e+2)%4,k=b.getTop(),l=b.getBottom(),d=1;e=this._placeInWall(a,e);if(!e)return!1;if(e[d]>=k&&e[d]<=
l){c=e.slice();k=0;switch(g){case 0:k=b.getTop()-1;break;case 1:k=b.getRight()+1;break;case 2:k=b.getBottom()+1;break;case 3:k=b.getLeft()-1}c[(d+1)%2]=k;this._digLine([e,c])}else if(e[d]<k-1||e[d]>l+1){c=e[d]-c[d];k=0;switch(g){case 0:case 1:k=0>c?3:1;break;case 2:case 3:k=0>c?1:3}c=this._placeInWall(b,(g+k)%4);if(!c)return!1;g=[0,0];g[d]=e[d];d=(d+1)%2;g[d]=c[d];this._digLine([e,g,c])}else{k=(d+1)%2;c=this._placeInWall(b,g);if(!c)return!1;g=Math.round((c[k]+e[k])/2);l=[0,0];var h=[0,0];l[d]=e[d];
l[k]=g;h[d]=c[d];h[k]=g;this._digLine([e,l,h,c])}a.addDoor(e[0],e[1]);b.addDoor(c[0],c[1]);d=this._unconnected.indexOf(a);-1!=d&&(this._unconnected.splice(d,1),this._connected.push(a));d=this._unconnected.indexOf(b);-1!=d&&(this._unconnected.splice(d,1),this._connected.push(b));return!0}},{key:"_placeInWall",value:function(a,b){var d=[0,0],c=[0,0],e=0;switch(b){case 0:c=[1,0];d=[a.getLeft(),a.getTop()-1];e=a.getRight()-a.getLeft()+1;break;case 1:c=[0,1];d=[a.getRight()+1,a.getTop()];e=a.getBottom()-
a.getTop()+1;break;case 2:c=[1,0];d=[a.getLeft(),a.getBottom()+1];e=a.getRight()-a.getLeft()+1;break;case 3:c=[0,1],d=[a.getLeft()-1,a.getTop()],e=a.getBottom()-a.getTop()+1}a=[];b=-2;for(var g=0;g<e;g++){var k=d[0]+g*c[0],l=d[1]+g*c[1];a.push(null);1==this._map[k][l]?b!=g-1&&(a[g]=[k,l]):(b=g)&&(a[g-1]=null)}for(d=a.length-1;0<=d;d--)a[d]||a.splice(d,1);return a.length?r.getItem(a):null}},{key:"_digLine",value:function(a){for(var b=1;b<a.length;b++){var d=a[b-1],c=a[b];d=new aa(d[0],d[1],c[0],c[1]);
d.create(this._digCallback);this._corridors.push(d)}}},{key:"_digCallback",value:function(a,b,c){this._map[a][b]=c;0==c&&this._dug++}},{key:"_isWallCallback",value:function(a,b){return 0>a||0>b||a>=this._width||b>=this._height?!1:1==this._map[a][b]}},{key:"_canBeDugCallback",value:function(a,b){return 1>a||1>b||a+1>=this._width||b+1>=this._height?!1:1==this._map[a][b]}}]);return b}(G);u=function(a){function b(a,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,
b);var e=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a,c));e._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8};e.setOptions(d);e._dirs=z[e._options.topology];e._map=e._fillMap(0);return e}_inherits(b,a);_createClass(b,[{key:"randomize",value:function(a){for(var b=0;b<this._width;b++)for(var c=0;c<this._height;c++)this._map[b][c]=r.getUniform()<a?1:0;return this}},{key:"setOptions",value:function(a){Object.assign(this._options,a)}},{key:"set",value:function(a,b,c){this._map[a][b]=
c}},{key:"create",value:function(a){for(var b=this._fillMap(0),c=this._options.born,d=this._options.survive,p=0;p<this._height;p++){var g=1,k=0;6==this._options.topology&&(g=2,k=p%2);for(;k<this._width;k+=g){var l=this._map[k][p],h=this._getNeighbors(k,p);l&&-1!=d.indexOf(h)?b[k][p]=1:l||-1==c.indexOf(h)||(b[k][p]=1)}}this._map=b;a&&this._serviceCallback(a)}},{key:"_serviceCallback",value:function(a){for(var b=0;b<this._height;b++){var c=1,d=0;6==this._options.topology&&(c=2,d=b%2);for(;d<this._width;d+=
c)a(d,b,this._map[d][b])}}},{key:"_getNeighbors",value:function(a,b){for(var c=0,d=0;d<this._dirs.length;d++){var e=this._dirs[d],g=a+e[0];e=b+e[1];0>g||g>=this._width||0>e||e>=this._height||(c+=1==this._map[g][e]?1:0)}return c}},{key:"connect",value:function(a,b,c){b||(b=0);var d=[],e={},g=1,f=[0,0];6==this._options.topology&&(g=2,f=[0,1]);for(var l=0;l<this._height;l++)for(var h=f[l%2];h<this._width;h+=g)if(this._freeSpace(h,l,b)){var n=[h,l];e[this._pointKey(n)]=n;d.push([h,l])}g=d[r.getUniformInt(0,
d.length-1)];f=this._pointKey(g);d={};d[f]=g;delete e[f];for(this._findConnected(d,e,[g],!1,b);0<Object.keys(e).length;){f=this._getFromTo(d,e);g=f[0];l=f[1];f={};f[this._pointKey(g)]=g;this._findConnected(f,e,[g],!0,b);(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,l,g,d,e,b,c);for(var q in f)g=f[q],this._map[g[0]][g[1]]=b,d[q]=g,delete e[q]}a&&this._serviceCallback(a)}},{key:"_getFromTo",value:function(a,b){for(var c=[0,0],d=[0,0],e,g=Object.keys(a),k=Object.keys(b),
l=0;5>l&&!(g.length<k.length?(c=g,d=a[c[r.getUniformInt(0,c.length-1)]],c=this._getClosest(d,b)):(c=k,c=b[c[r.getUniformInt(0,c.length-1)]],d=this._getClosest(c,a)),e=(c[0]-d[0])*(c[0]-d[0])+(c[1]-d[1])*(c[1]-d[1]),64>e);l++);return[c,d]}},{key:"_getClosest",value:function(a,b){var c=null,d=null,e;for(e in b){var g=b[e],k=(g[0]-a[0])*(g[0]-a[0])+(g[1]-a[1])*(g[1]-a[1]);if(null==d||k<d)d=k,c=g}return c}},{key:"_findConnected",value:function(a,b,c,h,p){for(;0<c.length;){var d=c.splice(0,1)[0];d=6==
this._options.topology?[[d[0]+2,d[1]],[d[0]+1,d[1]-1],[d[0]-1,d[1]-1],[d[0]-2,d[1]],[d[0]-1,d[1]+1],[d[0]+1,d[1]+1]]:[[d[0]+1,d[1]],[d[0]-1,d[1]],[d[0],d[1]+1],[d[0],d[1]-1]];for(var e=0;e<d.length;e++){var f=this._pointKey(d[e]);null==a[f]&&this._freeSpace(d[e][0],d[e][1],p)&&(a[f]=d[e],h||delete b[f],c.push(d[e]))}}}},{key:"_tunnelToConnected",value:function(a,b,c,h,p,g){if(b[0]<a[0]){var d=b;var e=a}else d=a,e=b;for(var f=d[0];f<=e[0];f++){this._map[f][d[1]]=p;var m=[f,d[1]],n=this._pointKey(m);
c[n]=m;delete h[n]}g&&d[0]<e[0]&&g(d,[e[0],d[1]]);f=e[0];b[1]<a[1]?(d=b,e=a):(d=a,e=b);for(a=d[1];a<e[1];a++)this._map[f][a]=p,b=[f,a],m=this._pointKey(b),c[m]=b,delete h[m];g&&d[1]<e[1]&&g([e[0],d[1]],[e[0],e[1]])}},{key:"_tunnelToConnected6",value:function(a,b,c,h,p,g){if(b[0]<a[0]){var d=b;var e=a}else d=a,e=b;var f=d[0];for(d=d[1];f!=e[0]||d!=e[1];){var m=2;d<e[1]?(d++,m=1):d>e[1]&&(d--,m=1);f=f<e[0]?f+m:f>e[0]?f-m:e[1]%2?f-m:f+m;this._map[f][d]=p;m=[f,d];var n=this._pointKey(m);c[n]=m;delete h[n]}g&&
g(b,a)}},{key:"_freeSpace",value:function(a,b,c){return 0<=a&&a<this._width&&0<=b&&b<this._height&&this._map[a][b]==c}},{key:"_pointKey",value:function(a){return a[0]+"."+a[1]}}]);return b}(u);w={Arena:w,Uniform:G,Cellular:u};u=function(){function a(b){_classCallCheck(this,a);this._scheduler=b;this._lock=1}_createClass(a,[{key:"start",value:function(){return this.unlock()}},{key:"lock",value:function(){this._lock++;return this}},{key:"unlock",value:function(){if(!this._lock)throw Error("Cannot unlock unlocked engine");
for(this._lock--;!this._lock;){var a=this._scheduler.next();if(!a)return this.lock();(a=a.act())&&a.then&&(this.lock(),a.then(this.unlock.bind(this)))}return this}}]);return a}();var L={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,
25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,
142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,
112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,
92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,
240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,
165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};G=Object.freeze({fromString:H,
add:function(a){for(var b=a.slice(),c=arguments.length,e=Array(1<c?c-1:0),f=1;f<c;f++)e[f-1]=arguments[f];for(c=0;3>c;c++)for(f=0;f<e.length;f++)b[c]+=e[f][c];return b},add_:Q,multiply:function(a){for(var b=a.slice(),c=arguments.length,e=Array(1<c?c-1:0),f=1;f<c;f++)e[f-1]=arguments[f];for(c=0;3>c;c++){for(f=0;f<e.length;f++)b[c]*=e[f][c]/255;b[c]=Math.round(b[c])}return b},multiply_:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];for(b=0;3>b;b++){for(e=0;e<
c.length;e++)a[b]*=c[e][b]/255;a[b]=Math.round(a[b])}return a},interpolate:R,lerp:R,interpolateHSL:S,lerpHSL:S,randomize:function(a,b){b instanceof Array||(b=Math.round(r.getNormal(0,b)));a=a.slice();for(var c=0;3>c;c++)a[c]+=b instanceof Array?Math.round(r.getNormal(0,b[c])):b;return a},rgb2hsl:M,hsl2rgb:T,toRGB:function(a){a=a.map(function(a){return n(a,0,255)});return"rgb(".concat(a.join(","),")")},toHex:function(a){a=a.map(function(a){return n(a,0,255).toString(16).padStart(2,"0")});return"#".concat(a.join(""))}});
K=function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,a);this._reflectivityCallback=b;this._options={};c=Object.assign({passes:1,emissionThreshold:100,range:10},c);this._lights={};this._reflectivityCache={};this._fovCache={};this.setOptions(c)}_createClass(a,[{key:"setOptions",value:function(a){Object.assign(this._options,a);a&&a.range&&this.reset();return this}},{key:"setFOV",value:function(a){this._fov=a;this._fovCache={};return this}},{key:"setLight",
value:function(a,c,e){a=a+","+c;e?this._lights[a]="string"==typeof e?H(e):e:delete this._lights[a];return this}},{key:"clearLights",value:function(){this._lights={}}},{key:"reset",value:function(){this._reflectivityCache={};this._fovCache={};return this}},{key:"compute",value:function(a){var b={},c={},f={},h;for(h in this._lights){var p=this._lights[h];c[h]=[0,0,0];Q(c[h],p)}for(h=0;h<this._options.passes;h++)this._emitLight(c,f,b),h+1!=this._options.passes&&(c=this._computeEmitters(f,b));for(var g in f)c=
g.split(","),b=parseInt(c[0]),c=parseInt(c[1]),a(b,c,f[g]);return this}},{key:"_emitLight",value:function(a,c,e){for(var b in a){var d=b.split(","),h=parseInt(d[0]);d=parseInt(d[1]);this._emitLightFromCell(h,d,a[b],c);e[b]=1}return this}},{key:"_computeEmitters",value:function(a,c){var b={},d;for(d in a)if(!(d in c)){var h=a[d];if(d in this._reflectivityCache)var p=this._reflectivityCache[d];else{var g=d.split(",");p=parseInt(g[0]);g=parseInt(g[1]);p=this._reflectivityCallback(p,g);this._reflectivityCache[d]=
p}if(0!=p){g=[0,0,0];for(var k=0,l=0;3>l;l++){var n=Math.round(h[l]*p);g[l]=n;k+=n}k>this._options.emissionThreshold&&(b[d]=g)}}return b}},{key:"_emitLightFromCell",value:function(a,c,e,f){var b=a+","+c;a=b in this._fovCache?this._fovCache[b]:this._updateFOV(a,c);for(var d in a){c=a[d];d in f?b=f[d]:(b=[0,0,0],f[d]=b);for(var g=0;3>g;g++)b[g]+=Math.round(e[g]*c)}return this}},{key:"_updateFOV",value:function(a,c){var b={};this._fovCache[a+","+c]=b;var d=this._options.range;this._fov.compute(a,c,d,
function(a,c,e,f){e=f*(1-e/d);0!=e&&(b[a+","+c]=e)}.bind(this));return b}}]);return a}();c.Util=W;c.Color=G;c.Text=F;c.RNG=r;c.Display=J;c.StringGenerator=I;c.EventQueue=U;c.Scheduler=C;c.FOV=y;c.Map=w;c.Engine=u;c.Lighting=K;c.DEFAULT_WIDTH=80;c.DEFAULT_HEIGHT=25;c.DIRS=z;c.KEYS={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,
VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,
VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,
VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,
VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};return c}({});
