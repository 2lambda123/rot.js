var ROT={isSupported:function(){return!(!document.createElement("canvas").getContext||!Function.prototype.bind)},DEFAULT_WIDTH:80,DEFAULT_HEIGHT:25,DIRS:{4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,
VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,
VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,
VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,
VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95,Text:{RE_COLORS:/%([bc]){([^}]*)}/g,TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(a,c){for(var b={width:0,height:1},d=this.tokenize(a,c),e=0,f=0;f<d.length;f++){var g=d[f];switch(g.type){case this.TYPE_TEXT:e+=g.value.length;break;case this.TYPE_NEWLINE:b.height++,b.width=Math.max(b.width,e),e=0}}b.width=Math.max(b.width,
e);return b},tokenize:function(a,c){var b=[],d=0;a.replace(this.RE_COLORS,function(c,e,h,j){var k=a.substring(d,j);k.length&&b.push({type:ROT.Text.TYPE_TEXT,value:k});b.push({type:"c"==e?ROT.Text.TYPE_FG:ROT.Text.TYPE_BG,value:h.trim()});d=j+c.length;return""});var e=a.substring(d);e.length&&b.push({type:ROT.Text.TYPE_TEXT,value:e});return this._breakLines(b,c)},_breakLines:function(a,c){c||(c=Infinity);for(var b=0,d=0,e=-1;b<a.length;){var f=a[b];f.type==ROT.Text.TYPE_NEWLINE&&(d=0,e=-1);if(f.type!=
ROT.Text.TYPE_TEXT)b++;else{for(;0==d&&" "==f.value.charAt(0);)f.value=f.value.substring(1);var g=f.value.indexOf("\n");if(-1!=g){f.value=this._breakInsideToken(a,b,g,!0);for(g=f.value.split("");" "==g[g.length-1];)g.pop();f.value=g.join("")}if(f.value.length){if(d+f.value.length>c){for(g=-1;;){var h=f.value.indexOf(" ",g+1);if(-1==h)break;if(d+h>c)break;g=h}-1!=g?f.value=this._breakInsideToken(a,b,g,!0):-1!=e?(f=a[e],b=f.value.lastIndexOf(" "),f.value=this._breakInsideToken(a,e,b,!0),b=e):f.value=
this._breakInsideToken(a,b,c-d,!1)}else d+=f.value.length,-1!=f.value.indexOf(" ")&&(e=b);b++}else a.splice(b,1)}}a.push({type:ROT.Text.TYPE_NEWLINE});d=null;for(b=0;b<a.length;b++)switch(f=a[b],f.type){case ROT.Text.TYPE_TEXT:d=f;break;case ROT.Text.TYPE_NEWLINE:if(d){for(g=d.value.split("");" "==g[g.length-1];)g.pop();d.value=g.join("")}d=null}a.pop();return a},_breakInsideToken:function(a,c,b,d){var e={type:ROT.Text.TYPE_NEWLINE};d={type:ROT.Text.TYPE_TEXT,value:a[c].value.substring(b+(d?1:0))};
a.splice(c+1,0,e,d);return a[c].value.substring(0,b)}},Scheduler:function(){this._items=[]}};ROT.Scheduler.prototype.add=function(a){a={item:a,bucket:1/a.getSpeed()};this._items.push(a);return this};ROT.Scheduler.prototype.clear=function(){this._items=[];return this};ROT.Scheduler.prototype.remove=function(a){for(var c=null,b=0;b<this._items.length;b++)if(c=this._items[b],c.item==a){this._items.splice(b,1);break}return this};
ROT.Scheduler.prototype.next=function(){if(!this._items.length)return null;for(var a=Infinity,c=null,b=0;b<this._items.length;b++){var d=this._items[b];d.bucket<a?(a=d.bucket,c=d):d.bucket==a&&d.item.getSpeed()>c.item.getSpeed()&&(c=d)}if(a)for(b=0;b<this._items.length;b++)d=this._items[b],d.bucket=Math.max(0,d.bucket-a);c.bucket+=1/c.item.getSpeed();return c.item};ROT.Engine=function(){this._scheduler=new ROT.Scheduler;this._lock=1};
ROT.Engine.prototype.addActor=function(a){this._scheduler.add(a);return this};ROT.Engine.prototype.removeActor=function(a){this._scheduler.remove(a);return this};ROT.Engine.prototype.clear=function(){this._scheduler.clear();return this};ROT.Engine.prototype.start=function(){return this.unlock()};ROT.Engine.prototype.lock=function(){this._lock++};
ROT.Engine.prototype.unlock=function(){if(!this._lock)throw Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var a=this._scheduler.next();if(!a)return this.lock();a.act()}return this};Array.prototype.random=function(){return!this.length?null:this[Math.floor(ROT.RNG.getUniform()*this.length)]};Array.prototype.randomize=function(){for(var a=[];this.length;){var c=this.indexOf(this.random());a.push(this.splice(c,1)[0])}return a};Date.now||(Date.now=function(){return+new Date});
Number.prototype.mod=function(a){return(this%a+a)%a};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.substring(1)};String.prototype.lpad=function(a,c){for(var b=a||"0",d=c||2,e="";e.length<d-this.length;)e+=b;e=e.substring(0,d-this.length);return e+this};String.prototype.rpad=function(a,c){for(var b=a||"0",d=c||2,e="";e.length<d-this.length;)e+=b;e=e.substring(0,d-this.length);return this+e};
String.format=function(a){var c=String.format.map,b=Array.prototype.slice.call(arguments,1);return a.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(d,e,f,g){if("%"==a.charAt(g-1))return d.substring(1);if(!b.length)return d;g=b[0];f=(e||f).split(",");e=f.shift();var h=c[e.toLowerCase()];if(!h)return d;g=b.shift();d=g[h].apply(g,f);g=e.charAt(0);g!=g.toLowerCase()&&(d=d.capitalize());return d})};String.format.map={s:"toString"};
String.prototype.format=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this);return String.format.apply(String,a)};Object.create||(Object.create=function(a){var c=function(){};c.prototype=a;return new c});Function.prototype.extend=function(a){this.prototype=Object.create(a.prototype);this.prototype.constructor=this;return this};
ROT.Display=function(a){this._context=document.createElement("canvas").getContext("2d");this._data={};this._dirty=!1;this._options={};this._backend=null;var c={width:ROT.DEFAULT_WIDTH,height:ROT.DEFAULT_HEIGHT,layout:"rect",fontSize:15,fps:25,spacing:1,border:0,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000"},b;for(b in a)c[b]=a[b];this.setOptions(c);this.DEBUG=this.DEBUG.bind(this);this._interval=setInterval(this._tick.bind(this),1E3/this._options.fps)};
ROT.Display.prototype.DEBUG=function(a,c,b){var d=[this._options.bg,this._options.fg];this.draw(a,c,null,null,d[b%d.length])};ROT.Display.prototype.clear=function(){this._data={};this._dirty=!0};
ROT.Display.prototype.setOptions=function(a){for(var c in a)this._options[c]=a[c];if(a.width||a.height||a.fontSize||a.fontFamily||a.spacing||a.layout)a.layout&&(this._backend=new (ROT.Display[a.layout.capitalize()])(this._context)),a=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily,this._context.font=a,this._backend.compute(this._options),this._context.font=a,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=
!0;return this};ROT.Display.prototype.getOptions=function(){return this._options};ROT.Display.prototype.getContainer=function(){return this._context.canvas};ROT.Display.prototype.computeSize=function(a,c){return this._backend.computeSize(a,c,this._options)};ROT.Display.prototype.computeFontSize=function(a,c){return this._backend.computeFontSize(a,c,this._options)};
ROT.Display.prototype.eventToPosition=function(a){if(a.touches){var c=a.touches[0].clientX;a=a.touches[0].clientY}else c=a.clientX,a=a.clientY;c+=document.documentElement.scrollLeft;a+=document.documentElement.scrollTop;for(var b=this._context.canvas;b;)c-=b.offsetLeft,a-=b.offsetTop,b=b.offsetParent;return 0>c||0>a||c>=this._context.canvas.width||a>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(c,a)};
ROT.Display.prototype.draw=function(a,c,b,d,e){d||(d=this._options.fg);e||(e=this._options.bg);this._data[a+","+c]=[a,c,b,d,e];!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[a+","+c]=!0)};
ROT.Display.prototype.drawText=function(a,c,b,d){var e=null,f=null,g=a,h=1;d||(d=this._options.width-a);for(b=ROT.Text.tokenize(b,d);b.length;)switch(d=b.shift(),d.type){case ROT.Text.TYPE_TEXT:for(var j=0;j<d.value.length;j++)this.draw(g++,c,d.value.charAt(j),e,f);break;case ROT.Text.TYPE_FG:e=d.value||null;break;case ROT.Text.TYPE_BG:f=d.value||null;break;case ROT.Text.TYPE_NEWLINE:g=a,c++,h++}return h};
ROT.Display.prototype._tick=function(){if(this._dirty){if(!0===this._dirty){this._context.fillStyle=this._options.bg;this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height);for(var a in this._data)this._draw(a,!1)}else for(var c in this._dirty)this._draw(c,!0);this._dirty=!1}};ROT.Display.prototype._draw=function(a,c){var b=this._data[a];b[4]!=this._options.bg&&(c=!0);this._backend.draw(b,c)};ROT.Display.Backend=function(a){this._context=a};
ROT.Display.Backend.prototype.compute=function(){};ROT.Display.Backend.prototype.draw=function(){};ROT.Display.Backend.prototype.computeSize=function(){};ROT.Display.Backend.prototype.computeFontSize=function(){};ROT.Display.Backend.prototype.eventToPosition=function(){};ROT.Display.Rect=function(a){ROT.Display.Backend.call(this,a);this._spacingY=this._spacingX=0;this._canvasCache={};this._options={}};ROT.Display.Rect.extend(ROT.Display.Backend);ROT.Display.Rect.cache=!1;
ROT.Display.Rect.prototype.compute=function(a){this._canvasCache={};this._options=a;var c=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(a.spacing*c);this._spacingY=Math.ceil(a.spacing*a.fontSize);this._context.canvas.width=a.width*this._spacingX;this._context.canvas.height=a.height*this._spacingY};ROT.Display.Rect.prototype.draw=function(a,c){this.constructor.cache?this._drawWithCache(a,c):this._drawNoCache(a,c)};
ROT.Display.Rect.prototype._drawWithCache=function(a){var c=a[0],b=a[1],d=a[2],e=a[3];a=a[4];var f=""+d+e+a;if(f in this._canvasCache)var g=this._canvasCache[f];else{var h=this._options.border,g=document.createElement("canvas"),j=g.getContext("2d");g.width=this._spacingX;g.height=this._spacingY;j.fillStyle=a;j.fillRect(h,h,g.width-h,g.height-h);d&&(j.fillStyle=e,j.font=this._context.font,j.textAlign="center",j.textBaseline="middle",j.fillText(d,this._spacingX/2,this._spacingY/2));this._canvasCache[f]=
g}this._context.drawImage(g,c*this._spacingX,b*this._spacingY)};ROT.Display.Rect.prototype._drawNoCache=function(a,c){var b=a[0],d=a[1],e=a[2],f=a[3],g=a[4];if(c){var h=this._options.border;this._context.fillStyle=g;this._context.fillRect(b*this._spacingX+h,d*this._spacingY+h,this._spacingX-h,this._spacingY-h)}e&&(this._context.fillStyle=f,this._context.fillText(e,(b+0.5)*this._spacingX,(d+0.5)*this._spacingY))};
ROT.Display.Rect.prototype.computeSize=function(a,c){return[Math.floor(a/this._spacingX),Math.floor(c/this._spacingY)]};ROT.Display.Rect.prototype.computeFontSize=function(a,c){var b=Math.floor(a/this._options.width),d=Math.floor(c/this._options.height),e=this._context.font;this._context.font="100px "+this._options.fontFamily;var f=Math.ceil(this._context.measureText("W").width);this._context.font=e;b=f/100*d/b;1<b&&(d=Math.floor(d/b));return Math.floor(d/this._options.spacing)};
ROT.Display.Rect.prototype.eventToPosition=function(a,c){return[Math.floor(a/this._spacingX),Math.floor(c/this._spacingY)]};ROT.Display.Hex=function(a){ROT.Display.Backend.call(this,a);this._hexSize=this._spacingY=this._spacingX=0;this._options={}};ROT.Display.Hex.extend(ROT.Display.Backend);
ROT.Display.Hex.prototype.compute=function(a){this._options=a;var c=Math.ceil(this._context.measureText("W").width);this._hexSize=Math.floor(a.spacing*(a.fontSize+c/Math.sqrt(3))/2);this._spacingX=this._hexSize*Math.sqrt(3)/2;this._spacingY=1.5*this._hexSize;this._context.canvas.width=Math.ceil((a.width+1)*this._spacingX);this._context.canvas.height=Math.ceil((a.height-1)*this._spacingY+2*this._hexSize)};
ROT.Display.Hex.prototype.draw=function(a,c){var b=a[2],d=a[3],e=a[4],f=(a[0]+1)*this._spacingX,g=a[1]*this._spacingY+this._hexSize;c&&(this._context.fillStyle=e,this._fill(f,g));b&&(this._context.fillStyle=d,this._context.fillText(b,f,g))};ROT.Display.Hex.prototype.computeSize=function(a,c){return[Math.floor(a/this._spacingX)-1,Math.floor((c-2*this._hexSize)/this._spacingY+1)]};
ROT.Display.Hex.prototype.computeFontSize=function(a,c){var b=2*a/((this._options.width+1)*Math.sqrt(3))-1,b=Math.min(b,c/(2+1.5*(this._options.height-1))),d=this._context.font;this._context.font="100px "+this._options.fontFamily;var e=Math.ceil(this._context.measureText("W").width);this._context.font=d;b=Math.floor(b)+1;b=2*b/(this._options.spacing*(1+e/100/Math.sqrt(3)));return Math.ceil(b)-1};
ROT.Display.Hex.prototype.eventToPosition=function(a,c){c=Math.floor(c/(this._context.canvas.height/this._options.height));c.mod(2)?(a-=this._spacingX,a=1+2*Math.floor(a/(2*this._spacingX))):a=2*Math.floor(a/(2*this._spacingX));return[a,c]};
ROT.Display.Hex.prototype._fill=function(a,c){var b=this._hexSize,d=this._options.border;this._context.beginPath();this._context.moveTo(a,c-b+d);this._context.lineTo(a+this._spacingX-d,c-b/2+d);this._context.lineTo(a+this._spacingX-d,c+b/2-d);this._context.lineTo(a,c+b-d);this._context.lineTo(a-this._spacingX+d,c+b/2-d);this._context.lineTo(a-this._spacingX+d,c-b/2+d);this._context.lineTo(a,c-b+d);this._context.fill()};
ROT.RNG={getSeed:function(){return this._seed},setSeed:function(a){this._seed=a=1>a?1/a:a;this._s0=(a>>>0)*this._frac;a=69069*a+1>>>0;this._s1=a*this._frac;this._s2=(69069*a+1>>>0)*this._frac;this._c=1;return this},getUniform:function(){var a=2091639*this._s0+this._c*this._frac;this._s0=this._s1;this._s1=this._s2;this._c=a|0;return this._s2=a-this._c},getNormal:function(a,c){do var b=2*this.getUniform()-1,d=2*this.getUniform()-1,d=b*b+d*d;while(1<d||0==d);b*=Math.sqrt(-2*Math.log(d)/d);return(a||
0)+b*(c||1)},getPercentage:function(){return 1+Math.floor(100*this.getUniform())},getWeightedValue:function(a){var c=0,b;for(b in a)c+=a[b];var c=Math.floor(this.getUniform()*c),d=0;for(b in a)if(d+=a[b],c<d)return b;return null},getState:function(){return[this._s0,this._s1,this._s2,this._c]},setState:function(a){this._s0=a[0];this._s1=a[1];this._s2=a[2];this._c=a[3];return this},_s0:0,_s1:0,_s2:0,_c:0,_frac:2.3283064365386963E-10};ROT.RNG.setSeed(Date.now());
ROT.StringGenerator=function(a){this._options={words:!1,order:3,prior:0.001};for(var c in a)this._options[c]=a[c];this._suffix=this._boundary=String.fromCharCode(0);this._prefix=[];for(a=0;a<this._options.order;a++)this._prefix.push(this._boundary);this._priorValues={};this._priorValues[this._boundary]=this._options.prior;this._data={}};ROT.StringGenerator.prototype.clear=function(){this._data={};this._priorValues={}};
ROT.StringGenerator.prototype.generate=function(){for(var a=[this._sample(this._prefix)];a[a.length-1]!=this._boundary;)a.push(this._sample(a));return this._join(a.slice(0,-1))};
ROT.StringGenerator.prototype.observe=function(a){a=this._split(a);for(var c=0;c<a.length;c++)this._priorValues[a[c]]=this._options.prior;a=this._prefix.concat(a).concat(this._suffix);for(c=this._options.order;c<a.length;c++)for(var b=a.slice(c-this._options.order,c),d=a[c],e=0;e<b.length;e++){var f=b.slice(e);this._observeEvent(f,d)}};
ROT.StringGenerator.prototype.getStats=function(){var a=[],c=0,b;for(b in this._priorValues)c++;c--;a.push("distinct samples: "+c);var d=c=0;for(b in this._data){c++;for(var e in this._data[b])d++}a.push("dictionary size (contexts): "+c);a.push("dictionary size (events): "+d);return a.join(", ")};ROT.StringGenerator.prototype._split=function(a){return a.split(this._options.words?/\s+/:"")};ROT.StringGenerator.prototype._join=function(a){return a.join(this._options.words?" ":"")};
ROT.StringGenerator.prototype._observeEvent=function(a,c){var b=this._join(a);b in this._data||(this._data[b]={});b=this._data[b];c in b||(b[c]=0);b[c]++};ROT.StringGenerator.prototype._sample=function(a){a=this._backoff(a);a=this._join(a);a=this._data[a];var c={};if(this._options.prior){for(var b in this._priorValues)c[b]=this._priorValues[b];for(b in a)c[b]+=a[b]}else c=a;return this._pickRandom(c)};
ROT.StringGenerator.prototype._backoff=function(a){for(a.length>this._options.order?a=a.slice(-this._options.order):a.length<this._options.order&&(a=this._prefix.slice(0,this._options.order-a.length).concat(a));!(this._join(a)in this._data)&&0<a.length;)a=a.slice(1);return a};ROT.StringGenerator.prototype._pickRandom=function(a){var c=0,b;for(b in a)c+=a[b];var c=ROT.RNG.getUniform()*c,d=0;for(b in a)if(d+=a[b],c<d)return b};ROT.Map=function(a,c){this._width=a||ROT.DEFAULT_WIDTH;this._height=c||ROT.DEFAULT_HEIGHT};
ROT.Map.prototype.create=function(){};ROT.Map.prototype._fillMap=function(a){for(var c=[],b=0;b<this._width;b++){c.push([]);for(var d=0;d<this._height;d++)c[b].push(a)}return c};ROT.Map.Arena=function(a,c){ROT.Map.call(this,a,c)};ROT.Map.Arena.extend(ROT.Map);ROT.Map.Arena.prototype.create=function(a){for(var c=this._width-1,b=this._height-1,d=0;d<=c;d++)for(var e=0;e<=b;e++)a(d,e,d&&e&&d<c&&e<b?0:1);return this};ROT.Map.DividedMaze=function(a,c){ROT.Map.call(this,a,c);this._stack=[]};ROT.Map.DividedMaze.extend(ROT.Map);
ROT.Map.DividedMaze.prototype.create=function(a){var c=this._width,b=this._height;this._map=[];for(var d=0;d<c;d++){this._map.push([]);for(var e=0;e<b;e++)this._map[d].push(0==d||0==e||d+1==c||e+1==b?1:0)}this._stack=[[1,1,c-2,b-2]];this._process();for(d=0;d<c;d++)for(e=0;e<b;e++)a(d,e,this._map[d][e]);this._map=null;return this};ROT.Map.DividedMaze.prototype._process=function(){for(;this._stack.length;){var a=this._stack.shift();this._partitionRoom(a)}};
ROT.Map.DividedMaze.prototype._partitionRoom=function(a){for(var c=[],b=[],d=a[0]+1;d<a[2];d++){var e=this._map[d][a[3]+1];this._map[d][a[1]-1]&&(e&&!(d%2))&&c.push(d)}for(d=a[1]+1;d<a[3];d++)e=this._map[a[2]+1][d],this._map[a[0]-1][d]&&(e&&!(d%2))&&b.push(d);if(c.length&&b.length){c=c.random();b=b.random();this._map[c][b]=1;var e=[],f=[];e.push(f);for(d=a[0];d<c;d++)this._map[d][b]=1,f.push([d,b]);f=[];e.push(f);for(d=c+1;d<=a[2];d++)this._map[d][b]=1,f.push([d,b]);f=[];e.push(f);for(d=a[1];d<b;d++)this._map[c][d]=
1,f.push([c,d]);f=[];e.push(f);for(d=b+1;d<=a[3];d++)this._map[c][d]=1,f.push([c,d]);for(var g=e.random(),d=0;d<e.length;d++)f=e[d],f!=g&&(f=f.random(),this._map[f[0]][f[1]]=0);this._stack.push([a[0],a[1],c-1,b-1]);this._stack.push([c+1,a[1],a[2],b-1]);this._stack.push([a[0],b+1,c-1,a[3]]);this._stack.push([c+1,b+1,a[2],a[3]])}};ROT.Map.IceyMaze=function(a,c,b){ROT.Map.call(this,a,c);this._regularity=b||0};ROT.Map.IceyMaze.extend(ROT.Map);
ROT.Map.IceyMaze.prototype.create=function(a){var c=this._width,b=this._height,d=this._fillMap(1),c=c-(c%2?1:2),b=b-(b%2?1:2),e=0,f=0,g=0,h=0,j=0,k=!1,m=[[0,0],[0,0],[0,0],[0,0]];do if(e=1+2*Math.floor(ROT.RNG.getUniform()*(c-1)/2),f=1+2*Math.floor(ROT.RNG.getUniform()*(b-1)/2),j||(d[e][f]=0),!d[e][f]){this._randomize(m);do{0==Math.floor(ROT.RNG.getUniform()*(this._regularity+1))&&this._randomize(m);for(var k=!0,n=0;4>n;n++)if(g=e+2*m[n][0],h=f+2*m[n][1],this._isFree(d,g,h,c,b)){d[g][h]=0;d[e+m[n][0]][f+
m[n][1]]=0;e=g;f=h;k=!1;j++;break}}while(!k)}while(j+1<c*b/4);for(n=0;n<this._width;n++)for(c=0;c<this._height;c++)a(n,c,d[n][c]);this._map=null;return this};
ROT.Map.IceyMaze.prototype._randomize=function(a){for(var c=0;4>c;c++)a[c][0]=0,a[c][1]=0;switch(Math.floor(4*ROT.RNG.getUniform())){case 0:a[0][0]=-1;a[1][0]=1;a[2][1]=-1;a[3][1]=1;break;case 1:a[3][0]=-1;a[2][0]=1;a[1][1]=-1;a[0][1]=1;break;case 2:a[2][0]=-1;a[3][0]=1;a[0][1]=-1;a[1][1]=1;break;case 3:a[1][0]=-1,a[0][0]=1,a[3][1]=-1,a[2][1]=1}};ROT.Map.IceyMaze.prototype._isFree=function(a,c,b,d,e){return 1>c||1>b||c>=d||b>=e?!1:a[c][b]};ROT.Map.EllerMaze=function(a,c){ROT.Map.call(this,a,c)};ROT.Map.EllerMaze.extend(ROT.Map);
ROT.Map.EllerMaze.prototype.create=function(a){for(var c=this._fillMap(1),b=Math.ceil((this._width-2)/2),d=[],e=[],f=0;f<b;f++)d.push(f),e.push(f);d.push(b-1);for(var g=1;g+3<this._height;g+=2)for(f=0;f<b;f++){var h=2*f+1,j=g;c[h][j]=0;f!=d[f+1]&&0.375<ROT.RNG.getUniform()&&(this._addToList(f,d,e),c[h+1][j]=0);f!=d[f]&&0.375<ROT.RNG.getUniform()?this._removeFromList(f,d,e):c[h][j+1]=0}for(f=0;f<b;f++){h=2*f+1;j=g;c[h][j]=0;if(f!=d[f+1]&&(f==d[f]||0.375<ROT.RNG.getUniform()))this._addToList(f,d,e),
c[h+1][j]=0;this._removeFromList(f,d,e)}for(f=0;f<this._width;f++)for(g=0;g<this._height;g++)a(f,g,c[f][g]);return this};ROT.Map.EllerMaze.prototype._removeFromList=function(a,c,b){b[c[a]]=b[a];c[b[a]]=c[a];b[a]=a;c[a]=a};ROT.Map.EllerMaze.prototype._addToList=function(a,c,b){b[c[a+1]]=b[a];c[b[a]]=c[a+1];b[a]=a+1;c[a+1]=a};
ROT.Map.Cellular=function(a,c,b){ROT.Map.call(this,a,c);this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8};for(var d in b)this._options[d]=b[d];this._dirs=ROT.DIRS[this._options.topology];this._map=this._fillMap(0)};ROT.Map.Cellular.extend(ROT.Map);ROT.Map.Cellular.prototype.randomize=function(a){for(var c=0;c<this._width;c++)for(var b=0;b<this._height;b++)this._map[c][b]=ROT.RNG.getUniform()<a?1:0;return this};ROT.Map.Cellular.prototype.set=function(a,c,b){this._map[a][c]=b};
ROT.Map.Cellular.prototype.create=function(a){for(var c=this._fillMap(0),b=this._options.born,d=this._options.survive,e=0;e<this._height;e++){var f=1,g=0;6==this._options.topology&&(f=2,g=e%2);for(;g<this._width;g+=f){var h=this._map[g][e],j=this._getNeighbors(g,e);h&&-1!=d.indexOf(j)?c[g][e]=1:!h&&-1!=b.indexOf(j)&&(c[g][e]=1);a&&a(g,e,c[g][e])}}this._map=c};
ROT.Map.Cellular.prototype._getNeighbors=function(a,c){for(var b=0,d=0;d<this._dirs.length;d++){var e=this._dirs[d],f=a+e[0],e=c+e[1];0>f||(f>=this._width||0>f||e>=this._width)||(b+=1==this._map[f][e]?1:0)}return b};ROT.Map.Dungeon=function(a,c){ROT.Map.call(this,a,c);this._rooms=[];this._corridors=[]};ROT.Map.Dungeon.extend(ROT.Map);ROT.Map.Dungeon.prototype.getRooms=function(){return this._rooms};ROT.Map.Dungeon.prototype.getCorridors=function(){return this._corridors};
ROT.Map.Digger=function(a,c,b){ROT.Map.Dungeon.call(this,a,c);this._options={roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:0.2,timeLimit:1E3};for(var d in b)this._options[d]=b[d];this._features={Room:4,Corridor:4};this._featureAttempts=20;this._walls={};this._digCallback=this._digCallback.bind(this);this._canBeDugCallback=this._canBeDugCallback.bind(this);this._isWallCallback=this._isWallCallback.bind(this);this._priorityWallCallback=this._priorityWallCallback.bind(this)};ROT.Map.Digger.extend(ROT.Map.Dungeon);
ROT.Map.Digger.prototype.create=function(a){this._rooms=[];this._corridors=[];this._map=this._fillMap(1);this._walls={};this._dug=0;var c=(this._width-2)*(this._height-2);this._firstRoom();var b=Date.now();do{if(Date.now()-b>this._options.timeLimit)break;var d=this._findWall();if(!d)break;var e=d.split(","),d=parseInt(e[0]),e=parseInt(e[1]),f=this._getDiggingDirection(d,e);if(f){var g=0;do if(g++,this._tryFeature(d,e,f[0],f[1])){2==this._rooms.length+this._corridors.length&&this._rooms[0].addDoor(d,
e);this._removeSurroundingWalls(d,e);this._removeSurroundingWalls(d-f[0],e-f[1]);break}while(g<this._featureAttempts);var g=0,h;for(h in this._walls)1<this._walls[h]&&g++}}while(this._dug/c<this._options.dugPercentage||g);if(a)for(c=0;c<this._width;c++)for(b=0;b<this._height;b++)a(c,b,this._map[c][b]);this._walls={};this._map=null;return this};ROT.Map.Digger.prototype._digCallback=function(a,c,b){0==b||2==b?(this._map[a][c]=0,this._dug++):this._walls[a+","+c]=1};
ROT.Map.Digger.prototype._isWallCallback=function(a,c){return 0>a||0>c||a>=this._width||c>=this._height?!1:1==this._map[a][c]};ROT.Map.Digger.prototype._canBeDugCallback=function(a,c){return 1>a||1>c||a+1>=this._width||c+1>=this._height?!1:1==this._map[a][c]};ROT.Map.Digger.prototype._priorityWallCallback=function(a,c){this._walls[a+","+c]=2};
ROT.Map.Digger.prototype._firstRoom=function(){var a=ROT.Map.Feature.Room.createRandomCenter(Math.floor(this._width/2),Math.floor(this._height/2),this._options);this._rooms.push(a);a.create(this._digCallback)};ROT.Map.Digger.prototype._findWall=function(){var a=[],c=[],b;for(b in this._walls)2==this._walls[b]?c.push(b):a.push(b);a=c.length?c:a;if(!a.length)return null;b=a.random();delete this._walls[b];return b};
ROT.Map.Digger.prototype._tryFeature=function(a,c,b,d){var e=null,f=0,g;for(g in this._features)f+=this._features[g];var f=Math.floor(ROT.RNG.getUniform()*f),h=0;for(g in this._features)if(h+=this._features[g],f<h){e=ROT.Map.Feature[g];break}e=e.createRandomAt(a,c,b,d,this._options);if(!e.isValid(this._isWallCallback,this._canBeDugCallback))return!1;e.create(this._digCallback);e instanceof ROT.Map.Feature.Room&&this._rooms.push(e);e instanceof ROT.Map.Feature.Corridor&&(e.createPriorityWalls(this._priorityWallCallback),
this._corridors.push(e));return!0};ROT.Map.Digger.prototype._removeSurroundingWalls=function(a,c){for(var b=ROT.DIRS[4],d=0;d<b.length;d++){var e=b[d],f=a+e[0],g=c+e[1];delete this._walls[f+","+g];f=a+2*e[0];g=c+2*e[1];delete this._walls[f+","+g]}};
ROT.Map.Digger.prototype._getDiggingDirection=function(a,c){for(var b=null,d=ROT.DIRS[4],e=0;e<d.length;e++){var f=d[e],g=a+f[0],h=c+f[1];if(0>g||0>h||g>=this._width||h>=this._width)return null;if(!this._map[g][h]){if(b)return null;b=f}}return!b?null:[-b[0],-b[1]]};
ROT.Map.Uniform=function(a,c,b){ROT.Map.Dungeon.call(this,a,c);this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:0.1,timeLimit:1E3};for(var d in b)this._options[d]=b[d];this._corridorAttempts=this._roomAttempts=20;this._connected=[];this._unconnected=[];this._digCallback=this._digCallback.bind(this);this._canBeDugCallback=this._canBeDugCallback.bind(this);this._isWallCallback=this._isWallCallback.bind(this)};ROT.Map.Uniform.extend(ROT.Map.Dungeon);
ROT.Map.Uniform.prototype.create=function(a){for(var c=Date.now();;){if(Date.now()-c>this._options.timeLimit)return null;this._map=this._fillMap(1);this._dug=0;this._rooms=[];this._unconnected=[];this._generateRooms();if(this._generateCorridors())break}if(a)for(c=0;c<this._width;c++)for(var b=0;b<this._height;b++)a(c,b,this._map[c][b]);return this};ROT.Map.Uniform.prototype._generateRooms=function(){var a=this._width-2,c=this._height-2;do{var b=this._generateRoom();if(this._dug/(a*c)>this._options.roomDugPercentage)break}while(b)};
ROT.Map.Uniform.prototype._generateRoom=function(){for(var a=0;a<this._roomAttempts;){a++;var c=ROT.Map.Feature.Room.createRandom(this._width,this._height,this._options);if(c.isValid(this._isWallCallback,this._canBeDugCallback))return c.create(this._digCallback),this._rooms.push(c),c}return null};
ROT.Map.Uniform.prototype._generateCorridors=function(){for(var a=0;a<this._corridorAttempts;){a++;this._corridors=[];this._map=this._fillMap(1);for(var c=0;c<this._rooms.length;c++){var b=this._rooms[c];b.clearDoors();b.create(this._digCallback)}this._unconnected=this._rooms.slice().randomize();this._connected=[];for(this._unconnected.length&&this._connected.push(this._unconnected.pop());;){c=this._connected.random();c=this._closestRoom(this._unconnected,c);b=this._closestRoom(this._connected,c);
if(!this._connectRooms(c,b))break;if(!this._unconnected.length)return!0}}return!1};ROT.Map.Uniform.prototype._closestRoom=function(a,c){for(var b=Infinity,d=c.getCenter(),e=null,f=0;f<a.length;f++){var g=a[f],h=g.getCenter(),j=h[0]-d[0],h=h[1]-d[1],j=j*j+h*h;j<b&&(b=j,e=g)}return e};
ROT.Map.Uniform.prototype._connectRooms=function(a,c){var b=a.getCenter(),d=c.getCenter(),e=d[0]-b[0],b=d[1]-b[1];if(Math.abs(e)<Math.abs(b))var b=0<b?2:0,f=(b+2)%4,g=c.getLeft(),h=c.getRight(),e=0;else b=0<e?1:3,f=(b+2)%4,g=c.getTop(),h=c.getBottom(),e=1;b=this._placeInWall(a,b);if(!b)return!1;if(b[e]>=g&&b[e]<=h){var j=b.slice(),d=null;switch(f){case 0:d=c.getTop()-1;break;case 1:d=c.getRight()+1;break;case 2:d=c.getBottom()+1;break;case 3:d=c.getLeft()-1}j[(e+1)%2]=d;this._digLine([b,j])}else if(b[e]<
g-1||b[e]>h+1){d=b[e]-d[e];switch(f){case 0:case 1:j=0>d?3:1;break;case 2:case 3:j=0>d?1:3}j=this._placeInWall(c,(f+j)%4);if(!j)return!1;f=[0,0];f[e]=b[e];d=(e+1)%2;f[d]=j[d];this._digLine([b,f,j])}else{d=(e+1)%2;j=this._placeInWall(c,f);if(!j)return;f=Math.round((j[d]+b[d])/2);g=[0,0];h=[0,0];g[e]=b[e];g[d]=f;h[e]=j[e];h[d]=f;this._digLine([b,g,h,j])}a.addDoor(b[0],b[1]);c.addDoor(j[0],j[1]);e=this._unconnected.indexOf(a);-1!=e&&(this._unconnected.splice(e,1),this._connected.push(a));e=this._unconnected.indexOf(c);
-1!=e&&(this._unconnected.splice(e,1),this._connected.push(c));return!0};
ROT.Map.Uniform.prototype._placeInWall=function(a,c){var b=[0,0],d=[0,0],e=0;switch(c){case 0:d=[1,0];b=[a.getLeft(),a.getTop()-1];e=a.getRight()-a.getLeft()+1;break;case 1:d=[0,1];b=[a.getRight()+1,a.getTop()];e=a.getBottom()-a.getTop()+1;break;case 2:d=[1,0];b=[a.getLeft(),a.getBottom()+1];e=a.getRight()-a.getLeft()+1;break;case 3:d=[0,1],b=[a.getLeft()-1,a.getTop()],e=a.getBottom()-a.getTop()+1}for(var f=[],g=-2,h=0;h<e;h++){var j=b[0]+h*d[0],k=b[1]+h*d[1];f.push(null);1==this._map[j][k]?g!=h-
1&&(f[h]=[j,k]):(g=h)&&(f[h-1]=null)}for(h=f.length-1;0<=h;h--)f[h]||f.splice(h,1);return f.length?f.random():null};ROT.Map.Uniform.prototype._digLine=function(a){for(var c=1;c<a.length;c++){var b=a[c-1],d=a[c],b=new ROT.Map.Feature.Corridor(b[0],b[1],d[0],d[1]);b.create(this._digCallback);this._corridors.push(b)}};ROT.Map.Uniform.prototype._digCallback=function(a,c,b){this._map[a][c]=b;0==b&&this._dug++};
ROT.Map.Uniform.prototype._isWallCallback=function(a,c){return 0>a||0>c||a>=this._width||c>=this._height?!1:1==this._map[a][c]};ROT.Map.Uniform.prototype._canBeDugCallback=function(a,c){return 1>a||1>c||a+1>=this._width||c+1>=this._height?!1:1==this._map[a][c]};
ROT.Map.Rogue=function(a,c,b){ROT.Map.call(this,a,c);this._options={cellWidth:3,cellHeight:3};for(var d in b)this._options[d]=b[d];this._options.hasOwnProperty("roomWidth")||(this._options.roomWidth=this._calculateRoomSize(a,this._options.cellWidth));this._options.hasOwnProperty.roomHeight||(this._options.roomHeight=this._calculateRoomSize(c,this._options.cellHeight))};ROT.Map.Rogue.extend(ROT.Map);
ROT.Map.Rogue.prototype.create=function(a){this.map=this._fillMap(1);this.rooms=[];this.connectedCells=[];this._initRooms();this._connectRooms();this._connectUnconnectedRooms();this._createRandomRoomConnections();this._createRooms();this._createCorridors();if(a)for(var c=0;c<this._width;c++)for(var b=0;b<this._height;b++)a(c,b,this.map[c][b]);return this};ROT.Map.Rogue.prototype._getRandomInt=function(a,c){return Math.floor(ROT.RNG.getUniform()*(c-a+1))+a};
ROT.Map.Rogue.prototype._calculateRoomSize=function(a,c){var b=Math.floor(0.8*(a/c)),d=Math.floor(0.25*(a/c));2>d&&(d=2);2>b&&(b=2);return[d,b]};ROT.Map.Rogue.prototype._initRooms=function(){for(var a=0;a<this._options.cellWidth;a++){this.rooms.push([]);for(var c=0;c<this._options.cellHeight;c++)this.rooms[a].push({x:0,y:0,width:0,height:0,connections:[],cellx:a,celly:c})}};
ROT.Map.Rogue.prototype._connectRooms=function(){var a=this._getRandomInt(0,this._options.cellWidth-1),c=this._getRandomInt(0,this._options.cellHeight-1),b,d,e=!1,f;do{var g=[0,2,4,6],g=g.randomize();do if(e=!1,b=g.pop(),d=a+ROT.DIRS[8][b][0],b=c+ROT.DIRS[8][b][1],!(0>d||d>=this._options.cellWidth))if(!(0>b||b>=this._options.cellHeight)){f=this.rooms[a][c];if(0<f.connections.length&&f.connections[0][0]==d&&f.connections[0][1]==b)break;f=this.rooms[d][b];0==f.connections.length&&(f.connections.push([a,
c]),this.connectedCells.push([d,b]),a=d,c=b,e=!0)}while(0<g.length&&!1==e)}while(0<g.length)};
ROT.Map.Rogue.prototype._connectUnconnectedRooms=function(){var a=this._options.cellWidth,c=this._options.cellHeight;this.connectedCells=this.connectedCells.randomize();for(var b,d,e,f=0;f<this._options.cellWidth;f++)for(var g=0;g<this._options.cellHeight;g++)if(b=this.rooms[f][g],0==b.connections.length){var h=[0,2,4,6],h=h.randomize();e=!1;do{var j=h.pop(),k=f+ROT.DIRS[8][j][0],j=g+ROT.DIRS[8][j][1];if(!(0>k||k>=a||0>j||j>=c)){d=this.rooms[k][j];e=!0;if(0==d.connections.length)break;for(k=0;k<d.connections.length;k++)if(d.connections[k][0]==
f&&d.connections[k][1]==g){e=!1;break}if(e)break}}while(h.length);e?b.connections.push([d.cellx,d.celly]):console.log("-- Unable to connect room.")}};ROT.Map.Rogue.prototype._createRandomRoomConnections=function(){};
ROT.Map.Rogue.prototype._createRooms=function(){for(var a=this._width,c=this._height,b=this._options.cellWidth,d=this._options.cellHeight,e=Math.floor(this._width/b),f=Math.floor(this._height/d),g,h,j=this._options.roomWidth,k=this._options.roomHeight,m,n,l,p=0;p<b;p++)for(var q=0;q<d;q++){m=e*p;n=f*q;0==m&&(m=1);0==n&&(n=1);g=this._getRandomInt(j[0],j[1]);h=this._getRandomInt(k[0],k[1]);if(0<q)for(l=this.rooms[p][q-1];3>n-(l.y+l.height);)n++;if(0<p)for(l=this.rooms[p-1][q];3>m-(l.x+l.width);)m++;
l=Math.round(this._getRandomInt(0,e-g)/2);for(var r=Math.round(this._getRandomInt(0,f-h)/2);m+l+g>=a;)l?l--:g--;for(;n+r+h>=c;)r?r--:h--;m+=l;n+=r;this.rooms[p][q].x=m;this.rooms[p][q].y=n;this.rooms[p][q].width=g;this.rooms[p][q].height=h;for(l=m;l<m+g;l++)for(r=n;r<n+h;r++)this.map[l][r]=0}};
ROT.Map.Rogue.prototype._getWallPosition=function(a,c){var b,d,e;if(1==c||3==c)b=this._getRandomInt(a.x+1,a.x+a.width-2),1==c?(d=a.y-2,e=d+1):(d=a.y+a.height+1,e=d-1),this.map[b][e]=0;else if(2==c||4==c)d=this._getRandomInt(a.y+1,a.y+a.height-2),2==c?(b=a.x+a.width+1,e=b-1):(b=a.x-2,e=b+1),this.map[e][d]=0;return[b,d]};
ROT.Map.Rogue.prototype._drawCorridore=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=a[0],f=a[1],g,h,j=[];h=Math.abs(b);var k=Math.abs(d);g=ROT.RNG.getUniform();var m=1-g,b=0<b?2:6,d=0<d?4:0;h<k?(g=Math.ceil(k*g),j.push([d,g]),j.push([b,h]),g=Math.floor(k*m),j.push([d,g])):(g=Math.ceil(h*g),j.push([b,g]),j.push([d,k]),g=Math.floor(h*m),j.push([b,g]));for(this.map[e][f]=0;0<j.length;)for(h=j.pop();0<h[1];)e+=ROT.DIRS[8][h[0]][0],f+=ROT.DIRS[8][h[0]][1],this.map[e][f]=0,h[1]-=1};
ROT.Map.Rogue.prototype._createCorridors=function(){for(var a=this._options.cellWidth,c=this._options.cellHeight,b,d,e,f,g=0;g<a;g++)for(var h=0;h<c;h++){b=this.rooms[g][h];for(var j=0;j<b.connections.length;j++)d=b.connections[j],d=this.rooms[d[0]][d[1]],d.cellx>b.cellx?(e=2,f=4):d.cellx<b.cellx?(e=4,f=2):d.celly>b.celly?(e=3,f=1):d.celly<b.celly&&(e=1,f=3),this._drawCorridore(this._getWallPosition(b,e),this._getWallPosition(d,f))}};ROT.Map.Feature=function(){};
ROT.Map.Feature.prototype.isValid=function(){};ROT.Map.Feature.prototype.create=function(){};ROT.Map.Feature.prototype.debug=function(){};ROT.Map.Feature.createRandomAt=function(){};ROT.Map.Feature.Room=function(a,c,b,d,e,f){this._x1=a;this._y1=c;this._x2=b;this._y2=d;this._doors={};4<arguments.length&&this.addDoor(e,f)};ROT.Map.Feature.Room.extend(ROT.Map.Feature);
ROT.Map.Feature.Room.createRandomAt=function(a,c,b,d,e){var f=e.roomWidth[0],g=e.roomWidth[1],h=f+Math.floor(ROT.RNG.getUniform()*(g-f+1)),f=e.roomHeight[0],g=e.roomHeight[1];e=f+Math.floor(ROT.RNG.getUniform()*(g-f+1));if(1==b)return b=c-Math.floor(ROT.RNG.getUniform()*e),new this(a+1,b,a+h,b+e-1,a,c);if(-1==b)return b=c-Math.floor(ROT.RNG.getUniform()*e),new this(a-h,b,a-1,b+e-1,a,c);if(1==d)return b=a-Math.floor(ROT.RNG.getUniform()*h),new this(b,c+1,b+h-1,c+e,a,c);if(-1==d)return b=a-Math.floor(ROT.RNG.getUniform()*
h),new this(b,c-e,b+h-1,c-1,a,c)};ROT.Map.Feature.Room.createRandomCenter=function(a,c,b){var d=b.roomWidth[0],e=b.roomWidth[1],f=d+Math.floor(ROT.RNG.getUniform()*(e-d+1)),d=b.roomHeight[0],e=b.roomHeight[1];b=d+Math.floor(ROT.RNG.getUniform()*(e-d+1));a-=Math.floor(ROT.RNG.getUniform()*f);c-=Math.floor(ROT.RNG.getUniform()*b);return new this(a,c,a+f-1,c+b-1)};
ROT.Map.Feature.Room.createRandom=function(a,c,b){var d=b.roomWidth[0],e=b.roomWidth[1],f=d+Math.floor(ROT.RNG.getUniform()*(e-d+1)),d=b.roomHeight[0],e=b.roomHeight[1];b=d+Math.floor(ROT.RNG.getUniform()*(e-d+1));c=c-b-1;a=1+Math.floor(ROT.RNG.getUniform()*(a-f-1));c=1+Math.floor(ROT.RNG.getUniform()*c);return new this(a,c,a+f-1,c+b-1)};ROT.Map.Feature.Room.prototype.addDoor=function(a,c){this._doors[a+","+c]=1};
ROT.Map.Feature.Room.prototype.getDoors=function(a){for(var c in this._doors){var b=c.split(",");a(parseInt(b[0]),parseInt(b[1]))}};ROT.Map.Feature.Room.prototype.clearDoors=function(){this._doors={};return this};ROT.Map.Feature.Room.prototype.debug=function(){console.log("room",this._x1,this._y1,this._x2,this._y2)};
ROT.Map.Feature.Room.prototype.isValid=function(a,c){for(var b=this._x1-1,d=this._x2+1,e=this._y1-1,f=this._y2+1,g=b;g<=d;g++)for(var h=e;h<=f;h++)if(g==b||g==d||h==e||h==f){if(!a(g,h))return!1}else if(!c(g,h))return!1;return!0};ROT.Map.Feature.Room.prototype.create=function(a){for(var c=this._x1-1,b=this._x2+1,d=this._y1-1,e=this._y2+1,f=0,g=c;g<=b;g++)for(var h=d;h<=e;h++)f=g+","+h in this._doors?2:g==c||g==b||h==d||h==e?1:0,a(g,h,f)};
ROT.Map.Feature.Room.prototype.getCenter=function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]};ROT.Map.Feature.Room.prototype.getLeft=function(){return this._x1};ROT.Map.Feature.Room.prototype.getRight=function(){return this._x2};ROT.Map.Feature.Room.prototype.getTop=function(){return this._y1};ROT.Map.Feature.Room.prototype.getBottom=function(){return this._y2};
ROT.Map.Feature.Corridor=function(a,c,b,d){this._startX=a;this._startY=c;this._endX=b;this._endY=d;this._endsWithAWall=!0};ROT.Map.Feature.Corridor.extend(ROT.Map.Feature);ROT.Map.Feature.Corridor.createRandomAt=function(a,c,b,d,e){var f=e.corridorLength[0];e=e.corridorLength[1];f+=Math.floor(ROT.RNG.getUniform()*(e-f+1));return new this(a,c,a+b*f,c+d*f)};ROT.Map.Feature.Corridor.prototype.debug=function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)};
ROT.Map.Feature.Corridor.prototype.isValid=function(a,c){var b=this._startX,d=this._startY,e=this._endX-b,f=this._endY-d,g=1+Math.max(Math.abs(e),Math.abs(f));e&&(e/=Math.abs(e));f&&(f/=Math.abs(f));for(var h=f,j=-e,k=!0,m=0;m<g;m++){var n=b+m*e,l=d+m*f;c(n,l)||(k=!1);a(n+h,l+j)||(k=!1);a(n-h,l-j)||(k=!1);if(!k){g=m;this._endX=n-e;this._endY=l-f;break}}if(0==g||1==g&&a(this._endX+e,this._endY+f))return!1;b=!a(this._endX+e+h,this._endY+f+j);h=!a(this._endX+e-h,this._endY+f-j);this._endsWithAWall=a(this._endX+
e,this._endY+f);return(b||h)&&this._endsWithAWall?!1:!0};ROT.Map.Feature.Corridor.prototype.create=function(a){var c=this._startX,b=this._startY,d=this._endX-c,e=this._endY-b,f=1+Math.max(Math.abs(d),Math.abs(e));d&&(d/=Math.abs(d));e&&(e/=Math.abs(e));for(var g=0;g<f;g++)a(c+g*d,b+g*e,0);return!0};
ROT.Map.Feature.Corridor.prototype.createPriorityWalls=function(a){if(this._endsWithAWall){var c=this._endX-this._startX,b=this._endY-this._startY;c&&(c/=Math.abs(c));b&&(b/=Math.abs(b));var d=b,e=-c;a(this._endX+c,this._endY+b);a(this._endX+d,this._endY+e);a(this._endX-d,this._endY-e)}};ROT.Noise=function(){};ROT.Noise.prototype.get=function(){};
ROT.Noise.Simplex=function(a){ROT.Noise.call(this);this._F2=0.5*(Math.sqrt(3)-1);this._G2=(3-Math.sqrt(3))/6;this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];var c=[];a=a||256;for(var b=0;b<a;b++)c.push(b);c=c.randomize();this._perms=[];this._indexes=[];for(b=0;b<2*a;b++)this._perms.push(c[b%a]),this._indexes.push(this._perms[b]%this._gradients.length)};ROT.Noise.Simplex.extend(ROT.Noise);
ROT.Noise.Simplex.prototype.get=function(a,c){var b=this._perms,d=this._indexes,e=b.length/2,f=this._G2,g=0,h=0,j=0,k,m=(a+c)*this._F2,n=Math.floor(a+m);k=Math.floor(c+m);var m=(n+k)*f,l=a-(n-m),p=c-(k-m),q,r;l>p?(q=1,r=0):(q=0,r=1);var t=l-q+f,u=p-r+f,m=l-1+2*f,f=p-1+2*f,n=n.mod(e),e=k.mod(e),s=0.5-l*l-p*p;0<=s&&(s*=s,k=d[n+b[e]],k=this._gradients[k],g=s*s*(k[0]*l+k[1]*p));l=0.5-t*t-u*u;0<=l&&(l*=l,k=d[n+q+b[e+r]],k=this._gradients[k],h=l*l*(k[0]*t+k[1]*u));l=0.5-m*m-f*f;0<=l&&(l*=l,k=d[n+1+b[e+
1]],k=this._gradients[k],j=l*l*(k[0]*m+k[1]*f));return 70*(g+h+j)};ROT.FOV=function(a,c){this._lightPasses=a;this._options={topology:8};for(var b in c)this._options[b]=c[b]};ROT.FOV.prototype.compute=function(){};
ROT.FOV.prototype._getCircle=function(a,c,b){var d=[],e,f,g;switch(this._options.topology){case 4:f=1;g=[0,1];e=[ROT.DIRS[8][7],ROT.DIRS[8][1],ROT.DIRS[8][3],ROT.DIRS[8][5]];break;case 6:e=ROT.DIRS[6];f=1;g=[-1,1];break;case 8:e=ROT.DIRS[4],f=2,g=[-1,1]}a+=g[0]*b;c+=g[1]*b;for(g=0;g<e.length;g++)for(var h=0;h<b*f;h++)d.push([a,c]),a+=e[g][0],c+=e[g][1];return d};ROT.FOV.DiscreteShadowcasting=function(a,c){ROT.FOV.call(this,a,c)};ROT.FOV.DiscreteShadowcasting.extend(ROT.FOV);
ROT.FOV.DiscreteShadowcasting.prototype.compute=function(a,c,b,d){d(a,c,0);if(this._lightPasses(a,c))for(var e=[],f,g,h,j,k,m=1;m<=b;m++)for(var n=this._getCircle(a,c,m),l=360/n.length,p=0;p<n.length;p++)if(h=n[p][0],j=n[p][1],f=l*(p-0.5),g=f+l,k=!this._lightPasses(h,j),this._visibleCoords(Math.floor(f),Math.ceil(g),k,e)&&d(h,j,m,1),2==e.length&&0==e[0]&&360==e[1])return};
ROT.FOV.DiscreteShadowcasting.prototype._visibleCoords=function(a,c,b,d){if(0>a){var e=arguments.callee(0,c,b,d),f=arguments.callee(360+a,360,b,d);return e||f}for(e=0;e<d.length&&d[e]<a;)e++;if(e==d.length)return b&&d.push(a,c),!0;f=0;if(e%2){for(;e<d.length&&d[e]<c;)e++,f++;if(0==f)return!1;b&&(f%2?d.splice(e-f,f,c):d.splice(e-f,f))}else{for(;e<d.length&&d[e]<c;)e++,f++;if(a==d[e-f]&&1==f)return!1;b&&(f%2?d.splice(e-f,f,a):d.splice(e-f,f,a,c))}return!0};
ROT.FOV.PreciseShadowcasting=function(a,c){ROT.FOV.call(this,a,c)};ROT.FOV.PreciseShadowcasting.extend(ROT.FOV);ROT.FOV.PreciseShadowcasting.prototype.compute=function(a,c,b,d){d(a,c,0,1);if(this._lightPasses(a,c))for(var e=[],f,g,h,j,k,m=1;m<=b;m++)for(var n=this._getCircle(a,c,m),l=n.length,p=0;p<l;p++)if(f=n[p][0],g=n[p][1],j=[p?2*p-1:2*l-1,2*l],k=[2*p+1,2*l],h=!this._lightPasses(f,g),(h=this._checkVisibility(j,k,h,e))&&d(f,g,m,h),2==e.length&&0==e[0][0]&&e[1][0]==e[1][1])return};
ROT.FOV.PreciseShadowcasting.prototype._checkVisibility=function(a,c,b,d){if(a[0]>c[0])return a=this._checkVisibility(a,[a[1],a[1]],b,d),c=this._checkVisibility([0,1],c,b,d),(a+c)/2;for(var e=0,f=!1;e<d.length;){var g=d[e],g=g[0]*a[1]-a[0]*g[1];if(0<=g){0==g&&!(e%2)&&(f=!0);break}e++}for(var h=d.length,j=!1;h--;)if(g=d[h],g=c[0]*g[1]-g[0]*c[1],0<=g){0==g&&h%2&&(j=!0);break}g=!0;e==h&&(f||j)?g=!1:f&&j&&e+1==h&&h%2?g=!1:e>h&&e%2&&(g=!1);if(!g)return 0;f=h-e+1;if(f%2)e%2?(h=d[e],h=(c[0]*h[1]-h[0]*c[1])/
(h[1]*c[1]),b&&d.splice(e,f,c)):(h=d[h],h=(h[0]*a[1]-a[0]*h[1])/(a[1]*h[1]),b&&d.splice(e,f,a));else if(e%2)j=d[e],h=d[h],h=(h[0]*j[1]-j[0]*h[1])/(j[1]*h[1]),b&&d.splice(e,f);else return b&&d.splice(e,f,a,c),1;return h/((c[0]*a[1]-a[0]*c[1])/(a[1]*c[1]))};
ROT.Color={fromString:function(a){var c,b;if(a in this._cache)c=this._cache[a];else{if("#"==a.charAt(0))if(c=a.match(/[0-9a-f]/gi).map(function(a){return parseInt(a,16)}),3==c.length)c=c.map(function(a){return 17*a});else for(b=0;3>b;b++)c[b+1]+=16*c[b],c.splice(b,1);else c=(b=a.match(/rgb\(([0-9, ]+)\)/i))?b[1].split(/\s*,\s*/).map(function(a){return parseInt(a)}):[0,0,0];this._cache[a]=c}return c.slice()},add:function(a,c){for(var b=a.slice(),d=0;3>d;d++)for(var e=1;e<arguments.length;e++)b[d]+=
arguments[e][d];return b},add_:function(a,c){for(var b=0;3>b;b++)for(var d=1;d<arguments.length;d++)a[b]+=arguments[d][b];return a},multiply:function(a,c){for(var b=a.slice(),d=0;3>d;d++){for(var e=1;e<arguments.length;e++)b[d]*=arguments[e][d]/255;b[d]=Math.round(b[d])}return b},multiply_:function(a,c){for(var b=0;3>b;b++){for(var d=1;d<arguments.length;d++)a[b]*=arguments[d][b]/255;a[b]=Math.round(a[b])}return a},interpolate:function(a,c,b){3>arguments.length&&(b=0.5);for(var d=a.slice(),e=0;3>
e;e++)d[e]=Math.round(d[e]+b*(c[e]-a[e]));return d},interpolateHSL:function(a,c,b){3>arguments.length&&(b=0.5);for(var d=this.rgb2hsl(a),e=this.rgb2hsl(c),f=0;3>f;f++)d[f]+=b*(e[f]-d[f]);return this.hsl2rgb(d)},randomize:function(a,c){c instanceof Array||(c=ROT.RNG.getNormal(0,c));for(var b=a.slice(),d=0;3>d;d++)b[d]+=c instanceof Array?Math.round(ROT.RNG.getNormal(0,c[d])):c;return b},rgb2hsl:function(a){var c=a[0]/255,b=a[1]/255;a=a[2]/255;var d=Math.max(c,b,a),e=Math.min(c,b,a),f,g=(d+e)/2;if(d==
e)f=e=0;else{var h=d-e,e=0.5<g?h/(2-d-e):h/(d+e);switch(d){case c:f=(b-a)/h+(b<a?6:0);break;case b:f=(a-c)/h+2;break;case a:f=(c-b)/h+4}f/=6}return[f,e,g]},hsl2rgb:function(a){var c=a[2];if(0==a[1])return c*=255,[c,c,c];var b=function(a,c,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(c-a)*b:0.5>b?c:b<2/3?a+6*(c-a)*(2/3-b):a},d=a[1],d=0.5>c?c*(1+d):c+d-c*d,e=2*c-d,c=b(e,d,a[0]+1/3),f=b(e,d,a[0]);a=b(e,d,a[0]-1/3);return[Math.round(255*c),Math.round(255*f),Math.round(255*a)]},toRGB:function(a){return"rgb("+
this._clamp(a[0])+","+this._clamp(a[1])+","+this._clamp(a[2])+")"},toHex:function(a){for(var c=[],b=0;3>b;b++)c.push(this._clamp(a[b]).toString(16).lpad("0",2));return"#"+c.join("")},_clamp:function(a){return 0>a?0:255<a?255:a},_cache:{black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,
255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,
105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,
69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,
183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,
128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,
127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,
255,240],white:[255,255,255]}};ROT.Lighting=function(a,c){this._reflectivityCallback=a;this._options={passes:1,emissionThreshold:100,range:10};this._fov=null;this._lights={};this._reflectivityCache={};this._fovCache={};this.setOptions(c)};ROT.Lighting.prototype.setOptions=function(a){for(var c in a)this._options[c]=a[c];a.range&&this.reset();return this};ROT.Lighting.prototype.setFOV=function(a){this._fov=a;this._fovCache={};return this};
ROT.Lighting.prototype.setLight=function(a,c,b){a=a+","+c;b?this._lights[a]="string"==typeof b?ROT.Color.fromString(b):b:delete this._lights[a];return this};ROT.Lighting.prototype.reset=function(){this._reflectivityCache={};this._fovCache={};return this};
ROT.Lighting.prototype.compute=function(a){var c={},b={},d={},e;for(e in this._lights){var f=this._lights[e];e in b||(b[e]=[0,0,0]);ROT.Color.add_(b[e],f)}for(e=0;e<this._options.passes;e++)this._emitLight(b,d,c),e+1!=this._options.passes&&(b=this._computeEmitters(d,c));for(var g in d)b=g.split(","),c=parseInt(b[0]),b=parseInt(b[1]),a(c,b,d[g]);return this};
ROT.Lighting.prototype._emitLight=function(a,c,b){for(var d in a){var e=d.split(","),f=parseInt(e[0]),e=parseInt(e[1]);this._emitLightFromCell(f,e,a[d],c);b[d]=1}return this};
ROT.Lighting.prototype._computeEmitters=function(a,c){var b={},d;for(d in a)if(!(d in c)){var e=a[d];if(d in this._reflectivityCache)var f=this._reflectivityCache[d];else{var g=d.split(","),f=parseInt(g[0]),g=parseInt(g[1]),f=this._reflectivityCallback(f,g);this._reflectivityCache[d]=f}if(0!=f){for(var g=[],h=0,j=0;3>j;j++){var k=Math.round(e[j]*f);g[j]=k;h+=k}h>this._options.emissionThreshold&&(b[d]=g)}}return b};
ROT.Lighting.prototype._emitLightFromCell=function(a,c,b,d){var e=a+","+c;a=e in this._fovCache?this._fovCache[e]:this._updateFOV(a,c);for(var f in a){c=a[f];f in d?e=d[f]:(e=[0,0,0],d[f]=e);for(var g=0;3>g;g++)e[g]+=Math.round(b[g]*c)}return this};ROT.Lighting.prototype._updateFOV=function(a,c){var b={};this._fovCache[a+","+c]=b;var d=this._options.range;this._fov.compute(a,c,d,function(a,c,g,h){g=h*(1-g/d);0!=g&&(b[a+","+c]=g)}.bind(this));return b};
ROT.Path=function(a,c,b,d){this._toX=a;this._toY=c;this._fromY=this._fromX=null;this._passableCallback=b;this._options={topology:8};for(var e in d)this._options[e]=d[e];this._dirs=ROT.DIRS[this._options.topology]};ROT.Path.prototype.compute=function(){};ROT.Path.prototype._getNeighbors=function(a,c){for(var b=[],d=0;d<this._dirs.length;d++){var e=this._dirs[d],f=a+e[0],e=c+e[1];this._passableCallback(f,e)&&b.push([f,e])}return b};
ROT.Path.Dijkstra=function(a,c,b,d){ROT.Path.call(this,a,c,b,d);this._computed={};this._todo=[];this._add(a,c,null)};ROT.Path.Dijkstra.extend(ROT.Path);ROT.Path.Dijkstra.prototype.compute=function(a,c,b){var d=a+","+c;d in this._computed||this._compute(a,c);if(d in this._computed)for(a=this._computed[d];a;)b(a.x,a.y),a=a.prev};
ROT.Path.Dijkstra.prototype._compute=function(a,c){for(;this._todo.length;){var b=this._todo.shift();if(b.x==a&&b.y==c)break;for(var d=this._getNeighbors(b.x,b.y),e=0;e<d.length;e++){var f=d[e],g=f[0],f=f[1];g+","+f in this._computed||this._add(g,f,b)}}};ROT.Path.Dijkstra.prototype._add=function(a,c,b){b={x:a,y:c,prev:b};this._computed[a+","+c]=b;this._todo.push(b)};ROT.Path.AStar=function(a,c,b,d){ROT.Path.call(this,a,c,b,d);this._todo=[];this._done={};this._fromY=this._fromX=null};ROT.Path.AStar.extend(ROT.Path);
ROT.Path.AStar.prototype.compute=function(a,c,b){this._todo=[];this._done={};this._fromX=a;this._fromY=c;for(this._add(this._toX,this._toY,null);this._todo.length;){var d=this._todo.shift();if(d.x==a&&d.y==c)break;for(var e=this._getNeighbors(d.x,d.y),f=0;f<e.length;f++){var g=e[f],h=g[0],g=g[1];h+","+g in this._done||this._add(h,g,d)}}if(d=this._done[a+","+c])for(;d;)b(d.x,d.y),d=d.prev};
ROT.Path.AStar.prototype._add=function(a,c,b){b={x:a,y:c,prev:b,g:b?b.g+1:0,h:this._distance(a,c)};this._done[a+","+c]=b;a=b.g+b.h;for(c=0;c<this._todo.length;c++){var d=this._todo[c];if(a<d.g+d.h){this._todo.splice(c,0,b);return}}this._todo.push(b)};
ROT.Path.AStar.prototype._distance=function(a,c){switch(this._options.topology){case 4:return Math.abs(a-this._fromX)+Math.abs(c-this._fromY);case 6:var b=Math.abs(a-this._fromX),d=Math.abs(c-this._fromY);return d+Math.max(0,(b-d)/2);case 8:return Math.max(Math.abs(a-this._fromX),Math.abs(c-this._fromY))}};
